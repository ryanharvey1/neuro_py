
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../bias_correlation/">
      
      
        <link rel="next" href="../explained_variance/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="zensical-0.0.23">
    
    
      
        <title>Neural Decoding - neuro_py</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../assets/stylesheets/modern/main.1e989742.min.css">
      
        
          
        
        <link rel="stylesheet" href="../../assets/stylesheets/modern/palette.dfe2e883.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#neural-decoding" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="neuro_py" class="md-header__button md-logo" aria-label="neuro_py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            neuro_py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Neural Decoding
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="light-blue"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
        <a href="https://github.com/ryanharvey1/neuro_py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ryanharvey1/neuro_py
  </div>
</a>
      
    </div>
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../attractor_landscape/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="neuro_py" class="md-nav__button md-logo" aria-label="neuro_py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-book-open" viewBox="0 0 24 24"><path d="M12 7v14M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>

    </a>
    neuro_py
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ryanharvey1/neuro_py" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    ryanharvey1/neuro_py
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/behavior/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    behavior
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    behavior
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/cheeseboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    cheeseboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/circle_maze/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    circle_maze
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/get_trials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    get_trials
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/kinematics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    kinematics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/linear_positions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    linear_positions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/linearization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    linearization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/linearization_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    linearization_pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/behavior/well_traversal_classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    well_traversal_classification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/detectors/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    detectors
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    detectors
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/detectors/dentate_spike/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dentate_spike
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/detectors/up_down_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    up_down_state
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/ensemble/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    ensemble
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    ensemble
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/assembly/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    assembly
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/assembly_reactivation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    assembly_reactivation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    decoding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/bayesian/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    bayesian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/lstm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    lstm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/m2mlstm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    m2mlstm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/mlp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mlp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/preprocess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    preprocess
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/decoding/transformer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    transformer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/dynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/explained_variance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    explained_variance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/geometry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    geometry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/pairwise_bias_correlation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pairwise_bias_correlation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/replay/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    replay
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/similarity_index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    similarity_index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/ensemble/similaritymat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    similaritymat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/io/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    io
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    io
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/io/loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    loading
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/io/saving/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    saving
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/lfp/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    lfp
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    lfp
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/lfp/CSD/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/lfp/preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/lfp/spectral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    spectral
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/lfp/theta_cycles/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    theta_cycles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/plotting/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    plotting
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    plotting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/plotting/decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    decorators
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/plotting/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    events
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/plotting/figure_helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    figure_helpers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/process/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    process
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    process
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/batch_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    batch_analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/correlations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    correlations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/intervals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    intervals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/peri_event/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    peri_event
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/precession_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    precession_utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/pychronux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pychronux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/process/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/raw/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    raw
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    raw
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/raw/preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/raw/spike_sorting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    spike_sorting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/session/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    session
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    session
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/session/locate_epochs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    locate_epochs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/spikes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    spikes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    spikes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/spikes/spike_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    spike_tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/stats/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    stats
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    stats
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/stats/circ_stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    circ_stats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/stats/regression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    regression
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/stats/stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    stats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/stats/system_identifier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    system_identifier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/tuning/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    tuning
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    tuning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/tuning/fields/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    fields
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/tuning/maps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    maps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/neuro_py/util/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    util
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    util
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/neuro_py/util/array/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    array
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../attractor_landscape/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attractor Landscape
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bias_correlation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bias Correlation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Decoding
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="././" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Decoding
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Imports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-device-and-random-seed-for-reproducibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set device and random seed for reproducibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helper Functions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-1-decode-synthetic-neural-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1: Decode Synthetic Neural Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1: Decode Synthetic Neural Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-11-generate-synthetic-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1: Generate Synthetic Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.1: Generate Synthetic Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-111-create-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1.1: Create Environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-112-create-agent-and-place-cells-encoding-agents-position" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1.2: Create Agent and Place Cells encoding agent's position
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-12-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-13-train-linear-and-gaussian-process-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3: Train Linear and Gaussian Process Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.3: Train Linear and Gaussian Process Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-131-linear-decoder-ridge-regression" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3.1: Linear Decoder (Ridge Regression)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-132-gaussian-process-gp-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3.2: Gaussian Process (GP) Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-14-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-141-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-142-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-15-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2-trial-segmented-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2: Trial Segmented Decoding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 2: Trial Segmented Decoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-21-generate-synthetic-trial-segmented-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.1: Generate Synthetic Trial Segmented Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-22-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-23-train-linear-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.3: Train Linear Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-24-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 2.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-241-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-242-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-25-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-3-decoding-real-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3: Decoding Real Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 3: Decoding Real Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-31-load-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.1: Load the data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-32-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-33-train-linear-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.3: Train Linear Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-34-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 3.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-341-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-342-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-35-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../explained_variance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Explained Variance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neural_geodynamics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Geodynamics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../peth_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PETH
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reactivation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reactivation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../spatial_map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spatial Map
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Imports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-device-and-random-seed-for-reproducibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set device and random seed for reproducibility
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Helper Functions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-1-decode-synthetic-neural-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1: Decode Synthetic Neural Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1: Decode Synthetic Neural Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-11-generate-synthetic-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1: Generate Synthetic Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.1: Generate Synthetic Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-111-create-environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1.1: Create Environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-112-create-agent-and-place-cells-encoding-agents-position" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.1.2: Create Agent and Place Cells encoding agent's position
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-12-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-13-train-linear-and-gaussian-process-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3: Train Linear and Gaussian Process Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.3: Train Linear and Gaussian Process Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-131-linear-decoder-ridge-regression" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3.1: Linear Decoder (Ridge Regression)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-132-gaussian-process-gp-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.3.2: Gaussian Process (GP) Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-14-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 1.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-141-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-142-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-15-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2-trial-segmented-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2: Trial Segmented Decoding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 2: Trial Segmented Decoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-21-generate-synthetic-trial-segmented-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.1: Generate Synthetic Trial Segmented Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-22-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-23-train-linear-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.3: Train Linear Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-24-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 2.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-241-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-242-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-25-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-3-decoding-real-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3: Decoding Real Data
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 3: Decoding Real Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-31-load-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.1: Load the data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-32-prepare-data-for-decoding" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.2: Prepare Data for Decoding
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-33-train-linear-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.3: Train Linear Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-34-train-bayesian-dnn-decoders" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4: Train Bayesian &amp; DNN Decoders
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Section 3.4: Train Bayesian &amp; DNN Decoders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-341-bayesian-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4.1: Bayesian Decoder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-342-train-and-evaluate-the-dnn-decoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.4.2: Train and Evaluate the DNN Decoder
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-35-visualize-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 3.5: Visualize Results
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../attractor_landscape/" class="md-path__link">
          
  <span class="md-ellipsis">
    Tutorials
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  
  
    <a href="https://github.com/ryanharvey1/neuro_py/edit/main/docs/tutorials/decoding.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-file-pen" viewBox="0 0 24 24"><path d="M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34"/><path d="M14 2v5a1 1 0 0 0 1 1h5M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/ryanharvey1/neuro_py/raw/main/docs/tutorials/decoding.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-file-code-2" viewBox="0 0 24 24"><path d="M4 12.15V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3.35"/><path d="M14 2v5a1 1 0 0 0 1 1h5M5 16l-3 3 3 3M9 22l3-3-3-3"/></svg>
    </a>
  


<p><a href="https://colab.research.google.com/github/ryanharvey1/neuro_py/blob/main/tutorials/decoding.ipynb"><img alt="Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a>
&nbsp;
<a href="https://kaggle.com/kernels/welcome?src=https://raw.githubusercontent.com/ryanharvey1/neuro_py/main/tutorials/decoding.ipynb"><img alt="Kaggle" src="https://kaggle.com/static/images/open-in-kaggle.svg" /></a>
&nbsp;
<a href="https://mybinder.org/v2/gh/ryanharvey1/neuro_py/main?labpath=tutorials%2Fdecoding.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
<h1 id="neural-decoding">Neural Decoding<a class="headerlink" href="#neural-decoding" title="Permanent link">&para;</a></h1>
<p>In this tutorial, we'll explore how to use the Deep Neural Network decoders in
<a href="https://ryanharvey1.github.io/neuro_py/reference/neuro_py/ensemble/decoding/"><code>decoding</code></a>
submodule to analyze the neural correlates of behavior.</p>
<p>We will begin with synthetic data generation, followed by training and
evaluating models on real neural data. The goal is to understand how neural
activity can be decoded to predict behavioral outcomes.</p>
<hr />
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>First, let's import the necessary libraries and set up our environment.</p>
<h3 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">reload_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">gpytorch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nelpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nel</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ratinabox</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rbx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">neuro_py</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npy</span>

<span class="c1"># Disable logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
<h3 id="set-device-and-random-seed-for-reproducibility">Set device and random seed for reproducibility<a class="headerlink" href="#set-device-and-random-seed-for-reproducibility" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed_torch</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seed_torch</span><span class="p">:</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random seed </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s2"> has been set.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">seed</span>


<span class="k">def</span><span class="w"> </span><span class="nf">set_device</span><span class="p">():</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
    <span class="k">if</span> <span class="n">device</span> <span class="o">!=</span> <span class="s2">&quot;cuda&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPU is not enabled.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPU is enabled.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">device</span>


<span class="n">SEED</span> <span class="o">=</span> <span class="n">set_seed</span><span class="p">(</span><span class="mi">2025</span><span class="p">)</span>
<span class="n">DEVICE</span> <span class="o">=</span> <span class="n">set_device</span><span class="p">()</span>
<span class="n">torch</span><span class="o">.</span><span class="n">set_float32_matmul_precision</span><span class="p">(</span><span class="s1">&#39;medium&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Random seed 2025 has been set.
GPU is enabled.
</code></pre></div>
<h3 id="helper-functions">Helper Functions<a class="headerlink" href="#helper-functions" title="Permanent link">&para;</a></h3>
<p>Don't worry about the details of these functions; they are provided to streamline
our workflow.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># @title Helper Functions</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_cheeseboard_maze</span><span class="p">(</span>
    <span class="n">radius</span><span class="o">=</span><span class="mf">6.8</span><span class="p">,</span> <span class="n">nrewards</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nwellsonaxis</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span> <span class="n">nseparationunits</span><span class="o">=</span><span class="mi">4</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a cheeseboard-inspired maze using RatInABox with a circular environment</span>
<span class="sd">    and a grid of navigable positions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make a bulb shaped boundary</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">rbx</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
        <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">boundary</span><span class="o">=</span><span class="p">[</span>
                <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">boundary_conditions</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
            <span class="n">dimensionality</span><span class="o">=</span><span class="s2">&quot;2D&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Generate the grid of positions</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">nwellsonaxis</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">radius</span> <span class="o">*</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">radius</span> <span class="o">*</span> <span class="mf">1.03</span><span class="p">,</span> <span class="n">nwellsonaxis</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">grid_positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">separationunit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Filter positions to stay within the circle</span>
    <span class="n">circle_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">grid_positions_within_circle</span> <span class="o">=</span> <span class="n">grid_positions</span><span class="p">[</span><span class="n">circle_mask</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>

    <span class="c1"># Randomly pick 3 points with a minimum separation</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">pick_random_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_dist</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">chosen_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chosen_points_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">chosen_points</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_points</span><span class="p">:</span>
            <span class="n">candidate_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">candidate_idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">candidate</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">min_dist</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">chosen_points</span><span class="p">):</span>
                <span class="n">chosen_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
                <span class="n">chosen_points_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate_idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">chosen_points_indices</span><span class="p">)</span>

    <span class="n">reward_indices</span> <span class="o">=</span> <span class="n">pick_random_points</span><span class="p">(</span>
        <span class="n">grid_positions_within_circle</span><span class="p">,</span>
        <span class="n">num_points</span><span class="o">=</span><span class="n">nrewards</span><span class="p">,</span>
        <span class="n">min_dist</span><span class="o">=</span><span class="n">separationunit</span> <span class="o">*</span> <span class="n">nseparationunits</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># add wells</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">gp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">grid_positions_within_circle</span><span class="p">):</span>
        <span class="n">environment</span><span class="o">.</span><span class="n">add_object</span><span class="p">(</span><span class="n">gp</span> <span class="o">/</span> <span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">environment</span><span class="p">,</span> <span class="n">reward_indices</span>

<span class="c1"># Plotting</span>
<span class="k">def</span><span class="w"> </span><span class="nf">visualize_predicted_trial</span><span class="p">(</span>
    <span class="n">trial</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">actual_trials</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">environment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">reward_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">coord_labels</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">),</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize decoding performance for a single trial with arbitrary number of decoders.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    trial : int</span>
<span class="sd">        Trial index to visualize.</span>
<span class="sd">    actual_trials : list</span>
<span class="sd">        List of actual position arrays, one per trial.</span>
<span class="sd">    predictions : dict</span>
<span class="sd">        Dictionary mapping decoder names to their prediction arrays.</span>
<span class="sd">        Example: {&quot;Ridge&quot;: ridge_preds, &quot;MLP&quot;: mlp_preds, &quot;GP&quot;: gp_preds}</span>
<span class="sd">    environment : optional</span>
<span class="sd">        RatInABox environment object for plotting maze structure.</span>
<span class="sd">    reward_indices : optional</span>
<span class="sd">        Indices of reward locations to plot.</span>
<span class="sd">    figsize : tuple, optional</span>
<span class="sd">        Figure size, by default (15, 5).</span>
<span class="sd">    coord_labels : tuple, optional</span>
<span class="sd">        Labels for coordinates, by default (&quot;X&quot;, &quot;Y&quot;).</span>
<span class="sd">    alpha : float, optional</span>
<span class="sd">        Alpha value for prediction lines, by default 0.8.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The generated figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_coords</span> <span class="o">=</span> <span class="n">actual_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">n_coords</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>

    <span class="c1"># Plot each coordinate over time</span>
    <span class="k">for</span> <span class="n">coord_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_coords</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">coord_idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">actual_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">][:,</span> <span class="n">coord_idx</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Actual </span><span class="si">{</span><span class="n">coord_labels</span><span class="p">[</span><span class="n">coord_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">-Position&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">decoder_name</span><span class="p">,</span> <span class="n">preds_trials</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">preds_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">][:,</span> <span class="n">coord_idx</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decoder_name</span><span class="si">}</span><span class="s2"> Predicted&quot;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coord_labels</span><span class="p">[</span><span class="n">coord_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">-Coordinate&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Decoding Performance (</span><span class="si">{</span><span class="n">coord_labels</span><span class="p">[</span><span class="n">coord_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">-Coordinate)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coord_idx</span> <span class="o">==</span> <span class="n">n_coords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time Step&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

    <span class="c1"># Plot 2D trajectory with environment</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:])</span>
    <span class="k">if</span> <span class="n">environment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">environment</span><span class="o">.</span><span class="n">plot_environment</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">actual_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">decoder_name</span><span class="p">,</span> <span class="n">preds_trials</span> <span class="ow">in</span> <span class="n">predictions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">preds_trials</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">decoder_name</span><span class="si">}</span><span class="s2"> Predicted&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># Plot rewards if provided</span>
    <span class="k">if</span> <span class="n">reward_indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">environment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">environment</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">][</span><span class="n">reward_indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reward&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">coord_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">coord_labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Trajectory&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="c1"># GPyTorch model for multi-output GP regression (GPU/CPU parallelized)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultitaskGPModel</span><span class="p">(</span><span class="n">gpytorch</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ExactGP</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span> <span class="o">=</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">MultitaskMean</span><span class="p">(</span>
            <span class="n">gpytorch</span><span class="o">.</span><span class="n">means</span><span class="o">.</span><span class="n">ConstantMean</span><span class="p">(),</span> <span class="n">num_tasks</span><span class="o">=</span><span class="n">num_tasks</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span> <span class="o">=</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">MultitaskKernel</span><span class="p">(</span>
            <span class="n">gpytorch</span><span class="o">.</span><span class="n">kernels</span><span class="o">.</span><span class="n">RBFKernel</span><span class="p">(),</span> <span class="n">num_tasks</span><span class="o">=</span><span class="n">num_tasks</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">mean_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">covar_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covar_module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">MultitaskMultivariateNormal</span><span class="p">(</span><span class="n">mean_x</span><span class="p">,</span> <span class="n">covar_x</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train_gp_decoder</span><span class="p">(</span>
    <span class="n">train_neural</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">train_trajectory</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">test_neural</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">test_trajectory</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEVICE</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train a Gaussian Process decoder for neural trajectory prediction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    train_neural : pd.DataFrame or np.ndarray</span>
<span class="sd">        Training neural data (n_samples, n_neurons)</span>
<span class="sd">    train_trajectory : pd.DataFrame or np.ndarray</span>
<span class="sd">        Training trajectory data (n_samples, n_dims)</span>
<span class="sd">    test_neural : pd.DataFrame or np.ndarray</span>
<span class="sd">        Test neural data</span>
<span class="sd">    test_trajectory : pd.DataFrame or np.ndarray</span>
<span class="sd">        Test trajectory data</span>
<span class="sd">    n_iter : int, optional</span>
<span class="sd">        Number of training iterations, by default 50</span>
<span class="sd">    lr : float, optional</span>
<span class="sd">        Learning rate, by default 0.1</span>
<span class="sd">    device : str, optional</span>
<span class="sd">        Device to use (&#39;cuda&#39; or &#39;cpu&#39;), by default DEVICE</span>
<span class="sd">    use_lightning : bool, optional</span>
<span class="sd">        Whether to use PyTorch Lightning for training, by default True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        (predictions, r2_score, model) - predictions on test set, R score, and trained model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert data to torch tensors</span>
    <span class="c1"># check if train_neural is dataframe</span>
    <span class="n">train_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">(</span><span class="n">train_neural</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_neural</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">train_neural</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">(</span><span class="n">train_trajectory</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">train_trajectory</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">train_trajectory</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">test_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">(</span><span class="n">test_neural</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_neural</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">test_neural</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">test_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">(</span><span class="n">test_trajectory</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_trajectory</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">test_trajectory</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">num_tasks</span> <span class="o">=</span> <span class="n">train_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Number of output dimensions</span>

    <span class="c1"># Manual training loop (faster, no progress bar)</span>
    <span class="n">train_x</span> <span class="o">=</span> <span class="n">train_x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">train_y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">test_x</span> <span class="o">=</span> <span class="n">test_x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Initialize model</span>
    <span class="n">likelihood_gp</span> <span class="o">=</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">MultitaskGaussianLikelihood</span><span class="p">(</span><span class="n">num_tasks</span><span class="o">=</span><span class="n">num_tasks</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">model_gp</span> <span class="o">=</span> <span class="n">MultitaskGPModel</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">likelihood_gp</span><span class="p">,</span> <span class="n">num_tasks</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># Training mode</span>
    <span class="n">model_gp</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">likelihood_gp</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="c1"># Optimizer</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model_gp</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
    <span class="n">mll</span> <span class="o">=</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">mlls</span><span class="o">.</span><span class="n">ExactMarginalLogLikelihood</span><span class="p">(</span><span class="n">likelihood_gp</span><span class="p">,</span> <span class="n">model_gp</span><span class="p">)</span>

    <span class="c1"># Training loop</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_iter</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_gp</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="o">-</span><span class="n">mll</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iter </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_iter</span><span class="si">}</span><span class="s2"> - Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Evaluation</span>
    <span class="n">model_gp</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">likelihood_gp</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">(),</span> <span class="n">gpytorch</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">fast_pred_var</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">likelihood_gp</span><span class="p">(</span><span class="n">model_gp</span><span class="p">(</span><span class="n">test_x</span><span class="p">))</span>
        <span class="n">pred_mean</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">model_gp</span><span class="p">,</span> <span class="n">likelihood_gp</span><span class="p">)</span>

    <span class="c1"># Calculate R score</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
        <span class="p">(</span><span class="n">test_trajectory</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_trajectory</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">test_trajectory</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
        <span class="n">pred_mean</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pred_mean</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">model</span>

<span class="c1"># Widgets</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_trial_visualization_widget</span><span class="p">(</span>
    <span class="n">actual_trials</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">predictions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an interactive widget for visualizing decoding performance across trials.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    actual_trials : list</span>
<span class="sd">        List of actual position arrays, one per trial.</span>
<span class="sd">    predictions : dict</span>
<span class="sd">        Dictionary mapping decoder names to their prediction arrays.</span>
<span class="sd">        Example: {&quot;Ridge&quot;: ridge_preds_trials, &quot;MLP&quot;: mlp_preds_trials}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    widget : ipywidgets.interactive</span>
<span class="sd">        Interactive widget for trial visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_trials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_trials</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_visualize</span><span class="p">(</span><span class="n">trial</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">visualize_predicted_trial</span><span class="p">(</span>
            <span class="n">trial</span><span class="o">=</span><span class="n">trial</span><span class="p">,</span>
            <span class="n">actual_trials</span><span class="o">=</span><span class="n">actual_trials</span><span class="p">,</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">_visualize</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_trials</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div>
<h2 id="section-1-decode-synthetic-neural-data">Section 1: Decode Synthetic Neural Data<a class="headerlink" href="#section-1-decode-synthetic-neural-data" title="Permanent link">&para;</a></h2>
<h3 id="section-11-generate-synthetic-data">Section 1.1: Generate Synthetic Data<a class="headerlink" href="#section-11-generate-synthetic-data" title="Permanent link">&para;</a></h3>
<h4 id="section-111-create-environment">Section 1.1.1: Create Environment<a class="headerlink" href="#section-111-create-environment" title="Permanent link">&para;</a></h4>
<p>The following function generates a cheeseboard-inspired maze environment for the
agent:</p>
<div class="highlight"><pre><span></span><code><span class="n">environment</span><span class="p">,</span> <span class="n">reward_indices</span> <span class="o">=</span> <span class="n">create_cheeseboard_maze</span><span class="p">()</span>
</code></pre></div>
<h4 id="section-112-create-agent-and-place-cells-encoding-agents-position">Section 1.1.2: Create Agent and Place Cells encoding agent's position<a class="headerlink" href="#section-112-create-agent-and-place-cells-encoding-agents-position" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">agent</span> <span class="o">=</span> <span class="n">rbx</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

<span class="n">N_NEURONS</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">TIME</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">TIME</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="n">agent</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
<span class="n">placecells</span> <span class="o">=</span> <span class="n">rbx</span><span class="o">.</span><span class="n">PlaceCells</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;gaussian_threshold&quot;</span><span class="p">,</span>
        <span class="n">widths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="n">N_NEURONS</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
        <span class="n">wall_geometry</span><span class="o">=</span><span class="s2">&quot;line_of_sight&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># simulate the agent in the maze</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
    <span class="n">placecells</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

<span class="n">agent</span><span class="o">.</span><span class="n">plot_trajectory</span><span class="p">();</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reward Indices: </span><span class="si">{</span><span class="n">reward_indices</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of time bins: </span><span class="si">{</span><span class="n">bins</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>WARNING: This figure has not been saved.
     To AUTOMATICALLY save all plots (recommended), set  `ratinabox.autosave_plots = True`
     To MANUALLY save plots, call                        `ratinabox.utils.save_figure(figure_object, save_title).
      This warning will not be shown again
HINT: You can stylize plots to make them look like repo/paper by calling `ratinabox.stylize_plots()`
      This hint will not be shown again
Reward Indices: [ 62 140 160]
Number of time bins: 12000
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_14_1.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">placecells</span><span class="o">.</span><span class="n">plot_rate_map</span><span class="p">(</span><span class="n">chosen_neurons</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_15_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">placecells</span><span class="o">.</span><span class="n">plot_rate_map</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;history&quot;</span><span class="p">);</span>
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_16_0.png" /></p>
<h3 id="section-12-prepare-data-for-decoding">Section 1.2: Prepare Data for Decoding<a class="headerlink" href="#section-12-prepare-data-for-decoding" title="Permanent link">&para;</a></h3>
<p>Extract firing rates from the place cells and the agent's positional trajectory</p>
<div class="highlight"><pre><span></span><code><span class="n">t_start</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># seconds</span>
<span class="n">t_end</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
<span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">t_start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">))</span>
<span class="n">i_end</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">t_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>  <span class="c1"># subsample data for training (most of it is redundant anyway)</span>
<span class="n">neural_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;firingrate&quot;</span><span class="p">])[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>
<span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">])[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>
</code></pre></div>
<p>Format the neural data and behavioral variables (here, position) for decoding:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Convert neural data and trajectory into training format</span>
<span class="n">neural_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">neural_data</span><span class="p">)</span>  <span class="c1"># Neural data as DataFrame</span>
<span class="n">predict_bv</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
<span class="n">trajectory_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">predict_bv</span><span class="p">)</span>  <span class="c1"># Positions</span>

<span class="c1"># Split into training and testing sets (e.g., 80% train, 20% test)</span>
<span class="n">split_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">neural_data_df</span><span class="p">))</span>
<span class="n">train_neural</span><span class="p">,</span> <span class="n">test_neural</span> <span class="o">=</span> <span class="n">neural_data_df</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">neural_data_df</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
<span class="n">train_trajectory</span><span class="p">,</span> <span class="n">test_trajectory</span> <span class="o">=</span> <span class="n">trajectory_df</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">trajectory_df</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">trajectory</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">AnalogSignalArray</span><span class="p">(</span><span class="n">trajectory_df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">abscissa_vals</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">speed</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ddt_asa</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.250</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">trajectory</span><span class="p">,</span> <span class="n">speed</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(&lt;AnalogSignalArray at 0x7f8f74348c20: 2 signals&gt; for a total of 10:00 minutes,
 &lt;AnalogSignalArray at 0x7f8f6c76d370: 1 signals&gt; for a total of 10:00 minutes)
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">neural_data_df</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Neuron&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Firing Rates of Place Cells&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Firing Rate (Hz)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_22_0.png" /></p>
<h3 id="section-13-train-linear-and-gaussian-process-decoders">Section 1.3: Train Linear and Gaussian Process Decoders<a class="headerlink" href="#section-13-train-linear-and-gaussian-process-decoders" title="Permanent link">&para;</a></h3>
<p>Train simple hypothesis-driven decoders (because they bake very specific
assumptions about how stimuli map to neural responses into their functional form
and priors) for baseline comparison with more flexible Bayesian and DNN decoders:</p>
<p>For best practice, comparing performance to these simpler models is essential
to show that increased flexibility and capacity lead to meaningful gains in
predictive accuracy or interpretability, rather than merely overfitting or
exploiting idiosyncrasies of the dataset.</p>
<h4 id="section-131-linear-decoder-ridge-regression">Section 1.3.1: Linear Decoder (Ridge Regression)<a class="headerlink" href="#section-131-linear-decoder-ridge-regression" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">ridge</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_neural</span><span class="p">,</span> <span class="n">train_trajectory</span><span class="p">)</span>
<span class="n">ridge</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">test_neural</span><span class="p">,</span> <span class="n">test_trajectory</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.7261317318346573
</code></pre></div>
<h4 id="section-132-gaussian-process-gp-decoder">Section 1.3.2: Gaussian Process (GP) Decoder<a class="headerlink" href="#section-132-gaussian-process-gp-decoder" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Train GP decoder using Lightning</span>
<span class="n">pred_mean_gp</span><span class="p">,</span> <span class="n">r2_gp</span><span class="p">,</span> <span class="n">gp_model</span> <span class="o">=</span> <span class="n">train_gp_decoder</span><span class="p">(</span>
    <span class="n">train_neural</span><span class="p">,</span> <span class="n">train_trajectory</span><span class="p">,</span> <span class="n">test_neural</span><span class="p">,</span> <span class="n">test_trajectory</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">DEVICE</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GP R Score: </span><span class="si">{</span><span class="n">r2_gp</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Iter 10/50 - Loss: 0.737
Iter 20/50 - Loss: 0.285
Iter 30/50 - Loss: -0.201
Iter 40/50 - Loss: -0.685
Iter 50/50 - Loss: -1.116
GP R Score: 0.8801
</code></pre></div>
<h3 id="section-14-train-bayesian-dnn-decoders">Section 1.4: Train Bayesian &amp; DNN Decoders<a class="headerlink" href="#section-14-train-bayesian-dnn-decoders" title="Permanent link">&para;</a></h3>
<h4 id="section-141-bayesian-decoder">Section 1.4.1: Bayesian Decoder<a class="headerlink" href="#section-141-bayesian-decoder" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">tc</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">tuning</span><span class="o">.</span><span class="n">SpatialMap</span><span class="p">(</span>  <span class="c1"># training on all data for Bayesian decoder</span>
    <span class="n">trajectory</span><span class="p">,</span>
    <span class="n">nel</span><span class="o">.</span><span class="n">AnalogSignalArray</span><span class="p">(</span><span class="n">neural_data_df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">abscissa_vals</span><span class="o">=</span><span class="n">t</span><span class="p">),</span>
    <span class="n">s_binsize</span><span class="o">=</span><span class="mf">0.0075</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span>
    <span class="n">speed_thres</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">tuning_curve_sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">place_field_min_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">place_field_max_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">place_field_sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">posterior_prob</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">bayesian</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
    <span class="n">test_neural</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># (n_timebins, n_neurons)</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">ratemap</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">occupancy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
    <span class="n">uniform_prior</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">test_pred_bayesian</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">position_estimator</span><span class="p">(</span>
    <span class="n">posterior_prob</span><span class="p">,</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">ybin_centers</span><span class="p">,</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">xbin_centers</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
    <span class="n">test_trajectory</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># (n_timebins, 2)</span>
    <span class="n">test_pred_bayesian</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.7297538745740977
</code></pre></div>
<h4 id="section-142-train-and-evaluate-the-dnn-decoder">Section 1.4.2: Train and Evaluate the DNN Decoder<a class="headerlink" href="#section-142-train-and-evaluate-the-dnn-decoder" title="Permanent link">&para;</a></h4>
<p>Set up the decoder model and hyperparameters. For example, use an MLP decoder.</p>
<p>We refer description of key hyperparameters that impact model performance:</p>
<div class="highlight"><pre><span></span><code><span class="n">help</span><span class="p">(</span><span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">train_model</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Help on function train_model in module neuro_py.ensemble.decoding.pipeline:

train_model(partitions: List[Tuple[numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.ndarray, numpy.ndarray]], hyperparams: Dict[str, Any], resultspath: Optional[str] = None, stop_partition: Optional[int] = None) -&gt; Tuple[List[numpy.ndarray], List[Any], List[Dict[str, Any]], Dict[str, List[float]]]
    Train a DNN model on the given data partitions with in-built caching &amp; checkpointing.

    Parameters
    ----------
    partitions : List[Tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray]]
        K-fold partitions of the data with the following format:
        [(nsv_train, bv_train, nsv_val, bv_val, nsv_test, bv_test), ...]
        Each element of the list is a tuple of numpy arrays containing the with
        pairs of neural state vectors and behavioral variables for the training,
        validation, and test sets. Each array has the shape
        (ntrials, nbins, nfeats) where nfeats is the number of neurons for the
        neural state vectors and number of behavioral features to be predicted
        for the behavioral variables.
    hyperparams : Dict[str, Any]
        Dictionary containing the hyperparameters for the model training.
    resultspath : Optional[str], default=None
        Path to the directory where the trained models and logs will be saved.
    stop_partition : Optional[int], default=None
        Index of the partition to stop training at. Only useful for debugging,
        by default None

    Returns
    -------
    tuple
        Tuple containing the predicted behavioral variables for each fold,
        the trained models for each fold, the normalization parameters for each
        fold, and the evaluation metrics for each fold.

    Notes
    -----
    The hyperparameters dictionary should contain the following keys:
    - `model`: str, the type of the model to be trained. Multi-layer
        Perceptron (MLP), Long Short-Term Memory (LSTM), many-to-many LSTM
        (M2MLSTM), Transformer (NDT).
    - `model_args`: dict, the arguments to be passed to the model constructor.
        The arguments should be in the format expected by the model constructor.
        - `in_dim`: The number of input features.
        - `out_dim`: The number of output features.
        - `hidden_dims`: The number of hidden units each hidden layer of the
            model. Can also take float values to specify the dropout rate.
            - For LSTM and M2MLSTM, it should be a tuple of the hidden size,
                the number of layers, and the dropout rate.
                If the model is an MLP, it should be a list of hidden layer
                sizes which can also take float values to specify the dropout
                rate.
            - If the model is an LSTM or M2MLSTM, it should be a list of the
            hidden layer size, the number of layers, and the dropout rate.
            - If the model is an NDT, it should be a list of the hidden layer
                size, the number of layers, the number of attention heads, the
                dropout rate for the encoder layer, and the dropout rate applied
                before the decoder layer.
        - `max_context_len`: The maximum context length for the transformer
            model. Only used if the model is an NDT.
        - `args`:
            - `clf`: If True, the model is a classifier; otherwise, it is a
                regressor.
            - `activations`: The activation functions for each layer.
            - `criterion`: The loss function to optimize.
            - `epochs`: The number of complete passes through the training
                dataset.
            - `lr`: Controls how much to change the model in response to the
                estimated error each time the model weights are updated. A
                smaller value ensures stable convergence but may slow down
                training, while a larger value speeds up training but risks
                overshooting.
            - `base_lr`: The initial learning rate for the learning rate
                scheduler.
            - `max_grad_norm`: The maximum norm of the gradients.
            - `iters_to_accumulate`: The number of iterations to accumulate
                gradients.
            - `weight_decay`: The L2 regularization strength.
            - `num_training_batches`: The number of training batches. If
                None, the number of batches is calculated based on the batch
                size and the length of the training data.
            - `scheduler_step_size_multiplier`: The multiplier for the
                learning rate scheduler step size. Higher values lead to
                faster learning rate decay.
    - `bins_before`: int, the number of bins before the current bin to
        include in the input data.
    - `bins_current`: int, the number of bins in the current time bin to
        include in the input data.
    - `bins_after`: int, the number of bins after the current bin to include
        in the input data.
    - `behaviors`: list, the indices of the columns of behavioral features
        to be predicted. Selected behavioral variable must have homogenous
        data types across all features (continuous for regression and
        categorical for classification)
    - `batch_size`: int, the number of training examples utilized in one
        iteration. Larger batch sizes offer stable gradient estimates but
        require more memory, while smaller batches introduce noise that can
        help escape local minima.
        - When using M2MLSTM or NDT and input trials are of inconsistents
            lengths, the batch size should be set to 1.
        - M2MLSTM does not support batch_size != 1.
    - `num_workers`: int, The number of parallel processes to use for data
        loading. Increasing the number of workers can speed up data loading
        but may lead to memory issues. Too many workers can also slow down
        the training process due to contention for resources.
    - `accelerator`: str, the device to use for training. Should be &#39;cuda&#39; or
        &#39;cpu&#39;.
    - `seed`: int, the random seed for reproducibility.
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">decoder_type</span> <span class="o">=</span> <span class="s2">&quot;MLP&quot;</span>  <span class="c1"># Select decoder type (e.g., MLP)</span>
<span class="n">hyperparams</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">decoder_type</span><span class="p">,</span>
    <span class="n">model_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">in_dim</span><span class="o">=</span><span class="n">train_neural</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">out_dim</span><span class="o">=</span><span class="n">train_trajectory</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">hidden_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">clf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">activations</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">CELU</span><span class="p">,</span>
            <span class="n">criterion</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">lr</span><span class="o">=</span><span class="mf">3e-2</span><span class="p">,</span>
            <span class="n">base_lr</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">max_grad_norm</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">iters_to_accumulate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">num_training_batches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">scheduler_step_size_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">behaviors</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">bins_before</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">bins_current</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">bins_after</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>Train the decoder using the <code>train_model</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="n">partitions</span> <span class="o">=</span> <span class="p">[(</span>
    <span class="n">train_neural</span><span class="p">,</span>
    <span class="n">train_trajectory</span><span class="p">,</span>
    <span class="n">test_neural</span><span class="p">,</span>
    <span class="n">test_trajectory</span><span class="p">,</span>
    <span class="n">test_neural</span><span class="p">,</span>
    <span class="n">test_trajectory</span><span class="p">,</span>
<span class="p">)]</span>

<span class="c1"># Train the model using the pipeline function from your decoder module</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># checkpoints will be saved to this path, optimizing reruns</span>
<span class="n">bv_preds_folds</span><span class="p">,</span> <span class="n">bv_models_folds</span><span class="p">,</span> <span class="n">norm_params_folds</span><span class="p">,</span> <span class="n">metrics_folds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">train_model</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span> <span class="n">hyperparams</span><span class="p">,</span> <span class="n">resultspath</span><span class="o">=</span><span class="n">results_path</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
 Tip: For seamless cloud uploads and versioning, try installing [litmodels](https://pypi.org/project/litmodels/) to enable LitModelCheckpoint, which syncs automatically with the Lightning model registry.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   3.5 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 3.5 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 3.5 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.010282222181558609    </span>

</pre>

<div class="highlight"><pre><span></span><code>Variance weighed avg. coefficient of determination: 0.8256530304417413
RMSE: 0.09318435872837166
</code></pre></div>
<h3 id="section-15-visualize-results">Section 1.5: Visualize Results<a class="headerlink" href="#section-15-visualize-results" title="Permanent link">&para;</a></h3>
<p>Plot predictions versus ground truth to evaluate decoding performance:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Use the generalized visualization function</span>
<span class="n">predictions_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Bayesian&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">test_pred_bayesian</span><span class="p">],</span>
    <span class="s2">&quot;GP&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">pred_mean_gp</span><span class="p">],</span>
    <span class="n">decoder_type</span><span class="p">:</span> <span class="p">[</span><span class="n">bv_preds_folds</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
<span class="p">}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">visualize_predicted_trial</span><span class="p">(</span>
        <span class="n">trial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">actual_trials</span><span class="o">=</span><span class="p">[</span><span class="n">test_trajectory</span><span class="o">.</span><span class="n">values</span><span class="p">],</span>
        <span class="n">predictions</span><span class="o">=</span><span class="n">predictions_dict</span><span class="p">,</span>
        <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_36_0.png" /></p>
<p>The results of decoding using flexible Bayesian &amp; DNN deoders are not greater
than the linear and GP decoders. This is because the data is cleanly simulated
and the explicity assumptions of the Gaussian Process nature of relationship of
neurons and space is giving GP decoder an advantage.</p>
<p>Moreover, DNN is overkill for this task. However, in real data, the flexible
decoders will likely outperform the explicitly hypothesis-driven decoders.</p>
<h2 id="section-2-trial-segmented-decoding">Section 2: Trial Segmented Decoding<a class="headerlink" href="#section-2-trial-segmented-decoding" title="Permanent link">&para;</a></h2>
<p>Before we move on to real neural data, let's first understand how to decode
neural data in a trial-segmented manner. This is useful when the neural data is
segregated into chunks representing different trials, and we want to decode each
trial separately.</p>
<h3 id="section-21-generate-synthetic-trial-segmented-data">Section 2.1: Generate Synthetic Trial Segmented Data<a class="headerlink" href="#section-21-generate-synthetic-trial-segmented-data" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">environment</span><span class="p">,</span> <span class="n">reward_indices</span> <span class="o">=</span> <span class="n">create_cheeseboard_maze</span><span class="p">()</span>

<span class="n">agent</span> <span class="o">=</span> <span class="n">rbx</span><span class="o">.</span><span class="n">Agent</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>
<span class="n">init_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.48</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent initialized in Cheeseboard Maze: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">N_NEURONS</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">N_TRIALS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">placecells</span> <span class="o">=</span> <span class="n">rbx</span><span class="o">.</span><span class="n">PlaceCells</span><span class="p">(</span>
    <span class="n">agent</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;gaussian_threshold&quot;</span><span class="p">,</span>
        <span class="n">widths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="n">N_NEURONS</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
        <span class="n">wall_geometry</span><span class="o">=</span><span class="s2">&quot;line_of_sight&quot;</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="n">checkpts_coords</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">environment</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">][</span><span class="n">reward_idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">reward_idx</span> <span class="ow">in</span> <span class="n">reward_indices</span>
<span class="p">]</span>
<span class="n">checkpts_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">init_pos</span><span class="p">]</span> <span class="o">+</span> <span class="n">checkpts_coords</span> <span class="o">+</span> <span class="p">[</span><span class="n">init_pos</span><span class="p">]</span>

<span class="n">trial_epochs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trial_epoch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_TRIALS</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">goal_coords</span> <span class="ow">in</span> <span class="n">checkpts_coords</span><span class="p">:</span>
        <span class="c1"># simulate the agent in the maze</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dir_to_goal</span> <span class="o">=</span> <span class="n">goal_coords</span> <span class="o">-</span> <span class="n">agent</span><span class="o">.</span><span class="n">pos</span>
            <span class="n">drift_vel</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">speed_mean</span> <span class="o">*</span> <span class="n">dir_to_goal</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dir_to_goal</span><span class="p">)</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">drift_velocity</span><span class="o">=</span><span class="n">drift_vel</span><span class="p">)</span>
            <span class="n">placecells</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

            <span class="c1"># if animal is close to reward, break</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dir_to_goal</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">goal_coords</span> <span class="o">==</span> <span class="n">init_pos</span><span class="p">):</span>
                    <span class="n">trial_epoch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trial_epoch</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">trial_epochs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial_epoch</span><span class="p">)</span>
                        <span class="n">trial_epoch</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">break</span>

<span class="n">agent</span><span class="o">.</span><span class="n">plot_trajectory</span><span class="p">(</span><span class="n">trial_epochs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">trial_epochs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># plot rewards</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reward_indices</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">environment</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;ko&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Agent initialized in Cheeseboard Maze: [-0.24221668  0.15734778]
</code></pre></div>
<p><img alt="png" src="../decoding_files/decoding_40_1.png" /></p>
<h3 id="section-22-prepare-data-for-decoding">Section 2.2: Prepare Data for Decoding<a class="headerlink" href="#section-22-prepare-data-for-decoding" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">nsv_trials</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bv_trials</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span> <span class="ow">in</span> <span class="n">trial_epochs</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">t_start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_start</span><span class="p">))</span>
    <span class="n">i_end</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">t_end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t_end</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>  <span class="c1"># subsample data for training (most of it is redundant anyway)</span>
    <span class="n">neural_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;firingrate&quot;</span><span class="p">])[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>
    <span class="c1"># Inject some noise to the neural data</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">neural_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">neural_data</span> <span class="o">+=</span> <span class="n">noise</span>
    <span class="n">nsv_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">neural_data</span><span class="p">))</span>
    <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">placecells</span><span class="o">.</span><span class="n">Agent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">])[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">]</span>
    <span class="n">bv_trials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">trajectory</span><span class="p">))</span>
<span class="n">nsv_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="n">bv_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bv_trials</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">visualize_trial</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Neuron&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Firing Rates of Cells&quot;</span><span class="p">)</span>

    <span class="n">environment</span><span class="o">.</span><span class="n">plot_environment</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">bv_trials</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
    <span class="c1"># plot rewards</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">environment</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="s2">&quot;objects&quot;</span><span class="p">][</span><span class="n">reward_indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s2">&quot;ko&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reward&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Trajectory&quot;</span><span class="p">)</span>
    <span class="c1"># plot first 2 legend only</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">visualize_trial</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>interactive(children=(IntSlider(value=0, description=&#39;t&#39;, max=99), Output()), _dom_classes=(&#39;widget-interact&#39;,
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fold_indices</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span>
    <span class="n">nsv_trials</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">)),</span> <span class="mf">0.6</span>
<span class="p">)</span>
<span class="n">partition_indices</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">partition_indices</span><span class="p">(</span><span class="n">fold_indices</span><span class="p">)</span>
<span class="n">partitions</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">partition_sets</span><span class="p">(</span>
    <span class="n">partition_indices</span><span class="p">,</span> <span class="n">nsv_trials</span><span class="p">,</span> <span class="n">bv_trials</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="section-23-train-linear-decoder">Section 2.3: Train Linear Decoder<a class="headerlink" href="#section-23-train-linear-decoder" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">bv_test_pred_ridge</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nsv_train</span><span class="p">,</span> <span class="n">bv_train</span><span class="p">,</span> <span class="n">nsv_val</span><span class="p">,</span> <span class="n">bv_val</span><span class="p">,</span> <span class="n">nsv_test</span><span class="p">,</span> <span class="n">bv_test</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
    <span class="n">ridge</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_train</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_train</span><span class="p">))</span>
    <span class="n">bv_test_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_test</span><span class="p">))</span>
    <span class="n">bv_test_pred_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bv_test_pred</span><span class="p">)</span>

<span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_ridge</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.9649044686864525
</code></pre></div>
<p>(Skipping GP decoder training because of long training times)</p>
<h3 id="section-24-train-bayesian-dnn-decoders">Section 2.4: Train Bayesian &amp; DNN Decoders<a class="headerlink" href="#section-24-train-bayesian-dnn-decoders" title="Permanent link">&para;</a></h3>
<h4 id="section-241-bayesian-decoder">Section 2.4.1: Bayesian Decoder<a class="headerlink" href="#section-241-bayesian-decoder" title="Permanent link">&para;</a></h4>
<p>Train a Bayesian decoder using spatial tuning curves for comparison.</p>
<p>Note that the spatial maps are created using data both in training &amp; test sets.
This is a form of data leakage for the purpose of model evaluation.</p>
<p>For the purpose of this tutorial, it is necessary to keep things simple for this
spatial bin classification method. However, data leakage in such a case can be
evaded by ensuring minimum sampling from all spatial bins exists in all training
sets of different partitions.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Convert all data to nelpy objects</span>
<span class="c1"># Concatenate all training data to build tuning curves</span>
<span class="n">all_neural_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_pos_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">all_times_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cumulative_time</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="k">for</span> <span class="n">nsv_train</span><span class="p">,</span> <span class="n">bv_train</span><span class="p">,</span> <span class="n">nsv_val</span><span class="p">,</span> <span class="n">bv_val</span><span class="p">,</span> <span class="n">nsv_test</span><span class="p">,</span> <span class="n">bv_test</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">neural_trial</span><span class="p">,</span> <span class="n">pos_trial</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nsv_train</span><span class="p">,</span> <span class="n">bv_train</span><span class="p">):</span>
        <span class="n">all_neural_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neural_trial</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">all_pos_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_trial</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">trial_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neural_trial</span><span class="p">)</span>
        <span class="n">all_times_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">trial_length</span><span class="p">)</span> <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">dt</span> <span class="o">+</span> <span class="n">cumulative_time</span><span class="p">)</span>
        <span class="n">cumulative_time</span> <span class="o">+=</span> <span class="n">trial_length</span> <span class="o">*</span> <span class="n">agent</span><span class="o">.</span><span class="n">dt</span>

<span class="c1"># Stack all data</span>
<span class="n">all_neural_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">all_neural_train</span><span class="p">)</span>
<span class="n">all_pos_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">all_pos_train</span><span class="p">)</span>
<span class="n">all_times_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_times_train</span><span class="p">)</span>

<span class="c1"># Create nelpy objects for tuning curve calculation</span>
<span class="n">trajectory_nel</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">AnalogSignalArray</span><span class="p">(</span><span class="n">all_pos_train</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">abscissa_vals</span><span class="o">=</span><span class="n">all_times_train</span><span class="p">)</span>
<span class="n">speed_nel</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">ddt_asa</span><span class="p">(</span><span class="n">trajectory_nel</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.250</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">neural_nel</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">AnalogSignalArray</span><span class="p">(</span><span class="n">all_neural_train</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">abscissa_vals</span><span class="o">=</span><span class="n">all_times_train</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Train Bayesian decoder by building spatial maps from all trials</span>
<span class="c1"># Build spatial maps</span>
<span class="n">tc_bayesian</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">tuning</span><span class="o">.</span><span class="n">SpatialMap</span><span class="p">(</span>
    <span class="n">trajectory_nel</span><span class="p">,</span>
    <span class="n">neural_nel</span><span class="p">,</span>
    <span class="n">s_binsize</span><span class="o">=</span><span class="mf">0.0075</span><span class="p">,</span>
    <span class="n">speed</span><span class="o">=</span><span class="n">speed_nel</span><span class="p">,</span>
    <span class="n">speed_thres</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">tuning_curve_sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">place_field_min_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">place_field_max_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">place_field_sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Make predictions on test data</span>
<span class="n">bv_test_pred_bayesian</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">nsv_test</span><span class="p">,</span> <span class="n">bv_test</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
    <span class="n">posterior_prob</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">bayesian</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_test</span><span class="p">),</span>  <span class="c1"># (n_timebins, n_neurons)</span>
        <span class="n">tc_bayesian</span><span class="o">.</span><span class="n">ratemap</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">tc_bayesian</span><span class="o">.</span><span class="n">occupancy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span>
        <span class="n">uniform_prior</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">test_pred</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">position_estimator</span><span class="p">(</span>
        <span class="n">posterior_prob</span><span class="p">,</span>
        <span class="n">tc_bayesian</span><span class="o">.</span><span class="n">ybin_centers</span><span class="p">,</span>
        <span class="n">tc_bayesian</span><span class="o">.</span><span class="n">xbin_centers</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bv_test_pred_bayesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_pred</span><span class="p">)</span>

<span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_bayesian</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.8205066579983402
</code></pre></div>
<h4 id="section-242-train-and-evaluate-the-dnn-decoder">Section 2.4.2: Train and Evaluate the DNN Decoder<a class="headerlink" href="#section-242-train-and-evaluate-the-dnn-decoder" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">decoder_type</span> <span class="o">=</span> <span class="s2">&quot;MLP&quot;</span>  <span class="c1"># Select decoder type (e.g., MLP)</span>
<span class="n">hyperparams</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">decoder_type</span><span class="p">,</span>
    <span class="n">model_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">in_dim</span><span class="o">=</span><span class="n">nsv_trials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">out_dim</span><span class="o">=</span><span class="n">bv_trials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">hidden_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
        <span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">clf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">activations</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">CELU</span><span class="p">,</span>
            <span class="n">criterion</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">lr</span><span class="o">=</span><span class="mf">3e-2</span><span class="p">,</span>
            <span class="n">base_lr</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">max_grad_norm</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">iters_to_accumulate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">num_training_batches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">scheduler_step_size_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">behaviors</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">bins_before</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">bins_current</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">bins_after</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Train the model using the pipeline function from your decoder module</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="s2">&quot;results&quot;</span>
<span class="n">bv_preds_folds</span><span class="p">,</span> <span class="n">bv_models_folds</span><span class="p">,</span> <span class="n">norm_params_folds</span><span class="p">,</span> <span class="n">metrics_folds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">train_model</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span> <span class="n">hyperparams</span><span class="p">,</span> <span class="n">resultspath</span><span class="o">=</span><span class="n">results_path</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   6.0 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 6.0 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 6.0 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.0012865465832874179   </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/2555598951 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.9714067094278961
RMSE: 0.03585913779325996
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   6.0 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 6.0 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 6.0 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.001433454337529838    </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/2555598951 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.9668799893931259
RMSE: 0.03769905526888104
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   6.0 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 6.0 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 6.0 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.0010953289456665516   </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/2555598951 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.9738012919898239
RMSE: 0.033095253798918436
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   6.0 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 6.0 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 6.0 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.001239695819094777    </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/2555598951 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.9713017714821129
RMSE: 0.03515008483887547
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   6.0 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 6.0 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 6.0 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 0                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 10                                                                                          
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=10` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">   0.0013565346598625183   </span>

</pre>

<div class="highlight"><pre><span></span><code>Variance weighed avg. coefficient of determination: 0.9680192310424885
RMSE: 0.03673899145029244
</code></pre></div>
<h3 id="section-25-visualize-results">Section 2.5: Visualize Results<a class="headerlink" href="#section-25-visualize-results" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">bv_preds_dnn_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
    <span class="n">bv_preds_fold</span> <span class="o">+</span> <span class="n">norm_params_folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;y_train_mean&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bv_preds_fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bv_preds_folds</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">bv_preds_ridge_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_ridge</span><span class="p">)</span>
<span class="n">bv_preds_bayesian_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_bayesian</span><span class="p">)</span>
<span class="n">bv_actual_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">])</span>
<span class="n">trial_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">trial_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">trial_lengths</span><span class="p">)</span>

<span class="n">bv_preds_dnn_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_preds_dnn_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bv_preds_ridge_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_preds_ridge_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bv_preds_bayesian_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_preds_bayesian_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bv_actual_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_actual_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># Use the flexible visualization function</span>
<span class="n">predictions_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Ridge&quot;</span><span class="p">:</span> <span class="n">bv_preds_ridge_trials</span><span class="p">,</span>
    <span class="s2">&quot;Bayesian&quot;</span><span class="p">:</span> <span class="n">bv_preds_bayesian_trials</span><span class="p">,</span>
    <span class="n">decoder_type</span><span class="p">:</span> <span class="n">bv_preds_dnn_trials</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">trial</span><span class="p">:</span> <span class="n">visualize_predicted_trial</span><span class="p">(</span>
        <span class="n">trial</span><span class="p">,</span>
        <span class="n">bv_actual_trials</span><span class="p">,</span>
        <span class="n">predictions_dict</span><span class="p">,</span>
        <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span>
        <span class="n">reward_indices</span><span class="o">=</span><span class="n">reward_indices</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">trial</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>interactive(children=(IntSlider(value=49, description=&#39;trial&#39;, max=99), Output()), _dom_classes=(&#39;widget-inter
</code></pre></div>
<h2 id="section-3-decoding-real-data">Section 3: Decoding Real Data<a class="headerlink" href="#section-3-decoding-real-data" title="Permanent link">&para;</a></h2>
<p>Now that we've seen how to decode synthetic data, let's try decoding real data.</p>
<h3 id="section-31-load-the-data">Section 3.1: Load the data<a class="headerlink" href="#section-31-load-the-data" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">BIN_SIZE</span> <span class="o">=</span> <span class="mf">0.05</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">basepath</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;/fs/ayadata1-afr77.nbb.cornell.edu/volume1/ayadata1/Data/GrosmarkAD/Achilles/Achilles_10252013&quot;</span>

<span class="n">epoch_df</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_epoch</span><span class="p">(</span><span class="n">basepath</span><span class="p">)</span>
<span class="c1"># get session bounds to provide support</span>
<span class="n">session_bounds</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">EpochArray</span><span class="p">(</span>
    <span class="p">[</span><span class="n">epoch_df</span><span class="o">.</span><span class="n">startTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">epoch_df</span><span class="o">.</span><span class="n">stopTime</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="p">)</span>
<span class="c1"># compress repeated sleep sessions</span>
<span class="n">epoch_df</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">compress_repeated_epochs</span><span class="p">(</span><span class="n">epoch_df</span><span class="p">)</span>
<span class="n">beh_epochs</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">EpochArray</span><span class="p">(</span><span class="n">epoch_df</span><span class="p">[[</span><span class="s2">&quot;startTime&quot;</span><span class="p">,</span> <span class="s2">&quot;stopTime&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>

<span class="n">st</span><span class="p">,</span> <span class="n">cell_metrics</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_spikes</span><span class="p">(</span>
    <span class="n">basepath</span><span class="p">,</span> <span class="n">putativeCellType</span><span class="o">=</span><span class="s2">&quot;Pyr&quot;</span><span class="p">,</span> <span class="n">brainRegion</span><span class="o">=</span><span class="s2">&quot;CA1&quot;</span>
<span class="p">)</span>
<span class="n">spike_spindices</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">spikes</span><span class="o">.</span><span class="n">get_spindices</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="n">swr</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_ripples_events</span><span class="p">(</span><span class="n">basepath</span><span class="p">,</span> <span class="n">return_epoch_array</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">EpochArray</span><span class="p">(</span><span class="n">npy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_SleepState_states</span><span class="p">(</span><span class="n">basepath</span><span class="p">)[</span><span class="s2">&quot;THETA&quot;</span><span class="p">])</span>

<span class="n">task_idx</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">in_intervals</span><span class="p">(</span>
    <span class="n">spike_spindices</span><span class="o">.</span><span class="n">spike_times</span><span class="p">,</span> <span class="p">(</span><span class="n">beh_epochs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">position_df</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">load_animal_behavior</span><span class="p">(</span><span class="n">basepath</span><span class="p">)</span>
<span class="n">position_df</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">position_df</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">position_df</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">position_df</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span>

<span class="c1"># put position into a nelpy position array for ease of use</span>
<span class="n">posxy</span> <span class="o">=</span> <span class="n">nel</span><span class="o">.</span><span class="n">AnalogSignalArray</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">position_df</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="n">timestamps</span><span class="o">=</span><span class="n">position_df</span><span class="o">.</span><span class="n">timestamps</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># get outbound and inbound epochs</span>
<span class="p">(</span><span class="n">outbound_epochs</span><span class="p">,</span> <span class="n">inbound_epochs</span><span class="p">)</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">behavior</span><span class="o">.</span><span class="n">get_linear_track_lap_epochs</span><span class="p">(</span>
    <span class="n">posxy</span><span class="o">.</span><span class="n">abscissa_vals</span><span class="p">,</span> <span class="n">posxy</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newLapThreshold</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>

<span class="n">outbound_epochs</span><span class="p">,</span> <span class="n">inbound_epochs</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>(&lt;EpochArray at 0x7f8f648e4950: 42 epochs&gt; of length 17:07:964 minutes,
 &lt;EpochArray at 0x7f8f648e5220: 43 epochs&gt; of length 17:17:974 minutes)
</code></pre></div>
<h3 id="section-32-prepare-data-for-decoding">Section 3.2: Prepare Data for Decoding<a class="headerlink" href="#section-32-prepare-data-for-decoding" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">bst_trials_inbound</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">BIN_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">BIN_SIZE</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">outbound_epochs</span>
<span class="p">]</span>
<span class="n">bst_trials_outbound</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">BIN_SIZE</span><span class="p">)</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">BIN_SIZE</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inbound_epochs</span>
<span class="p">]</span>
<span class="n">bst_trials</span> <span class="o">=</span> <span class="n">bst_trials_inbound</span> <span class="o">+</span> <span class="n">bst_trials_outbound</span>
<span class="n">nsv_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bst_trials</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">pos_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">posxy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">bst</span><span class="o">.</span><span class="n">bin_centers</span><span class="p">)</span><span class="o">.</span><span class="n">yvals</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bst</span> <span class="ow">in</span> <span class="n">bst_trials</span>
    <span class="p">],</span>
    <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Format partitions for the decoder pipeline</span>
<span class="n">fold_indices</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span>
    <span class="n">nsv_trials</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">nsv_trials</span><span class="p">)),</span> <span class="mf">0.6</span>
<span class="p">)</span>
<span class="n">partition_indices</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">partition_indices</span><span class="p">(</span><span class="n">fold_indices</span><span class="p">)</span>
<span class="n">partitions</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">partition_sets</span><span class="p">(</span>
    <span class="n">partition_indices</span><span class="p">,</span> <span class="n">nsv_trials</span><span class="p">,</span> <span class="n">pos_trials</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="section-33-train-linear-decoder">Section 3.3: Train Linear Decoder<a class="headerlink" href="#section-33-train-linear-decoder" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">bv_test_pred_ridge</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nsv_train</span><span class="p">,</span> <span class="n">bv_train</span><span class="p">,</span> <span class="n">nsv_val</span><span class="p">,</span> <span class="n">bv_val</span><span class="p">,</span> <span class="n">nsv_test</span><span class="p">,</span> <span class="n">bv_test</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
    <span class="n">ridge</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">linear_model</span><span class="o">.</span><span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_train</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_train</span><span class="p">))</span>
    <span class="n">bv_test_pred</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_test</span><span class="p">))</span>
    <span class="n">bv_test_pred_ridge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bv_test_pred</span><span class="p">)</span>

<span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># x dimension is only where linear track extends</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_ridge</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.5948557053710475
</code></pre></div>
<h3 id="section-34-train-bayesian-dnn-decoders">Section 3.4: Train Bayesian &amp; DNN Decoders<a class="headerlink" href="#section-34-train-bayesian-dnn-decoders" title="Permanent link">&para;</a></h3>
<h4 id="section-341-bayesian-decoder">Section 3.4.1: Bayesian Decoder<a class="headerlink" href="#section-341-bayesian-decoder" title="Permanent link">&para;</a></h4>
<p>Train a Bayesian decoder using spatial tuning curves for comparison.</p>
<p>Again, note that the spatial maps are created using data both in training &amp; test
sets.</p>
<div class="highlight"><pre><span></span><code><span class="n">spatial_maps</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">tuning</span><span class="o">.</span><span class="n">SpatialMap</span><span class="p">(</span>
    <span class="n">posxy</span><span class="p">[</span><span class="n">inbound_epochs</span> <span class="o">+</span> <span class="n">outbound_epochs</span><span class="p">],</span>
    <span class="n">st</span><span class="p">[</span><span class="n">inbound_epochs</span> <span class="o">+</span> <span class="n">outbound_epochs</span><span class="p">],</span>
    <span class="n">s_binsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">speed_thres</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">tuning_curve_sigma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">place_field_min_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">place_field_max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">place_field_sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">bv_test_pred_bayesian</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">nsv_test</span><span class="p">,</span> <span class="n">bv_test</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">:</span>
    <span class="n">posterior_prob</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">bayesian</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">nsv_test</span><span class="p">),</span>
        <span class="n">spatial_maps</span><span class="o">.</span><span class="n">ratemap</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">spatial_maps</span><span class="o">.</span><span class="n">occupancy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
        <span class="n">BIN_SIZE</span><span class="p">,</span>
        <span class="n">uniform_prior</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bv_test_pred</span> <span class="o">=</span> <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">position_estimator</span><span class="p">(</span>
        <span class="n">posterior_prob</span><span class="p">,</span>
        <span class="n">spatial_maps</span><span class="o">.</span><span class="n">ybin_centers</span><span class="p">,</span>
        <span class="n">spatial_maps</span><span class="o">.</span><span class="n">xbin_centers</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;com&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">bv_test_pred_bayesian</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bv_test_pred</span><span class="p">)</span>

<span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">])[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_bayesian</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>0.8166878189807462
</code></pre></div>
<h4 id="section-342-train-and-evaluate-the-dnn-decoder">Section 3.4.2: Train and Evaluate the DNN Decoder<a class="headerlink" href="#section-342-train-and-evaluate-the-dnn-decoder" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">decoder_type</span> <span class="o">=</span> <span class="s2">&quot;MLP&quot;</span>  <span class="c1"># Select decoder type (e.g., MLP)</span>
<span class="n">hyperparams</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">decoder_type</span><span class="p">,</span>
    <span class="n">model_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">in_dim</span><span class="o">=</span><span class="n">nsv_trials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">out_dim</span><span class="o">=</span><span class="n">pos_trials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">hidden_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
        <span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">clf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">activations</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">CELU</span><span class="p">,</span>
            <span class="n">criterion</span><span class="o">=</span><span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">lr</span><span class="o">=</span><span class="mf">3e-2</span><span class="p">,</span>
            <span class="n">base_lr</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">max_grad_norm</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">iters_to_accumulate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
            <span class="n">num_training_batches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">scheduler_step_size_multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">behaviors</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">bins_before</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">bins_current</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">bins_after</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">accelerator</span><span class="o">=</span><span class="n">DEVICE</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Train the model using the pipeline function from your decoder module</span>
<span class="n">results_path</span> <span class="o">=</span> <span class="s2">&quot;results&quot;</span>
<span class="n">bv_preds_folds</span><span class="p">,</span> <span class="n">bv_models_folds</span><span class="p">,</span> <span class="n">norm_params_folds</span><span class="p">,</span> <span class="n">metrics_folds</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">npy</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">decoding</span><span class="o">.</span><span class="n">train_model</span><span class="p">(</span><span class="n">partitions</span><span class="p">,</span> <span class="n">hyperparams</span><span class="p">,</span> <span class="n">resultspath</span><span class="o">=</span><span class="n">results_path</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   255 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 255 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 255 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 1                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 9                                                                                           
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=40` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">     515.2560424804688     </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/318615455 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.8346841508628151
RMSE: 19.266750273530764
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   255 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 255 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 255 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 1                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 9                                                                                           
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=40` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">     1175.678955078125     </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/318615455 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.6017460518897958
RMSE: 30.17087822870876
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   255 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 255 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 255 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 1                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 9                                                                                           
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=40` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">    1022.5718994140625     </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/318615455 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.6983266026682143
RMSE: 26.115756787548765
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   255 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 255 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 255 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 1                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 9                                                                                           
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=40` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">     474.7945556640625     </span>

</pre>

<div class="highlight"><pre><span></span><code>Seed set to 2025
Trainer will use only 1 of 2 GPUs because it is running inside an interactive / notebook environment. You may try to set `Trainer(devices=2)` but please note that multi-GPU inside interactive / notebook environments is considered experimental and unstable. Your mileage may vary.
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/fabric/plugins/environments/slurm.py:204: The `srun` command is available on your system but is not used. HINT: If your intention is to run Lightning on SLURM, prepend your python command with `srun` like so: srun python /home/kg574/.local/lib/python3.12/site-packages/ipyk ...
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/callbacks/model_checkpoint.py:881: Checkpoint directory /local/storage/kg574/dependencies/python/neuro_py/tutorials/results/models/318615455 exists and is not empty.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]


Variance weighed avg. coefficient of determination: 0.86034026273691
RMSE: 18.66099073724503
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">   </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Name </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Type       </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Params </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> Mode  </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> FLOPs </span>

<span style="color: #7f7f7f; text-decoration-color: #7f7f7f"> 0 </span> main  Sequential   255 K  train      0 

</pre>

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Trainable params</span>: 255 K                                                                                            
<span style="font-weight: bold">Non-trainable params</span>: 0                                                                                            
<span style="font-weight: bold">Total params</span>: 255 K                                                                                                
<span style="font-weight: bold">Total estimated model params size (MB)</span>: 1                                                                          
<span style="font-weight: bold">Modules in train mode</span>: 9                                                                                           
<span style="font-weight: bold">Modules in eval mode</span>: 0                                                                                            
<span style="font-weight: bold">Total FLOPs</span>: 0                                                                                                     
</pre>

<div class="highlight"><pre><span></span><code>/local/storage/kg574/programs/miniforge3/envs/cmc/lib/python3.12/site-packages/lightning/pytorch/utilities/_pytree.py:21: `isinstance(treespec, LeafSpec)` is deprecated, use `isinstance(treespec, TreeSpec) and treespec.is_leaf()` instead.
`Trainer.fit` stopped: `max_epochs=40` reached.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1]
</code></pre></div>
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
<span style="font-weight: bold">        Test metric        </span><span style="font-weight: bold">       DataLoader 0        </span>

<span style="color: #008080; text-decoration-color: #008080">         test_loss         </span><span style="color: #800080; text-decoration-color: #800080">    433.23321533203125     </span>

</pre>

<div class="highlight"><pre><span></span><code>Variance weighed avg. coefficient of determination: 0.8280856864439035
RMSE: 18.114129665695852
</code></pre></div>
<h3 id="section-35-visualize-results">Section 3.5: Visualize Results<a class="headerlink" href="#section-35-visualize-results" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">bv_preds_dnn_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
    <span class="n">bv_preds_fold</span> <span class="o">+</span> <span class="n">norm_params_folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;y_train_mean&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bv_preds_fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bv_preds_folds</span><span class="p">)</span>
<span class="p">])</span>
<span class="n">bv_preds_bayesian_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">bv_test_pred_bayesian</span><span class="p">)</span>
<span class="n">bv_actual_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span><span class="p">])</span>
<span class="n">trial_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partitions</span> <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">trial_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">trial_lengths</span><span class="p">)</span>

<span class="n">bv_preds_dnn_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_preds_dnn_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bv_preds_bayesian_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_preds_bayesian_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">bv_actual_trials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bv_actual_trials</span><span class="p">,</span> <span class="n">trial_indices</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># Use the generalized visualization function</span>
<span class="n">predictions_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Bayesian&quot;</span><span class="p">:</span> <span class="n">bv_preds_bayesian_trials</span><span class="p">,</span>
    <span class="n">decoder_type</span><span class="p">:</span> <span class="n">bv_preds_dnn_trials</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">create_trial_visualization_widget</span><span class="p">(</span>
    <span class="n">actual_trials</span><span class="o">=</span><span class="n">bv_actual_trials</span><span class="p">,</span>
    <span class="n">predictions</span><span class="o">=</span><span class="n">predictions_dict</span><span class="p">,</span>
<span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>interactive(children=(IntSlider(value=0, description=&#39;trial&#39;, max=84), Output()), _dom_classes=(&#39;widget-intera
</code></pre></div>
<hr />














                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-circle-arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../bias_correlation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Bias Correlation">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-left" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7M19 12H5"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Bias Correlation
              </div>
            </div>
          </a>
        
        
          
          <a href="../explained_variance/" class="md-footer__link md-footer__link--next" aria-label="Next: Explained Variance">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Explained Variance
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-right" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../..","features":["announce.dismiss","content.action.edit","content.action.view","content.code.annotate","content.code.copy","content.tooltips","content.tabs.link","navigation.footer","navigation.indexes","navigation.instant.prefetch","navigation.instant.preview","navigation.instant.progress","navigation.path","navigation.tabs","navigation.tabs.sticky","navigation.top","navigation.tracking","search.highlight","search.suggest","toc.follow"],"search":"../../assets/javascripts/workers/search.e2d2d235.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../../assets/javascripts/bundle.5fcf0de6.min.js"></script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>