<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../detectors/ rel=prev><link href=../io/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>neuro_py.ensemble - neuro_py</title><link rel=stylesheet href=../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#neuro_py.ensemble class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=neuro_py class="md-header__button md-logo" aria-label=neuro_py data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> neuro_py </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> neuro_py.ensemble </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=light data-md-color-primary=custom data-md-color-accent=custom aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ryanharvey1/neuro_py title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ryanharvey1/neuro_py </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/attractor_landscape/ class=md-tabs__link> Tutorials </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=neuro_py class="md-nav__button md-logo" aria-label=neuro_py data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> neuro_py </label> <div class=md-nav__source> <a href=https://github.com/ryanharvey1/neuro_py title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ryanharvey1/neuro_py </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> API Reference </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> behavior </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> behavior </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../behavior/cheeseboard/ class=md-nav__link> <span class=md-ellipsis> cheeseboard </span> </a> </li> <li class=md-nav__item> <a href=../behavior/circle_maze/ class=md-nav__link> <span class=md-ellipsis> circle_maze </span> </a> </li> <li class=md-nav__item> <a href=../behavior/get_trials/ class=md-nav__link> <span class=md-ellipsis> get_trials </span> </a> </li> <li class=md-nav__item> <a href=../behavior/kinematics/ class=md-nav__link> <span class=md-ellipsis> kinematics </span> </a> </li> <li class=md-nav__item> <a href=../behavior/linear_positions/ class=md-nav__link> <span class=md-ellipsis> linear_positions </span> </a> </li> <li class=md-nav__item> <a href=../behavior/linearization/ class=md-nav__link> <span class=md-ellipsis> linearization </span> </a> </li> <li class=md-nav__item> <a href=../behavior/linearization_pipeline/ class=md-nav__link> <span class=md-ellipsis> linearization_pipeline </span> </a> </li> <li class=md-nav__item> <a href=../behavior/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../behavior/well_traversal_classification/ class=md-nav__link> <span class=md-ellipsis> well_traversal_classification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> detectors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> detectors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../detectors/dentate_spike/ class=md-nav__link> <span class=md-ellipsis> dentate_spike </span> </a> </li> <li class=md-nav__item> <a href=../detectors/up_down_state/ class=md-nav__link> <span class=md-ellipsis> up_down_state </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <div class="md-nav__link md-nav__container"> <a href=decoding/ class="md-nav__link "> <span class=md-ellipsis> ensemble </span> </a> <label class="md-nav__link " for=__nav_2_4 id=__nav_2_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> ensemble </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=assembly/ class=md-nav__link> <span class=md-ellipsis> assembly </span> </a> </li> <li class=md-nav__item> <a href=assembly_reactivation/ class=md-nav__link> <span class=md-ellipsis> assembly_reactivation </span> </a> </li> <li class=md-nav__item> <a href=dynamics/ class=md-nav__link> <span class=md-ellipsis> dynamics </span> </a> </li> <li class=md-nav__item> <a href=explained_variance/ class=md-nav__link> <span class=md-ellipsis> explained_variance </span> </a> </li> <li class=md-nav__item> <a href=geometry/ class=md-nav__link> <span class=md-ellipsis> geometry </span> </a> </li> <li class=md-nav__item> <a href=pairwise_bias_correlation/ class=md-nav__link> <span class=md-ellipsis> pairwise_bias_correlation </span> </a> </li> <li class=md-nav__item> <a href=replay/ class=md-nav__link> <span class=md-ellipsis> replay </span> </a> </li> <li class=md-nav__item> <a href=similarity_index/ class=md-nav__link> <span class=md-ellipsis> similarity_index </span> </a> </li> <li class=md-nav__item> <a href=similaritymat/ class=md-nav__link> <span class=md-ellipsis> similaritymat </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex> <span class=md-ellipsis> decoding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> decoding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=decoding/bayesian/ class=md-nav__link> <span class=md-ellipsis> bayesian </span> </a> </li> <li class=md-nav__item> <a href=decoding/lstm/ class=md-nav__link> <span class=md-ellipsis> lstm </span> </a> </li> <li class=md-nav__item> <a href=decoding/m2mlstm/ class=md-nav__link> <span class=md-ellipsis> m2mlstm </span> </a> </li> <li class=md-nav__item> <a href=decoding/mlp/ class=md-nav__link> <span class=md-ellipsis> mlp </span> </a> </li> <li class=md-nav__item> <a href=decoding/pipeline/ class=md-nav__link> <span class=md-ellipsis> pipeline </span> </a> </li> <li class=md-nav__item> <a href=decoding/preprocess/ class=md-nav__link> <span class=md-ellipsis> preprocess </span> </a> </li> <li class=md-nav__item> <a href=decoding/transformer/ class=md-nav__link> <span class=md-ellipsis> transformer </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex> <span class=md-ellipsis> io </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> io </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../io/loading/ class=md-nav__link> <span class=md-ellipsis> loading </span> </a> </li> <li class=md-nav__item> <a href=../io/saving/ class=md-nav__link> <span class=md-ellipsis> saving </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex> <span class=md-ellipsis> lfp </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> lfp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lfp/CSD/ class=md-nav__link> <span class=md-ellipsis> CSD </span> </a> </li> <li class=md-nav__item> <a href=../lfp/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../lfp/spectral/ class=md-nav__link> <span class=md-ellipsis> spectral </span> </a> </li> <li class=md-nav__item> <a href=../lfp/theta_cycles/ class=md-nav__link> <span class=md-ellipsis> theta_cycles </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex> <span class=md-ellipsis> plotting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> plotting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plotting/decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../plotting/events/ class=md-nav__link> <span class=md-ellipsis> events </span> </a> </li> <li class=md-nav__item> <a href=../plotting/figure_helpers/ class=md-nav__link> <span class=md-ellipsis> figure_helpers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex> <span class=md-ellipsis> process </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> process </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../process/batch_analysis/ class=md-nav__link> <span class=md-ellipsis> batch_analysis </span> </a> </li> <li class=md-nav__item> <a href=../process/correlations/ class=md-nav__link> <span class=md-ellipsis> correlations </span> </a> </li> <li class=md-nav__item> <a href=../process/intervals/ class=md-nav__link> <span class=md-ellipsis> intervals </span> </a> </li> <li class=md-nav__item> <a href=../process/peri_event/ class=md-nav__link> <span class=md-ellipsis> peri_event </span> </a> </li> <li class=md-nav__item> <a href=../process/precession_utils/ class=md-nav__link> <span class=md-ellipsis> precession_utils </span> </a> </li> <li class=md-nav__item> <a href=../process/pychronux/ class=md-nav__link> <span class=md-ellipsis> pychronux </span> </a> </li> <li class=md-nav__item> <a href=../process/utils/ class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_10> <label class=md-nav__link for=__nav_2_10 id=__nav_2_10_label tabindex> <span class=md-ellipsis> raw </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_10_label aria-expanded=false> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> raw </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../raw/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../raw/spike_sorting/ class=md-nav__link> <span class=md-ellipsis> spike_sorting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_11> <label class=md-nav__link for=__nav_2_11 id=__nav_2_11_label tabindex> <span class=md-ellipsis> session </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_11_label aria-expanded=false> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> session </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../session/locate_epochs/ class=md-nav__link> <span class=md-ellipsis> locate_epochs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_12> <label class=md-nav__link for=__nav_2_12 id=__nav_2_12_label tabindex> <span class=md-ellipsis> spikes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> spikes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../spikes/spike_tools/ class=md-nav__link> <span class=md-ellipsis> spike_tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_13> <label class=md-nav__link for=__nav_2_13 id=__nav_2_13_label tabindex> <span class=md-ellipsis> stats </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> stats </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../stats/circ_stats/ class=md-nav__link> <span class=md-ellipsis> circ_stats </span> </a> </li> <li class=md-nav__item> <a href=../stats/regression/ class=md-nav__link> <span class=md-ellipsis> regression </span> </a> </li> <li class=md-nav__item> <a href=../stats/stats/ class=md-nav__link> <span class=md-ellipsis> stats </span> </a> </li> <li class=md-nav__item> <a href=../stats/system_identifier/ class=md-nav__link> <span class=md-ellipsis> system_identifier </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_14> <label class=md-nav__link for=__nav_2_14 id=__nav_2_14_label tabindex> <span class=md-ellipsis> tuning </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> tuning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../tuning/fields/ class=md-nav__link> <span class=md-ellipsis> fields </span> </a> </li> <li class=md-nav__item> <a href=../tuning/maps/ class=md-nav__link> <span class=md-ellipsis> maps </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_15> <label class=md-nav__link for=__nav_2_15 id=__nav_2_15_label tabindex> <span class=md-ellipsis> util </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_15_label aria-expanded=false> <label class=md-nav__title for=__nav_2_15> <span class="md-nav__icon md-icon"></span> util </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../util/array/ class=md-nav__link> <span class=md-ellipsis> array </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/attractor_landscape/ class=md-nav__link> <span class=md-ellipsis> Attractor Estimation </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/batch_analysis/ class=md-nav__link> <span class=md-ellipsis> Batch Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/bias_correlation/ class=md-nav__link> <span class=md-ellipsis> Bias Correlation </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/explained_variance/ class=md-nav__link> <span class=md-ellipsis> Explained Variance </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/decoding/ class=md-nav__link> <span class=md-ellipsis> Neural Decoding </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/neural_geodynamics/ class=md-nav__link> <span class=md-ellipsis> Neural Geodynamics </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/peth_tutorial/ class=md-nav__link> <span class=md-ellipsis> PETH </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/reactivation/ class=md-nav__link> <span class=md-ellipsis> Reactivation </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/spatial_map/ class=md-nav__link> <span class=md-ellipsis> Spatial Map </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#neuro_py.ensemble class=md-nav__link> <span class=md-ellipsis> ensemble </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact class=md-nav__link> <span class=md-ellipsis> AssemblyReact </span> </a> <nav class=md-nav aria-label=AssemblyReact> <ul class=md-nav__list> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.isempty class=md-nav__link> <span class=md-ellipsis> isempty </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.copy class=md-nav__link> <span class=md-ellipsis> copy </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.find_members class=md-nav__link> <span class=md-ellipsis> find_members </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.get_assembly_act class=md-nav__link> <span class=md-ellipsis> get_assembly_act </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.get_weights class=md-nav__link> <span class=md-ellipsis> get_weights </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.get_z_mat class=md-nav__link> <span class=md-ellipsis> get_z_mat </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.load_data class=md-nav__link> <span class=md-ellipsis> load_data </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.load_epoch class=md-nav__link> <span class=md-ellipsis> load_epoch </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.load_ripples class=md-nav__link> <span class=md-ellipsis> load_ripples </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.load_spikes class=md-nav__link> <span class=md-ellipsis> load_spikes </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.n_assemblies class=md-nav__link> <span class=md-ellipsis> n_assemblies </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.plot class=md-nav__link> <span class=md-ellipsis> plot </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.restrict_epochs_to_pre_task_post class=md-nav__link> <span class=md-ellipsis> restrict_epochs_to_pre_task_post </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.AssemblyReact.restrict_to_epoch class=md-nav__link> <span class=md-ellipsis> restrict_to_epoch </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance class=md-nav__link> <span class=md-ellipsis> ExplainedVariance </span> </a> <nav class=md-nav aria-label=ExplainedVariance> <ul class=md-nav__list> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance--load-data class=md-nav__link> <span class=md-ellipsis> Load data </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance--most-simple-case-returns-single-explained-variance-value class=md-nav__link> <span class=md-ellipsis> Most simple case, returns single explained variance value </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance--get-time-resolved-explained-variance-across-entire-session-in-200sec-bins class=md-nav__link> <span class=md-ellipsis> Get time resolved explained variance across entire session in 200sec bins </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance--get-time-resolved-explained-variance-across-entire-session-in-200sec-bins-sliding-by-100sec class=md-nav__link> <span class=md-ellipsis> Get time resolved explained variance across entire session in 200sec bins sliding by 100sec </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance.ev_signal class=md-nav__link> <span class=md-ellipsis> ev_signal </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance.rev_signal class=md-nav__link> <span class=md-ellipsis> rev_signal </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance.plot class=md-nav__link> <span class=md-ellipsis> plot </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.ExplainedVariance.pvalue class=md-nav__link> <span class=md-ellipsis> pvalue </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias class=md-nav__link> <span class=md-ellipsis> PairwiseBias </span> </a> <nav class=md-nav aria-label=PairwiseBias> <ul class=md-nav__list> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.bias_matrix class=md-nav__link> <span class=md-ellipsis> bias_matrix </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.cosine_similarity_matrices class=md-nav__link> <span class=md-ellipsis> cosine_similarity_matrices </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.fit class=md-nav__link> <span class=md-ellipsis> fit </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.fit_transform class=md-nav__link> <span class=md-ellipsis> fit_transform </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.observed_and_shuffled_correlation class=md-nav__link> <span class=md-ellipsis> observed_and_shuffled_correlation </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.PairwiseBias.transform class=md-nav__link> <span class=md-ellipsis> transform </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.WeightedCorr class=md-nav__link> <span class=md-ellipsis> WeightedCorr </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.WeightedCorrCirc class=md-nav__link> <span class=md-ellipsis> WeightedCorrCirc </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.binshuffling class=md-nav__link> <span class=md-ellipsis> binshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.bottom_up_replay_detection class=md-nav__link> <span class=md-ellipsis> bottom_up_replay_detection </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.circshuffling class=md-nav__link> <span class=md-ellipsis> circshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.computeAssemblyActivity class=md-nav__link> <span class=md-ellipsis> computeAssemblyActivity </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.cosine_similarity class=md-nav__link> <span class=md-ellipsis> cosine_similarity </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.cosine_similarity_matrices class=md-nav__link> <span class=md-ellipsis> cosine_similarity_matrices </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.extractPatterns class=md-nav__link> <span class=md-ellipsis> extractPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.getlambdacontrol class=md-nav__link> <span class=md-ellipsis> getlambdacontrol </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.marcenkopastur class=md-nav__link> <span class=md-ellipsis> marcenkopastur </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.observed_and_shuffled_correlation class=md-nav__link> <span class=md-ellipsis> observed_and_shuffled_correlation </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.position_estimator class=md-nav__link> <span class=md-ellipsis> position_estimator </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.potential_landscape class=md-nav__link> <span class=md-ellipsis> potential_landscape </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.potential_landscape_nd class=md-nav__link> <span class=md-ellipsis> potential_landscape_nd </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.proximity class=md-nav__link> <span class=md-ellipsis> proximity </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.runPatterns class=md-nav__link> <span class=md-ellipsis> runPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.runSignificance class=md-nav__link> <span class=md-ellipsis> runSignificance </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.shuffle_and_score class=md-nav__link> <span class=md-ellipsis> shuffle_and_score </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.shuffled_significance class=md-nav__link> <span class=md-ellipsis> shuffled_significance </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.skew_bias_matrix class=md-nav__link> <span class=md-ellipsis> skew_bias_matrix </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.toyExample class=md-nav__link> <span class=md-ellipsis> toyExample </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.trajectory_score_bst class=md-nav__link> <span class=md-ellipsis> trajectory_score_bst </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.weighted_corr_2d class=md-nav__link> <span class=md-ellipsis> weighted_corr_2d </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.weighted_correlation class=md-nav__link> <span class=md-ellipsis> weighted_correlation </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../.. class=md-path__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-path__item> <a href=../behavior/ class=md-path__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-path__item> <a href=../behavior/ class=md-path__link> <span class=md-ellipsis> neuro_py </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <a href=https://github.com/ryanharvey1/neuro_py/edit/main/docs/neuro_py/ensemble/__init__.py title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/ryanharvey1/neuro_py/raw/main/docs/neuro_py/ensemble/__init__.py title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1> ensemble</h1> <div class="doc doc-object doc-module"> <a id=neuro_py.ensemble></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=neuro_py.ensemble.AssemblyReact class="doc doc-heading"> <code>AssemblyReact</code> </h2> <div class="doc doc-contents "> <p>Class for running assembly reactivation analysis</p> <p>Core assembly methods come from assembly.py by VÃ­tor Lopes dos Santos https://doi.org/10.1016/j.jneumeth.2013.04.010</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>basepath</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Path to the session folder</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>brainRegion</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Brain region to restrict to. Can be multi ex. "CA1|CA2"</p> </div> </td> <td> <code>&#39;CA1&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>putativeCellType</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Cell type to restrict to</p> </div> </td> <td> <code>&#39;Pyramidal Cell&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>weight_dt</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time resolution of the weight matrix</p> </div> </td> <td> <code>0.025</code> </td> </tr> <tr class=doc-section-item> <td> <code>z_mat_dt</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Time resolution of the z matrix</p> </div> </td> <td> <code>0.002</code> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Defines how to extract assembly patterns (ica,pca).</p> </div> </td> <td> <code>&#39;ica&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nullhyp</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Defines how to generate statistical threshold for assembly detection (bin,circ,mp).</p> </div> </td> <td> <code>&#39;mp&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nshu</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffles for bin and circ null hypothesis.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>percentile</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Percentile for mp null hypothesis.</p> </div> </td> <td> <code>99</code> </td> </tr> <tr class=doc-section-item> <td> <code>tracywidom</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If true, uses Tracy-Widom distribution for mp null hypothesis.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A categorical vector indicating group membership for each neuron. If provided, the function will strictly detect cross-structural assemblies (correlations within the same group will be ignored). Should have the same length as the number of neurons in the spike train.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.AssemblyReact.st>st</span></code></td> <td> <code><span title=nelpy.SpikeTrainArray>SpikeTrainArray</span></code> </td> <td> <div class=doc-md-description> <p>Spike train</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.AssemblyReact.cell_metrics>cell_metrics</span></code></td> <td> <code><span title=pandas.DataFrame>DataFrame</span></code> </td> <td> <div class=doc-md-description> <p>Cell metrics</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.AssemblyReact.ripples>ripples</span></code></td> <td> <code><span title=nelpy.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>Ripples</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.AssemblyReact.patterns>patterns</span></code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Assembly patterns</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.AssemblyReact.assembly_act>assembly_act</span></code></td> <td> <code><span title=nelpy.AnalogSignalArray>AnalogSignalArray</span></code> </td> <td> <div class=doc-md-description> <p>Assembly activity</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Methods:</span></p> <table> <thead> <tr> <th>Name</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.load_data>load_data</a></code></td> <td> <div class=doc-md-description> <p>Load data (st, ripples, epochs)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.restrict_to_epoch>restrict_to_epoch</a></code></td> <td> <div class=doc-md-description> <p>Restrict to a specific epoch</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.get_z_mat>get_z_mat</a></code></td> <td> <div class=doc-md-description> <p>Get z matrix</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.get_weights>get_weights</a></code></td> <td> <div class=doc-md-description> <p>Get assembly weights</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.get_assembly_act>get_assembly_act</a></code></td> <td> <div class=doc-md-description> <p>Get assembly activity</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.n_assemblies>n_assemblies</a></code></td> <td> <div class=doc-md-description> <p>Number of detected assemblies</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.isempty>isempty</a></code></td> <td> <div class=doc-md-description> <p>Check if empty</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.copy>copy</a></code></td> <td> <div class=doc-md-description> <p>Returns copy of class</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.plot>plot</a></code></td> <td> <div class=doc-md-description> <p>Stem plot of assembly weights</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.AssemblyReact.find_members>find_members</a></code></td> <td> <div class=doc-md-description> <p>Find members of an assembly</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># create the object assembly_react</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react</span> <span class=o>=</span> <span class=n>assembly_reactivation</span><span class=o>.</span><span class=n>AssemblyReact</span><span class=p>(</span>
<span class=gp>... </span>   <span class=n>basepath</span><span class=o>=</span><span class=n>basepath</span><span class=p>,</span>
<span class=gp>... </span>   <span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># load need data (spikes, ripples, epochs)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react</span><span class=o>.</span><span class=n>load_data</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># detect assemblies</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react</span><span class=o>.</span><span class=n>get_weights</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># visually inspect weights for each assembly</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># compute time resolved signal for each assembly</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_act</span> <span class=o>=</span> <span class=n>assembly_react</span><span class=o>.</span><span class=n>get_assembly_act</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># locate members of assemblies</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_members</span> <span class=o>=</span> <span class=n>assembly_react</span><span class=o>.</span><span class=n>find_members</span><span class=p>()</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=c1># Example: Cross-structural assemblies between CA1 and CA3</span>
<span class=gp>&gt;&gt;&gt; </span><span class=c1># Assuming you have neurons from both regions</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>cross_groups</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=s1>&#39;CA1&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>50</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;CA3&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>30</span><span class=p>)</span>  <span class=c1># 50 CA1, 30 CA3 neurons</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react_cross</span> <span class=o>=</span> <span class=n>assembly_reactivation</span><span class=o>.</span><span class=n>AssemblyReact</span><span class=p>(</span>
<span class=gp>... </span>   <span class=n>basepath</span><span class=o>=</span><span class=n>basepath</span><span class=p>,</span>
<span class=gp>... </span>   <span class=n>cross_structural</span><span class=o>=</span><span class=n>cross_groups</span>
<span class=gp>... </span>   <span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react_cross</span><span class=o>.</span><span class=n>load_data</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>assembly_react_cross</span><span class=o>.</span><span class=n>get_weights</span><span class=p>()</span>  <span class=c1># Will only detect cross-regional assemblies</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>AssemblyReact</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Class for running assembly reactivation analysis</span>

<span class=sd>    Core assembly methods come from assembly.py by VÃ­tor Lopes dos Santos</span>
<span class=sd>        https://doi.org/10.1016/j.jneumeth.2013.04.010</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    basepath : str</span>
<span class=sd>        Path to the session folder</span>
<span class=sd>    brainRegion : str</span>
<span class=sd>        Brain region to restrict to. Can be multi ex. &quot;CA1|CA2&quot;</span>
<span class=sd>    putativeCellType : str</span>
<span class=sd>        Cell type to restrict to</span>
<span class=sd>    weight_dt : float</span>
<span class=sd>        Time resolution of the weight matrix</span>
<span class=sd>    z_mat_dt : float</span>
<span class=sd>        Time resolution of the z matrix</span>
<span class=sd>    method : str</span>
<span class=sd>        Defines how to extract assembly patterns (ica,pca).</span>
<span class=sd>    nullhyp : str</span>
<span class=sd>        Defines how to generate statistical threshold for assembly detection (bin,circ,mp).</span>
<span class=sd>    nshu : int</span>
<span class=sd>        Number of shuffles for bin and circ null hypothesis.</span>
<span class=sd>    percentile : int</span>
<span class=sd>        Percentile for mp null hypothesis.</span>
<span class=sd>    tracywidom : bool</span>
<span class=sd>        If true, uses Tracy-Widom distribution for mp null hypothesis.</span>
<span class=sd>    cross_structural : np.ndarray, optional</span>
<span class=sd>        A categorical vector indicating group membership for each neuron.</span>
<span class=sd>        If provided, the function will strictly detect cross-structural assemblies</span>
<span class=sd>        (correlations within the same group will be ignored). Should have the same</span>
<span class=sd>        length as the number of neurons in the spike train.</span>

<span class=sd>    Attributes</span>
<span class=sd>    ----------</span>
<span class=sd>    st : nelpy.SpikeTrainArray</span>
<span class=sd>        Spike train</span>
<span class=sd>    cell_metrics : pd.DataFrame</span>
<span class=sd>        Cell metrics</span>
<span class=sd>    ripples : nelpy.EpochArray</span>
<span class=sd>        Ripples</span>
<span class=sd>    patterns : np.ndarray</span>
<span class=sd>        Assembly patterns</span>
<span class=sd>    assembly_act : nelpy.AnalogSignalArray</span>
<span class=sd>        Assembly activity</span>

<span class=sd>    Methods</span>
<span class=sd>    -------</span>
<span class=sd>    load_data()</span>
<span class=sd>        Load data (st, ripples, epochs)</span>
<span class=sd>    restrict_to_epoch(epoch)</span>
<span class=sd>        Restrict to a specific epoch</span>
<span class=sd>    get_z_mat(st)</span>
<span class=sd>        Get z matrix</span>
<span class=sd>    get_weights(epoch=None)</span>
<span class=sd>        Get assembly weights</span>
<span class=sd>    get_assembly_act(epoch=None)</span>
<span class=sd>        Get assembly activity</span>
<span class=sd>    n_assemblies()</span>
<span class=sd>        Number of detected assemblies</span>
<span class=sd>    isempty()</span>
<span class=sd>        Check if empty</span>
<span class=sd>    copy()</span>
<span class=sd>        Returns copy of class</span>
<span class=sd>    plot()</span>
<span class=sd>        Stem plot of assembly weights</span>
<span class=sd>    find_members()</span>
<span class=sd>        Find members of an assembly</span>


<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; # create the object assembly_react</span>
<span class=sd>    &gt;&gt;&gt; assembly_react = assembly_reactivation.AssemblyReact(</span>
<span class=sd>    ...    basepath=basepath,</span>
<span class=sd>    ...    )</span>

<span class=sd>    &gt;&gt;&gt; # load need data (spikes, ripples, epochs)</span>
<span class=sd>    &gt;&gt;&gt; assembly_react.load_data()</span>

<span class=sd>    &gt;&gt;&gt; # detect assemblies</span>
<span class=sd>    &gt;&gt;&gt; assembly_react.get_weights()</span>

<span class=sd>    &gt;&gt;&gt; # visually inspect weights for each assembly</span>
<span class=sd>    &gt;&gt;&gt; assembly_react.plot()</span>

<span class=sd>    &gt;&gt;&gt; # compute time resolved signal for each assembly</span>
<span class=sd>    &gt;&gt;&gt; assembly_act = assembly_react.get_assembly_act()</span>

<span class=sd>    &gt;&gt;&gt; # locate members of assemblies</span>
<span class=sd>    &gt;&gt;&gt; assembly_members = assembly_react.find_members()</span>

<span class=sd>    &gt;&gt;&gt; # Example: Cross-structural assemblies between CA1 and CA3</span>
<span class=sd>    &gt;&gt;&gt; # Assuming you have neurons from both regions</span>
<span class=sd>    &gt;&gt;&gt; cross_groups = np.array([&#39;CA1&#39;] * 50 + [&#39;CA3&#39;] * 30)  # 50 CA1, 30 CA3 neurons</span>
<span class=sd>    &gt;&gt;&gt; assembly_react_cross = assembly_reactivation.AssemblyReact(</span>
<span class=sd>    ...    basepath=basepath,</span>
<span class=sd>    ...    cross_structural=cross_groups</span>
<span class=sd>    ...    )</span>
<span class=sd>    &gt;&gt;&gt; assembly_react_cross.load_data()</span>
<span class=sd>    &gt;&gt;&gt; assembly_react_cross.get_weights()  # Will only detect cross-regional assemblies</span>

<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>basepath</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
        <span class=n>brainRegion</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;CA1&quot;</span><span class=p>,</span>
        <span class=n>putativeCellType</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;Pyramidal Cell&quot;</span><span class=p>,</span>
        <span class=n>weight_dt</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.025</span><span class=p>,</span>
        <span class=n>z_mat_dt</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.002</span><span class=p>,</span>
        <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;ica&quot;</span><span class=p>,</span>
        <span class=n>nullhyp</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;mp&quot;</span><span class=p>,</span>
        <span class=n>nshu</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
        <span class=n>percentile</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>99</span><span class=p>,</span>
        <span class=n>tracywidom</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>whiten</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unit-variance&quot;</span><span class=p>,</span>
        <span class=n>cross_structural</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>basepath</span> <span class=o>=</span> <span class=n>basepath</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>brainRegion</span> <span class=o>=</span> <span class=n>brainRegion</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>putativeCellType</span> <span class=o>=</span> <span class=n>putativeCellType</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span> <span class=o>=</span> <span class=n>weight_dt</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>z_mat_dt</span> <span class=o>=</span> <span class=n>z_mat_dt</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>method</span> <span class=o>=</span> <span class=n>method</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>=</span> <span class=n>nullhyp</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>nshu</span> <span class=o>=</span> <span class=n>nshu</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>percentile</span> <span class=o>=</span> <span class=n>percentile</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>tracywidom</span> <span class=o>=</span> <span class=n>tracywidom</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>whiten</span> <span class=o>=</span> <span class=n>whiten</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>cross_structural</span> <span class=o>=</span> <span class=n>cross_structural</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>type_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=vm>__name__</span>

    <span class=k>def</span><span class=w> </span><span class=nf>add_st</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>st</span><span class=p>:</span> <span class=n>nel</span><span class=o>.</span><span class=n>SpikeTrainArray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>st</span> <span class=o>=</span> <span class=n>st</span>

    <span class=k>def</span><span class=w> </span><span class=nf>add_ripples</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ripples</span><span class=p>:</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ripples</span> <span class=o>=</span> <span class=n>ripples</span>

    <span class=k>def</span><span class=w> </span><span class=nf>add_epoch_df</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch_df</span><span class=p>:</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>epoch_df</span>

    <span class=k>def</span><span class=w> </span><span class=nf>load_spikes</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        loads spikes from the session folder</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cell_metrics</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_spikes</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>,</span>
            <span class=n>brainRegion</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>brainRegion</span><span class=p>,</span>
            <span class=n>putativeCellType</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>putativeCellType</span><span class=p>,</span>
            <span class=n>support</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>load_ripples</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        loads ripples from the session folder</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>ripples</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_ripples_events</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ripples</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
            <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>ripples</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>ripples</span><span class=o>.</span><span class=n>stop</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span> <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        loads epochs from the session folder</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
        <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>compress_repeated_epochs</span><span class=p>(</span><span class=n>epoch_df</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>time_support</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
            <span class=p>[</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=n>epoch_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>stopTime</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
            <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=n>epoch_df</span><span class=o>.</span><span class=n>stopTime</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span>
            <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>epoch_df</span>

    <span class=k>def</span><span class=w> </span><span class=nf>load_data</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        loads data (spikes,ripples,epochs) from the session folder</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_spikes</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>load_ripples</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>restrict_epochs_to_pre_task_post</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Restricts the epochs to the specified epochs</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># fetch data</span>
        <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
        <span class=c1># compress back to back sleep epochs (an issue further up the pipeline)</span>
        <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>compress_repeated_epochs</span><span class=p>(</span><span class=n>epoch_df</span><span class=p>)</span>
        <span class=c1># restrict to pre task post epochs</span>
        <span class=n>idx</span> <span class=o>=</span> <span class=n>find_pre_task_post</span><span class=p>(</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>environment</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>epoch_df</span><span class=p>[</span><span class=n>idx</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
        <span class=c1># convert to epoch array and add to object</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
            <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>stopTime</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;session_epochs&quot;</span><span class=p>,</span>
            <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>restrict_to_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Restricts the spike data to a specific epoch.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        epoch : nel.EpochArray</span>
<span class=sd>            The epoch to restrict to.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>st_resticted</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>st</span><span class=p>:</span> <span class=n>nel</span><span class=o>.</span><span class=n>SpikeTrainArray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get z matrix.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        st : nel.SpikeTrainArray</span>
<span class=sd>            Spike train array.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Tuple[np.ndarray, np.ndarray]</span>
<span class=sd>            Z-scored binned spike train and bin centers.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># binning the spike train</span>
        <span class=n>z_t</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>z_mat_dt</span><span class=p>)</span>
        <span class=c1># gaussian kernel to match the bin-size used to identify the assembly patterns</span>
        <span class=n>sigma</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span>
        <span class=n>z_t</span><span class=o>.</span><span class=n>smooth</span><span class=p>(</span><span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=c1># zscore the z matrix</span>
        <span class=n>z_scored_bst</span> <span class=o>=</span> <span class=n>stats</span><span class=o>.</span><span class=n>zscore</span><span class=p>(</span><span class=n>z_t</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=c1># make sure there are no nans, important as strengths will all be nan otherwise</span>
        <span class=n>z_scored_bst</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>z_scored_bst</span><span class=p>)</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>

        <span class=k>return</span> <span class=n>z_scored_bst</span><span class=p>,</span> <span class=n>z_t</span><span class=o>.</span><span class=n>bin_centers</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_weights</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Gets the assembly weights.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        epoch : nel.EpochArray, optional</span>
<span class=sd>            The epoch to restrict to, by default None.</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=c1># check if st has any neurons</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>isempty</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=n>epoch</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>bst</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>]</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>bst</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>bst</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>():</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>patterns</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>assembly</span><span class=o>.</span><span class=n>runPatterns</span><span class=p>(</span>
                <span class=n>bst</span><span class=p>,</span>
                <span class=n>method</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
                <span class=n>nullhyp</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nullhyp</span><span class=p>,</span>
                <span class=n>nshu</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nshu</span><span class=p>,</span>
                <span class=n>percentile</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>percentile</span><span class=p>,</span>
                <span class=n>tracywidom</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tracywidom</span><span class=p>,</span>
                <span class=n>whiten</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>whiten</span><span class=p>,</span>
                <span class=n>cross_structural</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>cross_structural</span><span class=p>,</span>
            <span class=p>)</span>

            <span class=k>if</span> <span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
                <span class=k>return</span>

            <span class=c1># flip patterns to have positive max</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
                <span class=p>[</span>
                    <span class=p>(</span>
                        <span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span>
                        <span class=k>if</span> <span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]))]</span> <span class=o>&gt;</span> <span class=mi>0</span>
                        <span class=k>else</span> <span class=o>-</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span>
                    <span class=p>)</span>
                    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>patterns</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
                <span class=p>]</span>
            <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_assembly_act</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get assembly activity.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        epoch : nel.EpochArray, optional</span>
<span class=sd>            The epoch to restrict to, by default None.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        nel.AnalogSignalArray</span>
<span class=sd>            Assembly activity.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># check for num of assemblies first</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>epoch</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>zactmat</span><span class=p>,</span> <span class=n>ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>zactmat</span><span class=p>,</span> <span class=n>ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>)</span>

        <span class=n>assembly_act</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>(</span>
            <span class=n>data</span><span class=o>=</span><span class=n>assembly</span><span class=o>.</span><span class=n>computeAssemblyActivity</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>,</span> <span class=n>zactmat</span><span class=p>),</span>
            <span class=n>timestamps</span><span class=o>=</span><span class=n>ts</span><span class=p>,</span>
            <span class=n>fs</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>z_mat_dt</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>assembly_act</span>

    <span class=k>def</span><span class=w> </span><span class=nf>plot</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>plot_members</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
        <span class=n>central_line_color</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;grey&quot;</span><span class=p>,</span>
        <span class=n>marker_color</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;k&quot;</span><span class=p>,</span>
        <span class=n>member_color</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>list</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;#6768ab&quot;</span><span class=p>,</span>
        <span class=n>line_width</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.25</span><span class=p>,</span>
        <span class=n>markersize</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
        <span class=n>x_padding</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.2</span><span class=p>,</span>
        <span class=n>figsize</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>tuple</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>plt</span><span class=o>.</span><span class=n>Figure</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span> <span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Plots basic stem plot to display assembly weights.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        plot_members : bool, optional</span>
<span class=sd>            Whether to plot assembly members, by default True.</span>
<span class=sd>        central_line_color : str, optional</span>
<span class=sd>            Color of the central line, by default &quot;grey&quot;.</span>
<span class=sd>        marker_color : str, optional</span>
<span class=sd>            Color of the markers, by default &quot;k&quot;.</span>
<span class=sd>        member_color : Union[str, List[str]], optional</span>
<span class=sd>            Color of the members, by default &quot;#6768ab&quot;.</span>
<span class=sd>        line_width : float, optional</span>
<span class=sd>            Width of the lines, by default 1.25.</span>
<span class=sd>        markersize : float, optional</span>
<span class=sd>            Size of the markers, by default 4.</span>
<span class=sd>        x_padding : float, optional</span>
<span class=sd>            Padding on the x-axis, by default 0.2.</span>
<span class=sd>        figsize : Optional[Tuple[float, float]], optional</span>
<span class=sd>            Size of the figure, by default None.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Union[Tuple[plt.Figure, np.ndarray], str, None]</span>
<span class=sd>            The figure and axes if successful, otherwise a message or None.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;patterns&quot;</span><span class=p>):</span>
            <span class=k>return</span> <span class=s2>&quot;run get_weights first&quot;</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
            <span class=k>if</span> <span class=n>plot_members</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>find_members</span><span class=p>()</span>
            <span class=k>if</span> <span class=n>figsize</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=n>figsize</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span>
            <span class=c1># set up figure with size relative to assembly matrix</span>
            <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span>
                <span class=mi>1</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>(),</span>
                <span class=n>figsize</span><span class=o>=</span><span class=n>figsize</span><span class=p>,</span>
                <span class=n>sharey</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
                <span class=n>sharex</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=c1># iter over each assembly and plot the weight per cell</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()):</span>
                <span class=n>markerline</span><span class=p>,</span> <span class=n>stemlines</span><span class=p>,</span> <span class=n>baseline</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>stem</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:],</span> <span class=n>orientation</span><span class=o>=</span><span class=s2>&quot;horizontal&quot;</span>
                <span class=p>)</span>
                <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>marker_color</span>
                <span class=n>baseline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>central_line_color</span>
                <span class=n>baseline</span><span class=o>.</span><span class=n>zorder</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1000</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>getp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>))</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=n>line_width</span><span class=p>)</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=n>markersize</span><span class=p>)</span>

                <span class=k>if</span> <span class=n>plot_members</span><span class=p>:</span>
                    <span class=n>current_pattern</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
                    <span class=n>current_pattern</span><span class=p>[</span><span class=o>~</span><span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                    <span class=n>markerline</span><span class=p>,</span> <span class=n>stemlines</span><span class=p>,</span> <span class=n>baseline</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>stem</span><span class=p>(</span>
                        <span class=n>current_pattern</span><span class=p>,</span> <span class=n>orientation</span><span class=o>=</span><span class=s2>&quot;horizontal&quot;</span>
                    <span class=p>)</span>
                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span>
                        <span class=n>member_color</span><span class=p>,</span> <span class=n>sns</span><span class=o>.</span><span class=n>palettes</span><span class=o>.</span><span class=n>_ColorPalette</span>
                    <span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>member_color</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
                        <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>member_color</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>member_color</span>
                    <span class=n>baseline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=s2>&quot;#00000000&quot;</span>
                    <span class=n>baseline</span><span class=o>.</span><span class=n>zorder</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1000</span>
                    <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>getp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>))</span>
                    <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=n>line_width</span><span class=p>)</span>
                    <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=n>markersize</span><span class=p>)</span>

                <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;top&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
                <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;right&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

            <span class=c1># give room for marker</span>
            <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span>
                <span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>-</span> <span class=n>x_padding</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>+</span> <span class=n>x_padding</span>
            <span class=p>)</span>

            <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&quot;Neurons #&quot;</span><span class=p>)</span>
            <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&quot;Weights (a.u.)&quot;</span><span class=p>)</span>

            <span class=k>return</span> <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span>

    <span class=k>def</span><span class=w> </span><span class=nf>n_assemblies</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Get the number of detected assemblies.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        int</span>
<span class=sd>            Number of detected assemblies.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;patterns&quot;</span><span class=p>):</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
                <span class=k>return</span> <span class=mi>0</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>isempty</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Check if the object is empty.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        bool</span>
<span class=sd>            True if empty, False otherwise.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;st&quot;</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>elif</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;st&quot;</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>True</span>

    <span class=k>def</span><span class=w> </span><span class=nf>copy</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;AssemblyReact&quot;</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Returns a copy of the current class.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        AssemblyReact</span>
<span class=sd>            A copy of the current class.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>newcopy</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>newcopy</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>isempty</span><span class=p>:</span>
            <span class=k>return</span> <span class=sa>f</span><span class=s2>&quot;&lt;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>type_name</span><span class=si>}</span><span class=s2>: empty&gt;&quot;</span>

        <span class=c1># if st data as been loaded and patterns have been computed</span>
        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;patterns&quot;</span><span class=p>):</span>
            <span class=n>n_units</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>n_active</span><span class=si>}</span><span class=s2> units&quot;</span>
            <span class=n>n_patterns</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span><span class=si>}</span><span class=s2> assemblies&quot;</span>
            <span class=n>dstr</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;of length </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>length</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=k>return</span> <span class=s2>&quot;&lt;</span><span class=si>%s</span><span class=s2>: </span><span class=si>%s</span><span class=s2>, </span><span class=si>%s</span><span class=s2>&gt; </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>type_name</span><span class=p>,</span> <span class=n>n_units</span><span class=p>,</span> <span class=n>n_patterns</span><span class=p>,</span> <span class=n>dstr</span><span class=p>)</span>

        <span class=c1># if st data as been loaded</span>
        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;st&quot;</span><span class=p>):</span>
            <span class=n>n_units</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>n_active</span><span class=si>}</span><span class=s2> units&quot;</span>
            <span class=n>dstr</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;of length </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>support</span><span class=o>.</span><span class=n>length</span><span class=si>}</span><span class=s2>&quot;</span>
            <span class=k>return</span> <span class=s2>&quot;&lt;</span><span class=si>%s</span><span class=s2>: </span><span class=si>%s</span><span class=s2>&gt; </span><span class=si>%s</span><span class=s2>&quot;</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>type_name</span><span class=p>,</span> <span class=n>n_units</span><span class=p>,</span> <span class=n>dstr</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>find_members</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Finds significant assembly patterns and significant assembly members.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        np.ndarray</span>
<span class=sd>            A ndarray of booleans indicating whether each unit is a significant member of an assembly.</span>

<span class=sd>        Notes</span>
<span class=sd>        -----</span>
<span class=sd>        also, sets self.assembly_members and self.valid_assembly</span>

<span class=sd>        self.valid_assembly: a ndarray of booleans indicating an assembly has members with the same sign (Boucly et al. 2022)</span>
<span class=sd>        &quot;&quot;&quot;</span>

        <span class=k>def</span><span class=w> </span><span class=nf>Otsu</span><span class=p>(</span><span class=n>vector</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            The Otsu method for splitting data into two groups.</span>

<span class=sd>            Parameters</span>
<span class=sd>            ----------</span>
<span class=sd>            vector : np.ndarray</span>
<span class=sd>                Arbitrary vector.</span>

<span class=sd>            Returns</span>
<span class=sd>            -------</span>
<span class=sd>            Tuple[np.ndarray, float, float]</span>
<span class=sd>                Group, threshold used for classification, and effectiveness metric.</span>
<span class=sd>            &quot;&quot;&quot;</span>
            <span class=nb>sorted</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>vector</span><span class=p>)</span>
            <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>vector</span><span class=p>)</span>
            <span class=n>intraClassVariance</span> <span class=o>=</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]</span> <span class=o>*</span> <span class=n>n</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
                <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>n</span>
                <span class=n>p0</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>p</span>
                <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>==</span> <span class=n>n</span><span class=p>:</span>
                    <span class=n>intraClassVariance</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>intraClassVariance</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=nb>sorted</span><span class=p>[</span><span class=mi>0</span> <span class=p>:</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span> <span class=o>+</span> <span class=n>p0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span>
                        <span class=nb>sorted</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>:]</span>
                    <span class=p>)</span>

            <span class=n>minIntraVariance</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmin</span><span class=p>(</span><span class=n>intraClassVariance</span><span class=p>)</span>
            <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanargmin</span><span class=p>(</span><span class=n>intraClassVariance</span><span class=p>)</span>
            <span class=n>threshold</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
            <span class=n>group</span> <span class=o>=</span> <span class=n>vector</span> <span class=o>&gt;</span> <span class=n>threshold</span>

            <span class=n>em</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=n>minIntraVariance</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=n>vector</span><span class=p>))</span>

            <span class=k>return</span> <span class=n>group</span><span class=p>,</span> <span class=n>threshold</span><span class=p>,</span> <span class=n>em</span>

        <span class=n>is_member</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>keep_assembly</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>pat</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>:</span>
            <span class=n>isMember</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>Otsu</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>pat</span><span class=p>))</span>
            <span class=n>is_member</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>isMember</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>pat</span><span class=p>[</span><span class=n>isMember</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>pat</span><span class=p>[</span><span class=n>isMember</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>
                <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
            <span class=k>elif</span> <span class=nb>sum</span><span class=p>(</span><span class=n>isMember</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>is_member</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>valid_assembly</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>keep_assembly</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=neuro_py.ensemble.AssemblyReact.isempty class="doc doc-heading"> <code class="highlight language-python"><span class=n>isempty</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Check if the object is empty.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if empty, False otherwise.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.copy class="doc doc-heading"> <code class="highlight language-python"><span class=n>copy</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Returns a copy of the current class.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" href=assembly_reactivation/#neuro_py.ensemble.assembly_reactivation.AssemblyReact>AssemblyReact</a></code> </td> <td> <div class=doc-md-description> <p>A copy of the current class.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>copy</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;AssemblyReact&quot;</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Returns a copy of the current class.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    AssemblyReact</span>
<span class=sd>        A copy of the current class.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>newcopy</span> <span class=o>=</span> <span class=n>copy</span><span class=o>.</span><span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>newcopy</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.find_members class="doc doc-heading"> <code class="highlight language-python"><span class=n>find_members</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Finds significant assembly patterns and significant assembly members.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A ndarray of booleans indicating whether each unit is a significant member of an assembly.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>also, sets self.assembly_members and self.valid_assembly</p> <p>self.valid_assembly: a ndarray of booleans indicating an assembly has members with the same sign (Boucly et al. 2022)</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>find_members</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Finds significant assembly patterns and significant assembly members.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        A ndarray of booleans indicating whether each unit is a significant member of an assembly.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    also, sets self.assembly_members and self.valid_assembly</span>

<span class=sd>    self.valid_assembly: a ndarray of booleans indicating an assembly has members with the same sign (Boucly et al. 2022)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>Otsu</span><span class=p>(</span><span class=n>vector</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        The Otsu method for splitting data into two groups.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        vector : np.ndarray</span>
<span class=sd>            Arbitrary vector.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Tuple[np.ndarray, float, float]</span>
<span class=sd>            Group, threshold used for classification, and effectiveness metric.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=nb>sorted</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>vector</span><span class=p>)</span>
        <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>vector</span><span class=p>)</span>
        <span class=n>intraClassVariance</span> <span class=o>=</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]</span> <span class=o>*</span> <span class=n>n</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
            <span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=n>n</span>
            <span class=n>p0</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>p</span>
            <span class=k>if</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>==</span> <span class=n>n</span><span class=p>:</span>
                <span class=n>intraClassVariance</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>intraClassVariance</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=nb>sorted</span><span class=p>[</span><span class=mi>0</span> <span class=p>:</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span> <span class=o>+</span> <span class=n>p0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span>
                    <span class=nb>sorted</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>:]</span>
                <span class=p>)</span>

        <span class=n>minIntraVariance</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmin</span><span class=p>(</span><span class=n>intraClassVariance</span><span class=p>)</span>
        <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanargmin</span><span class=p>(</span><span class=n>intraClassVariance</span><span class=p>)</span>
        <span class=n>threshold</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=n>group</span> <span class=o>=</span> <span class=n>vector</span> <span class=o>&gt;</span> <span class=n>threshold</span>

        <span class=n>em</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=n>minIntraVariance</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=n>vector</span><span class=p>))</span>

        <span class=k>return</span> <span class=n>group</span><span class=p>,</span> <span class=n>threshold</span><span class=p>,</span> <span class=n>em</span>

    <span class=n>is_member</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>keep_assembly</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>pat</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>:</span>
        <span class=n>isMember</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>Otsu</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>pat</span><span class=p>))</span>
        <span class=n>is_member</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>isMember</span><span class=p>)</span>

        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>pat</span><span class=p>[</span><span class=n>isMember</span><span class=p>]</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>pat</span><span class=p>[</span><span class=n>isMember</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>):</span>
            <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
        <span class=k>elif</span> <span class=nb>sum</span><span class=p>(</span><span class=n>isMember</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>keep_assembly</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>is_member</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>valid_assembly</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>keep_assembly</span><span class=p>)</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.get_assembly_act class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_assembly_act</span><span class=p>(</span><span class=n>epoch</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get assembly activity.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>epoch</code> </td> <td> <code><span title=nelpy.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>The epoch to restrict to, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=nelpy.AnalogSignalArray>AnalogSignalArray</span></code> </td> <td> <div class=doc-md-description> <p>Assembly activity.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_assembly_act</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get assembly activity.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    epoch : nel.EpochArray, optional</span>
<span class=sd>        The epoch to restrict to, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    nel.AnalogSignalArray</span>
<span class=sd>        Assembly activity.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># check for num of assemblies first</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>(</span><span class=n>empty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>epoch</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>zactmat</span><span class=p>,</span> <span class=n>ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>])</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>zactmat</span><span class=p>,</span> <span class=n>ts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>)</span>

    <span class=n>assembly_act</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>AnalogSignalArray</span><span class=p>(</span>
        <span class=n>data</span><span class=o>=</span><span class=n>assembly</span><span class=o>.</span><span class=n>computeAssemblyActivity</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>,</span> <span class=n>zactmat</span><span class=p>),</span>
        <span class=n>timestamps</span><span class=o>=</span><span class=n>ts</span><span class=p>,</span>
        <span class=n>fs</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=bp>self</span><span class=o>.</span><span class=n>z_mat_dt</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=k>return</span> <span class=n>assembly_act</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.get_weights class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_weights</span><span class=p>(</span><span class=n>epoch</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Gets the assembly weights.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>epoch</code> </td> <td> <code><span title=nelpy.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>The epoch to restrict to, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_weights</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Gets the assembly weights.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    epoch : nel.EpochArray, optional</span>
<span class=sd>        The epoch to restrict to, by default None.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=c1># check if st has any neurons</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>isempty</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>return</span>

    <span class=k>if</span> <span class=n>epoch</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>bst</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>]</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>bst</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span><span class=p>)</span><span class=o>.</span><span class=n>data</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>bst</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>all</span><span class=p>():</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>return</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>patterns</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>assembly</span><span class=o>.</span><span class=n>runPatterns</span><span class=p>(</span>
            <span class=n>bst</span><span class=p>,</span>
            <span class=n>method</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>method</span><span class=p>,</span>
            <span class=n>nullhyp</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nullhyp</span><span class=p>,</span>
            <span class=n>nshu</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>nshu</span><span class=p>,</span>
            <span class=n>percentile</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>percentile</span><span class=p>,</span>
            <span class=n>tracywidom</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>tracywidom</span><span class=p>,</span>
            <span class=n>whiten</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>whiten</span><span class=p>,</span>
            <span class=n>cross_structural</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>cross_structural</span><span class=p>,</span>
        <span class=p>)</span>

        <span class=k>if</span> <span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
            <span class=k>return</span>

        <span class=c1># flip patterns to have positive max</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
            <span class=p>[</span>
                <span class=p>(</span>
                    <span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span>
                    <span class=k>if</span> <span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]))]</span> <span class=o>&gt;</span> <span class=mi>0</span>
                    <span class=k>else</span> <span class=o>-</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>patterns</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>]</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.get_z_mat class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_z_mat</span><span class=p>(</span><span class=n>st</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Get z matrix.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>st</code> </td> <td> <code><span title=nelpy.SpikeTrainArray>SpikeTrainArray</span></code> </td> <td> <div class=doc-md-description> <p>Spike train array.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Z-scored binned spike train and bin centers.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_z_mat</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>st</span><span class=p>:</span> <span class=n>nel</span><span class=o>.</span><span class=n>SpikeTrainArray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get z matrix.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    st : nel.SpikeTrainArray</span>
<span class=sd>        Spike train array.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[np.ndarray, np.ndarray]</span>
<span class=sd>        Z-scored binned spike train and bin centers.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># binning the spike train</span>
    <span class=n>z_t</span> <span class=o>=</span> <span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>z_mat_dt</span><span class=p>)</span>
    <span class=c1># gaussian kernel to match the bin-size used to identify the assembly patterns</span>
    <span class=n>sigma</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>weight_dt</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span>
    <span class=n>z_t</span><span class=o>.</span><span class=n>smooth</span><span class=p>(</span><span class=n>sigma</span><span class=o>=</span><span class=n>sigma</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=c1># zscore the z matrix</span>
    <span class=n>z_scored_bst</span> <span class=o>=</span> <span class=n>stats</span><span class=o>.</span><span class=n>zscore</span><span class=p>(</span><span class=n>z_t</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=c1># make sure there are no nans, important as strengths will all be nan otherwise</span>
    <span class=n>z_scored_bst</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>z_scored_bst</span><span class=p>)</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=k>return</span> <span class=n>z_scored_bst</span><span class=p>,</span> <span class=n>z_t</span><span class=o>.</span><span class=n>bin_centers</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.load_data class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_data</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>loads data (spikes,ripples,epochs) from the session folder</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>load_data</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    loads data (spikes,ripples,epochs) from the session folder</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>load_spikes</span><span class=p>()</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>load_ripples</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.load_epoch class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_epoch</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>loads epochs from the session folder</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    loads epochs from the session folder</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
    <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>compress_repeated_epochs</span><span class=p>(</span><span class=n>epoch_df</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>time_support</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
        <span class=p>[</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=n>epoch_df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>stopTime</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
        <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=n>epoch_df</span><span class=o>.</span><span class=n>stopTime</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span>
        <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>epoch_df</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.load_ripples class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_ripples</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>loads ripples from the session folder</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>load_ripples</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    loads ripples from the session folder</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>ripples</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_ripples_events</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>ripples</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
        <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>ripples</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>ripples</span><span class=o>.</span><span class=n>stop</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span> <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.load_spikes class="doc doc-heading"> <code class="highlight language-python"><span class=n>load_spikes</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>loads spikes from the session folder</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>load_spikes</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    loads spikes from the session folder</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>cell_metrics</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_spikes</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>,</span>
        <span class=n>brainRegion</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>brainRegion</span><span class=p>,</span>
        <span class=n>putativeCellType</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>putativeCellType</span><span class=p>,</span>
        <span class=n>support</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.n_assemblies class="doc doc-heading"> <code class="highlight language-python"><span class=n>n_assemblies</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Get the number of detected assemblies.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of detected assemblies.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>n_assemblies</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get the number of detected assemblies.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    int</span>
<span class=sd>        Number of detected assemblies.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;patterns&quot;</span><span class=p>):</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=mi>0</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.plot class="doc doc-heading"> <code class="highlight language-python"><span class=n>plot</span><span class=p>(</span><span class=n>plot_members</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>central_line_color</span><span class=o>=</span><span class=s1>&#39;grey&#39;</span><span class=p>,</span> <span class=n>marker_color</span><span class=o>=</span><span class=s1>&#39;k&#39;</span><span class=p>,</span> <span class=n>member_color</span><span class=o>=</span><span class=s1>&#39;#6768ab&#39;</span><span class=p>,</span> <span class=n>line_width</span><span class=o>=</span><span class=mf>1.25</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>x_padding</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Plots basic stem plot to display assembly weights.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>plot_members</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to plot assembly members, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class=doc-section-item> <td> <code>central_line_color</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Color of the central line, by default "grey".</p> </div> </td> <td> <code>&#39;grey&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>marker_color</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Color of the markers, by default "k".</p> </div> </td> <td> <code>&#39;k&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>member_color</code> </td> <td> <code><span title=typing.Union>Union</span>[<span title=str>str</span>, <span title=List>List</span>[<span title=str>str</span>]]</code> </td> <td> <div class=doc-md-description> <p>Color of the members, by default "#6768ab".</p> </div> </td> <td> <code>&#39;#6768ab&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>line_width</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Width of the lines, by default 1.25.</p> </div> </td> <td> <code>1.25</code> </td> </tr> <tr class=doc-section-item> <td> <code>markersize</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Size of the markers, by default 4.</p> </div> </td> <td> <code>4</code> </td> </tr> <tr class=doc-section-item> <td> <code>x_padding</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Padding on the x-axis, by default 0.2.</p> </div> </td> <td> <code>0.2</code> </td> </tr> <tr class=doc-section-item> <td> <code>figsize</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Tuple>Tuple</span>[<span title=float>float</span>, <span title=float>float</span>]]</code> </td> <td> <div class=doc-md-description> <p>Size of the figure, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Tuple>Tuple</span>[<span title=matplotlib.pyplot.Figure>Figure</span>, <span title=numpy.ndarray>ndarray</span>], <span title=str>str</span>, None]</code> </td> <td> <div class=doc-md-description> <p>The figure and axes if successful, otherwise a message or None.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>plot</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>plot_members</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
    <span class=n>central_line_color</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;grey&quot;</span><span class=p>,</span>
    <span class=n>marker_color</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;k&quot;</span><span class=p>,</span>
    <span class=n>member_color</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=nb>list</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;#6768ab&quot;</span><span class=p>,</span>
    <span class=n>line_width</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.25</span><span class=p>,</span>
    <span class=n>markersize</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
    <span class=n>x_padding</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.2</span><span class=p>,</span>
    <span class=n>figsize</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>tuple</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>plt</span><span class=o>.</span><span class=n>Figure</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span> <span class=nb>str</span><span class=p>,</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Plots basic stem plot to display assembly weights.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    plot_members : bool, optional</span>
<span class=sd>        Whether to plot assembly members, by default True.</span>
<span class=sd>    central_line_color : str, optional</span>
<span class=sd>        Color of the central line, by default &quot;grey&quot;.</span>
<span class=sd>    marker_color : str, optional</span>
<span class=sd>        Color of the markers, by default &quot;k&quot;.</span>
<span class=sd>    member_color : Union[str, List[str]], optional</span>
<span class=sd>        Color of the members, by default &quot;#6768ab&quot;.</span>
<span class=sd>    line_width : float, optional</span>
<span class=sd>        Width of the lines, by default 1.25.</span>
<span class=sd>    markersize : float, optional</span>
<span class=sd>        Size of the markers, by default 4.</span>
<span class=sd>    x_padding : float, optional</span>
<span class=sd>        Padding on the x-axis, by default 0.2.</span>
<span class=sd>    figsize : Optional[Tuple[float, float]], optional</span>
<span class=sd>        Size of the figure, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Union[Tuple[plt.Figure, np.ndarray], str, None]</span>
<span class=sd>        The figure and axes if successful, otherwise a message or None.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>hasattr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;patterns&quot;</span><span class=p>):</span>
        <span class=k>return</span> <span class=s2>&quot;run get_weights first&quot;</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
        <span class=k>if</span> <span class=n>plot_members</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>find_members</span><span class=p>()</span>
        <span class=k>if</span> <span class=n>figsize</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>figsize</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>round</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()</span> <span class=o>/</span> <span class=mi>2</span><span class=p>))</span>
        <span class=c1># set up figure with size relative to assembly matrix</span>
        <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span>
            <span class=mi>1</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>(),</span>
            <span class=n>figsize</span><span class=o>=</span><span class=n>figsize</span><span class=p>,</span>
            <span class=n>sharey</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
            <span class=n>sharex</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=c1># iter over each assembly and plot the weight per cell</span>
        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>n_assemblies</span><span class=p>()):</span>
            <span class=n>markerline</span><span class=p>,</span> <span class=n>stemlines</span><span class=p>,</span> <span class=n>baseline</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>stem</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:],</span> <span class=n>orientation</span><span class=o>=</span><span class=s2>&quot;horizontal&quot;</span>
            <span class=p>)</span>
            <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>marker_color</span>
            <span class=n>baseline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>central_line_color</span>
            <span class=n>baseline</span><span class=o>.</span><span class=n>zorder</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1000</span>
            <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>getp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>))</span>
            <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=n>line_width</span><span class=p>)</span>
            <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=n>markersize</span><span class=p>)</span>

            <span class=k>if</span> <span class=n>plot_members</span><span class=p>:</span>
                <span class=n>current_pattern</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
                <span class=n>current_pattern</span><span class=p>[</span><span class=o>~</span><span class=bp>self</span><span class=o>.</span><span class=n>assembly_members</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=n>markerline</span><span class=p>,</span> <span class=n>stemlines</span><span class=p>,</span> <span class=n>baseline</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>stem</span><span class=p>(</span>
                    <span class=n>current_pattern</span><span class=p>,</span> <span class=n>orientation</span><span class=o>=</span><span class=s2>&quot;horizontal&quot;</span>
                <span class=p>)</span>
                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span>
                    <span class=n>member_color</span><span class=p>,</span> <span class=n>sns</span><span class=o>.</span><span class=n>palettes</span><span class=o>.</span><span class=n>_ColorPalette</span>
                <span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>member_color</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>
                    <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>member_color</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>markerline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=n>member_color</span>
                <span class=n>baseline</span><span class=o>.</span><span class=n>_color</span> <span class=o>=</span> <span class=s2>&quot;#00000000&quot;</span>
                <span class=n>baseline</span><span class=o>.</span><span class=n>zorder</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1000</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>,</span> <span class=n>plt</span><span class=o>.</span><span class=n>getp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=s2>&quot;color&quot;</span><span class=p>))</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>stemlines</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=n>line_width</span><span class=p>)</span>
                <span class=n>plt</span><span class=o>.</span><span class=n>setp</span><span class=p>(</span><span class=n>markerline</span><span class=p>,</span> <span class=n>markersize</span><span class=o>=</span><span class=n>markersize</span><span class=p>)</span>

            <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;top&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
            <span class=n>axes</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;right&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

        <span class=c1># give room for marker</span>
        <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>(</span>
            <span class=o>-</span><span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>-</span> <span class=n>x_padding</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>patterns</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>+</span> <span class=n>x_padding</span>
        <span class=p>)</span>

        <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&quot;Neurons #&quot;</span><span class=p>)</span>
        <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&quot;Weights (a.u.)&quot;</span><span class=p>)</span>

        <span class=k>return</span> <span class=n>fig</span><span class=p>,</span> <span class=n>axes</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.restrict_epochs_to_pre_task_post class="doc doc-heading"> <code class="highlight language-python"><span class=n>restrict_epochs_to_pre_task_post</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Restricts the epochs to the specified epochs</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>restrict_epochs_to_pre_task_post</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Restricts the epochs to the specified epochs</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># fetch data</span>
    <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>basepath</span><span class=p>)</span>
    <span class=c1># compress back to back sleep epochs (an issue further up the pipeline)</span>
    <span class=n>epoch_df</span> <span class=o>=</span> <span class=n>compress_repeated_epochs</span><span class=p>(</span><span class=n>epoch_df</span><span class=p>)</span>
    <span class=c1># restrict to pre task post epochs</span>
    <span class=n>idx</span> <span class=o>=</span> <span class=n>find_pre_task_post</span><span class=p>(</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>environment</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>epoch_df</span><span class=p>[</span><span class=n>idx</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
    <span class=c1># convert to epoch array and add to object</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>epochs</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span>
        <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>startTime</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>epoch_df</span><span class=o>.</span><span class=n>stopTime</span><span class=p>])</span><span class=o>.</span><span class=n>T</span><span class=p>],</span>
        <span class=n>label</span><span class=o>=</span><span class=s2>&quot;session_epochs&quot;</span><span class=p>,</span>
        <span class=n>domain</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>time_support</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.AssemblyReact.restrict_to_epoch class="doc doc-heading"> <code class="highlight language-python"><span class=n>restrict_to_epoch</span><span class=p>(</span><span class=n>epoch</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Restricts the spike data to a specific epoch.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>epoch</code> </td> <td> <code><span title=nelpy.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>The epoch to restrict to.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly_reactivation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>restrict_to_epoch</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Restricts the spike data to a specific epoch.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    epoch : nel.EpochArray</span>
<span class=sd>        The epoch to restrict to.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>st_resticted</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>[</span><span class=n>epoch</span><span class=p>]</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=neuro_py.ensemble.ExplainedVariance class="doc doc-heading"> <code>ExplainedVariance</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=object>object</span></code></p> <p>Explained variance measure for assessing reactivation of neuronal activity using pairwise correlations.</p> <details class=references open> <summary>References</summary> <p>1) Kudrimoti, H. S., Barnes, C. A., &amp; McNaughton, B. L. (1999). Reactivation of Hippocampal Cell Assemblies: Effects of Behavioral State, Experience, and EEG Dynamics. Journal of Neuroscience, 19(10), 4090-4101. https://doi.org/10/4090 2) Tatsuno, M., Lipa, P., &amp; McNaughton, B. L. (2006). Methodological Considerations on the Use of Template Matching to Study Long-Lasting Memory Trace Replay. Journal of Neuroscience, 26(42), 10727-10742. https://doi.org/10.1523/JNEUROSCI.3317-06.2006</p> <p>Adapted from https://github.com/diba-lab/NeuroPy/blob/main/neuropy/analyses/reactivation.py</p> </details> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.st>st</span></code></td> <td> <code><span title=nelpy.core._eventarray.SpikeTrainArray>SpikeTrainArray</span></code> </td> <td> <div class=doc-md-description> <p>obj that holds spiketrains</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.template>template</span></code></td> <td> <code><span title=nelpy.core._intervalarray.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>time in seconds, pairwise correlation calculated from this period will be compared to matching period (task-period)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.matching>matching</span></code></td> <td> <code><span title=nelpy.core._intervalarray.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>time in seconds, template-correlations will be correlated with pariwise correlations of this period (post-task period)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.control>control</span></code></td> <td> <code><span title=nelpy.core._intervalarray.EpochArray>EpochArray</span></code> </td> <td> <div class=doc-md-description> <p>time in seconds, control for pairwise correlations within this period (pre-task period)</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.bin_size>bin_size</span></code></td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>in seconds, binning size for spike counts</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.window>window</span></code></td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>window over which pairwise correlations will be calculated in matching and control time periods, if window is None entire time period is considered, in seconds</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.slideby>slideby</span></code></td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>slide window by this much, in seconds</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.matching_windows>matching_windows</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>windows for matching period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.control_windows>control_windows</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>windows for control period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.template_corr>template_corr</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>pairwise correlations for template period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.matching_paircorr>matching_paircorr</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>pairwise correlations for matching period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.control_paircorr>control_paircorr</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>pairwise correlations for control period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.ev>ev</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>explained variance for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.rev>rev</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>reverse explained variance for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.ev_std>ev_std</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>explained variance standard deviation for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.rev_std>rev_std</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>reverse explained variance standard deviation for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.partial_corr>partial_corr</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>partial correlations for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.rev_partial_corr>rev_partial_corr</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>reverse partial correlations for each time point</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.n_pairs>n_pairs</span></code></td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>number of pairs</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.matching_time>matching_time</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>time points for matching period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.ExplainedVariance.control_time>control_time</span></code></td> <td> <code><span title=array>array</span></code> </td> <td> <div class=doc-md-description> <p>time points for control period</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.ExplainedVariance.ev_signal>ev_signal</a></code></td> <td> <code><span title=nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</span></code> </td> <td> <div class=doc-md-description> <p>explained variance signal</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.ExplainedVariance.rev_signal>rev_signal</a></code></td> <td> <code><span title=nelpy.core._analogsignalarray.AnalogSignalArray>AnalogSignalArray</span></code> </td> <td> <div class=doc-md-description> <p>reverse explained variance signal</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.ExplainedVariance.plot>plot</a></code></td> <td> <code><span title=function>function</span></code> </td> <td> <div class=doc-md-description> <p>plot explained variance</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.ExplainedVariance.pvalue>pvalue</a></code></td> <td> <code><span title=function>function</span></code> </td> <td> <div class=doc-md-description> <p>calculate p-value for explained variance by shuffling the template correlations</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <h3 id=neuro_py.ensemble.ExplainedVariance--load-data>Load data</h3> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>basepath</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&quot;U:\data\HMC\HMC1\day8&quot;</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>st</span><span class=p>,</span><span class=n>cm</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_spikes</span><span class=p>(</span><span class=n>basepath</span><span class=p>,</span><span class=n>brainRegion</span><span class=o>=</span><span class=s2>&quot;CA1&quot;</span><span class=p>,</span><span class=n>putativeCellType</span><span class=o>=</span><span class=s2>&quot;Pyr&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>epoch_df</span> <span class=o>=</span> <span class=n>loading</span><span class=o>.</span><span class=n>load_epoch</span><span class=p>(</span><span class=n>basepath</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>beh_epochs</span> <span class=o>=</span> <span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>epoch_df</span><span class=p>[[</span><span class=s2>&quot;startTime&quot;</span><span class=p>,</span> <span class=s2>&quot;stopTime&quot;</span><span class=p>]]</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
</code></pre></div> <h3 id=neuro_py.ensemble.ExplainedVariance--most-simple-case-returns-single-explained-variance-value>Most simple case, returns single explained variance value</h3> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>expvar</span> <span class=o>=</span> <span class=n>explained_variance</span><span class=o>.</span><span class=n>ExplainedVariance</span><span class=p>(</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>st</span><span class=o>=</span><span class=n>st</span><span class=p>,</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>template</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>matching</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>control</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>window</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<span class=gp>&gt;&gt;&gt; </span>   <span class=p>)</span>
</code></pre></div> <h3 id=neuro_py.ensemble.ExplainedVariance--get-time-resolved-explained-variance-across-entire-session-in-200sec-bins>Get time resolved explained variance across entire session in 200sec bins</h3> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>expvar</span> <span class=o>=</span> <span class=n>explained_variance</span><span class=o>.</span><span class=n>ExplainedVariance</span><span class=p>(</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>st</span><span class=o>=</span><span class=n>st</span><span class=p>,</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>template</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>matching</span><span class=o>=</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>([</span><span class=n>beh_epochs</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>beh_epochs</span><span class=o>.</span><span class=n>stop</span><span class=p>]),</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>control</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>window</span><span class=o>=</span><span class=mi>200</span>
<span class=gp>&gt;&gt;&gt; </span>   <span class=p>)</span>
</code></pre></div> <h3 id=neuro_py.ensemble.ExplainedVariance--get-time-resolved-explained-variance-across-entire-session-in-200sec-bins-sliding-by-100sec>Get time resolved explained variance across entire session in 200sec bins sliding by 100sec</h3> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>expvar</span> <span class=o>=</span> <span class=n>explained_variance</span><span class=o>.</span><span class=n>ExplainedVariance</span><span class=p>(</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>st</span><span class=o>=</span><span class=n>st</span><span class=p>,</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>template</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>matching</span><span class=o>=</span><span class=n>nel</span><span class=o>.</span><span class=n>EpochArray</span><span class=p>([</span><span class=n>beh_epochs</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>beh_epochs</span><span class=o>.</span><span class=n>stop</span><span class=p>]),</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>control</span><span class=o>=</span><span class=n>beh_epochs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>window</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span>
<span class=gp>&gt;&gt;&gt; </span>       <span class=n>slideby</span><span class=o>=</span><span class=mi>100</span>
<span class=gp>&gt;&gt;&gt; </span>   <span class=p>)</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/explained_variance.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ExplainedVariance</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Explained variance measure for assessing reactivation of neuronal activity using pairwise correlations.</span>

<span class=sd>    References</span>
<span class=sd>    -------</span>
<span class=sd>    1) Kudrimoti, H. S., Barnes, C. A., &amp; McNaughton, B. L. (1999).</span>
<span class=sd>        Reactivation of Hippocampal Cell Assemblies: Effects of Behavioral State, Experience, and EEG Dynamics.</span>
<span class=sd>        Journal of Neuroscience, 19(10), 4090-4101. https://doi.org/10/4090</span>
<span class=sd>    2) Tatsuno, M., Lipa, P., &amp; McNaughton, B. L. (2006).</span>
<span class=sd>        Methodological Considerations on the Use of Template Matching to Study Long-Lasting Memory Trace Replay.</span>
<span class=sd>        Journal of Neuroscience, 26(42), 10727-10742. https://doi.org/10.1523/JNEUROSCI.3317-06.2006</span>

<span class=sd>    Adapted from https://github.com/diba-lab/NeuroPy/blob/main/neuropy/analyses/reactivation.py</span>

<span class=sd>    Attributes</span>
<span class=sd>    ----------</span>
<span class=sd>    st : SpikeTrainArray</span>
<span class=sd>        obj that holds spiketrains</span>
<span class=sd>    template : EpochArray</span>
<span class=sd>        time in seconds, pairwise correlation calculated from this period will be compared to matching period (task-period)</span>
<span class=sd>    matching : EpochArray</span>
<span class=sd>        time in seconds, template-correlations will be correlated with pariwise correlations of this period (post-task period)</span>
<span class=sd>    control : EpochArray</span>
<span class=sd>        time in seconds, control for pairwise correlations within this period (pre-task period)</span>
<span class=sd>    bin_size : float</span>
<span class=sd>        in seconds, binning size for spike counts</span>
<span class=sd>    window : int</span>
<span class=sd>        window over which pairwise correlations will be calculated in matching and control time periods,</span>
<span class=sd>            if window is None entire time period is considered, in seconds</span>
<span class=sd>    slideby : int</span>
<span class=sd>        slide window by this much, in seconds</span>
<span class=sd>    matching_windows : array</span>
<span class=sd>        windows for matching period</span>
<span class=sd>    control_windows : array</span>
<span class=sd>        windows for control period</span>
<span class=sd>    template_corr : array</span>
<span class=sd>        pairwise correlations for template period</span>
<span class=sd>    matching_paircorr : array</span>
<span class=sd>        pairwise correlations for matching period</span>
<span class=sd>    control_paircorr : array</span>
<span class=sd>        pairwise correlations for control period</span>
<span class=sd>    ev : array</span>
<span class=sd>        explained variance for each time point</span>
<span class=sd>    rev : array</span>
<span class=sd>        reverse explained variance for each time point</span>
<span class=sd>    ev_std : array</span>
<span class=sd>        explained variance standard deviation for each time point</span>
<span class=sd>    rev_std : array</span>
<span class=sd>        reverse explained variance standard deviation for each time point</span>
<span class=sd>    partial_corr : array</span>
<span class=sd>        partial correlations for each time point</span>
<span class=sd>    rev_partial_corr : array</span>
<span class=sd>        reverse partial correlations for each time point</span>
<span class=sd>    n_pairs : int</span>
<span class=sd>        number of pairs</span>
<span class=sd>    matching_time : array</span>
<span class=sd>        time points for matching period</span>
<span class=sd>    control_time : array</span>
<span class=sd>        time points for control period</span>
<span class=sd>    ev_signal : AnalogSignalArray</span>
<span class=sd>        explained variance signal</span>
<span class=sd>    rev_signal : AnalogSignalArray</span>
<span class=sd>        reverse explained variance signal</span>
<span class=sd>    plot : function</span>
<span class=sd>        plot explained variance</span>
<span class=sd>    pvalue : function</span>
<span class=sd>        calculate p-value for explained variance by shuffling the template correlations</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    # Load data</span>
<span class=sd>    &gt;&gt;&gt; basepath = r&quot;U:\data\HMC\HMC1\day8&quot;</span>
<span class=sd>    &gt;&gt;&gt; st,cm = loading.load_spikes(basepath,brainRegion=&quot;CA1&quot;,putativeCellType=&quot;Pyr&quot;)</span>

<span class=sd>    &gt;&gt;&gt; epoch_df = loading.load_epoch(basepath)</span>
<span class=sd>    &gt;&gt;&gt; beh_epochs = nel.EpochArray(epoch_df[[&quot;startTime&quot;, &quot;stopTime&quot;]].values)</span>


<span class=sd>    # Most simple case, returns single explained variance value</span>
<span class=sd>    &gt;&gt;&gt; expvar = explained_variance.ExplainedVariance(</span>
<span class=sd>    &gt;&gt;&gt;        st=st,</span>
<span class=sd>    &gt;&gt;&gt;        template=beh_epochs[1],</span>
<span class=sd>    &gt;&gt;&gt;        matching=beh_epochs[2],</span>
<span class=sd>    &gt;&gt;&gt;        control=beh_epochs[0],</span>
<span class=sd>    &gt;&gt;&gt;        window=None,</span>
<span class=sd>    &gt;&gt;&gt;    )</span>

<span class=sd>    # Get time resolved explained variance across entire session in 200sec bins</span>
<span class=sd>    &gt;&gt;&gt; expvar = explained_variance.ExplainedVariance(</span>
<span class=sd>    &gt;&gt;&gt;        st=st,</span>
<span class=sd>    &gt;&gt;&gt;        template=beh_epochs[1],</span>
<span class=sd>    &gt;&gt;&gt;        matching=nel.EpochArray([beh_epochs.start, beh_epochs.stop]),</span>
<span class=sd>    &gt;&gt;&gt;        control=beh_epochs[0],</span>
<span class=sd>    &gt;&gt;&gt;        window=200</span>
<span class=sd>    &gt;&gt;&gt;    )</span>

<span class=sd>    # Get time resolved explained variance across entire session in 200sec bins sliding by 100sec</span>
<span class=sd>    &gt;&gt;&gt; expvar = explained_variance.ExplainedVariance(</span>
<span class=sd>    &gt;&gt;&gt;        st=st,</span>
<span class=sd>    &gt;&gt;&gt;        template=beh_epochs[1],</span>
<span class=sd>    &gt;&gt;&gt;        matching=nel.EpochArray([beh_epochs.start, beh_epochs.stop]),</span>
<span class=sd>    &gt;&gt;&gt;        control=beh_epochs[0],</span>
<span class=sd>    &gt;&gt;&gt;        window=200,</span>
<span class=sd>    &gt;&gt;&gt;        slideby=100</span>
<span class=sd>    &gt;&gt;&gt;    )</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>st</span><span class=p>:</span> <span class=n>SpikeTrainArray</span><span class=p>,</span>
        <span class=n>template</span><span class=p>:</span> <span class=n>EpochArray</span><span class=p>,</span>
        <span class=n>matching</span><span class=p>:</span> <span class=n>EpochArray</span><span class=p>,</span>
        <span class=n>control</span><span class=p>:</span> <span class=n>EpochArray</span><span class=p>,</span>
        <span class=n>bin_size</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.2</span><span class=p>,</span>
        <span class=n>window</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>900</span><span class=p>,</span>
        <span class=n>slideby</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Explained variance measure for assessing reactivation of neuronal activity using pairwise correlations.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        st : SpikeTrainArray</span>
<span class=sd>            obj that holds spiketrains</span>
<span class=sd>        template : EpochArray</span>
<span class=sd>            time in seconds, pairwise correlation calculated from this period will be compared to matching period (task-period)</span>
<span class=sd>        matching : EpochArray</span>
<span class=sd>            time in seconds, template-correlations will be correlated with pariwise correlations of this period (post-task period)</span>
<span class=sd>        control : EpochArray</span>
<span class=sd>            time in seconds, control for pairwise correlations within this period (pre-task period)</span>
<span class=sd>        bin_size : float, optional</span>
<span class=sd>            in seconds, binning size for spike counts, by default 0.2</span>
<span class=sd>        window : int, optional</span>
<span class=sd>            window over which pairwise correlations will be calculated in matching and control time periods,</span>
<span class=sd>                if window is None entire time period is considered, in seconds, by default 900</span>
<span class=sd>        slideby : int, optional</span>
<span class=sd>            slide window by this much, in seconds, by default None</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=nb>locals</span><span class=p>())</span>
        <span class=k>del</span> <span class=bp>self</span><span class=o>.</span><span class=vm>__dict__</span><span class=p>[</span><span class=s2>&quot;self&quot;</span><span class=p>]</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>__validate_input</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__calculate</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__validate_input</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate input parameters.&quot;&quot;&quot;</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=p>,</span> <span class=n>SpikeTrainArray</span><span class=p>)</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=p>,</span> <span class=n>EpochArray</span><span class=p>)</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=p>,</span> <span class=n>EpochArray</span><span class=p>)</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=p>,</span> <span class=n>EpochArray</span><span class=p>)</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>bin_size</span><span class=p>,</span> <span class=p>(</span><span class=nb>float</span><span class=p>,</span> <span class=nb>int</span><span class=p>))</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>window</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=nb>type</span><span class=p>(</span><span class=kc>None</span><span class=p>)))</span>
        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>slideby</span><span class=p>,</span> <span class=p>(</span><span class=nb>int</span><span class=p>,</span> <span class=nb>type</span><span class=p>(</span><span class=kc>None</span><span class=p>)))</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__calculate</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;processing steps for explained variance calculation.&quot;&quot;&quot;</span>
        <span class=n>control_window_size</span><span class=p>,</span> <span class=n>matching_window_size</span><span class=p>,</span> <span class=n>slideby</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_window_sizes</span><span class=p>()</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>matching_windows</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_windows_array</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=p>,</span> <span class=n>matching_window_size</span><span class=p>,</span> <span class=n>slideby</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>control_windows</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_windows_array</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=p>,</span> <span class=n>control_window_size</span><span class=p>,</span> <span class=n>slideby</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__validate_window_sizes</span><span class=p>(</span><span class=n>control_window_size</span><span class=p>,</span> <span class=n>matching_window_size</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>template_corr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_template_corr</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_pairwise_correlations</span><span class=p>()</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_partial_correlations</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__get_window_sizes</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get window sizes for control and matching periods.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>window</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>control_window_size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>duration</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
            <span class=n>matching_window_size</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>duration</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
            <span class=n>slideby</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>slideby</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>control_window_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>window</span>
            <span class=n>matching_window_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>window</span>
            <span class=n>slideby</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>control_window_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>window</span>
            <span class=n>matching_window_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>window</span>
            <span class=n>slideby</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>slideby</span>
        <span class=k>return</span> <span class=n>control_window_size</span><span class=p>,</span> <span class=n>matching_window_size</span><span class=p>,</span> <span class=n>slideby</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__get_windows_array</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>epoch_array</span><span class=p>,</span> <span class=n>window_size</span><span class=p>,</span> <span class=n>slideby</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get windows array for control and matching periods.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>slideby</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>epoch_array</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>epoch_array</span><span class=o>.</span><span class=n>stop</span><span class=p>)</span>
            <span class=n>windows</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>lib</span><span class=o>.</span><span class=n>stride_tricks</span><span class=o>.</span><span class=n>sliding_window_view</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>window_size</span><span class=p>)</span>
            <span class=n>windows</span> <span class=o>=</span> <span class=n>windows</span><span class=p>[::</span><span class=n>slideby</span><span class=p>,</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>]]</span>
        <span class=k>elif</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>epoch_array</span><span class=o>.</span><span class=n>duration</span><span class=p>)</span> <span class=o>==</span> <span class=n>window_size</span><span class=p>:</span>
            <span class=n>windows</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>epoch_array</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>epoch_array</span><span class=o>.</span><span class=n>stop</span><span class=p>]])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>array</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>epoch_array</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=n>epoch_array</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span> <span class=n>window_size</span><span class=p>)</span>
            <span class=n>windows</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>array</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>array</span><span class=p>[</span><span class=mi>1</span><span class=p>:]])</span><span class=o>.</span><span class=n>T</span>
        <span class=k>return</span> <span class=n>windows</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__validate_window_sizes</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>control_window_size</span><span class=p>,</span> <span class=n>matching_window_size</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate window sizes.&quot;&quot;&quot;</span>
        <span class=k>assert</span> <span class=p>(</span>
            <span class=n>control_window_size</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>duration</span>
        <span class=p>),</span> <span class=s2>&quot;window is bigger than control&quot;</span>
        <span class=k>assert</span> <span class=p>(</span>
            <span class=n>matching_window_size</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>duration</span>
        <span class=p>),</span> <span class=s2>&quot;window is bigger than matching&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__get_template_corr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get pairwise correlations for template period.&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>bst</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>st</span><span class=o>.</span><span class=n>bin</span><span class=p>(</span><span class=n>ds</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bin_size</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>__get_pairwise_corr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>bst</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=p>]</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__calculate_pairwise_correlations</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate pairwise correlations for matching and control periods.&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>matching_paircorr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__time_resolved_correlation</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_windows</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>control_paircorr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__time_resolved_correlation</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_windows</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>__get_pairwise_corr</span><span class=p>(</span><span class=n>bst_data</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate pairwise correlations.&quot;&quot;&quot;</span>
        <span class=n>corr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>corrcoef</span><span class=p>(</span><span class=n>bst_data</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>corr</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>tril_indices</span><span class=p>(</span><span class=n>corr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k</span><span class=o>=-</span><span class=mi>1</span><span class=p>)]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__time_resolved_correlation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>windows</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate pairwise correlations for given windows.&quot;&quot;&quot;</span>
        <span class=n>paircorr</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>bst_data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bst</span><span class=o>.</span><span class=n>data</span>
        <span class=n>bin_centers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bst</span><span class=o>.</span><span class=n>bin_centers</span>

        <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>windows</span><span class=p>:</span>
            <span class=n>start</span><span class=p>,</span> <span class=n>stop</span> <span class=o>=</span> <span class=n>w</span>
            <span class=n>idx</span> <span class=o>=</span> <span class=p>(</span><span class=n>bin_centers</span> <span class=o>&gt;</span> <span class=n>start</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>bin_centers</span> <span class=o>&lt;</span> <span class=n>stop</span><span class=p>)</span>
            <span class=n>corr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>corrcoef</span><span class=p>(</span><span class=n>bst_data</span><span class=p>[:,</span> <span class=n>idx</span><span class=p>])</span>
            <span class=n>paircorr</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>corr</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>tril_indices</span><span class=p>(</span><span class=n>corr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k</span><span class=o>=-</span><span class=mi>1</span><span class=p>)])</span>

        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>paircorr</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__calculate_partial_correlations</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate partial correlations.&quot;&quot;&quot;</span>
        <span class=n>partial_corr</span><span class=p>,</span> <span class=n>rev_partial_corr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_partial_correlations_</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>matching_paircorr</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>control_paircorr</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>template_corr</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_statistics</span><span class=p>(</span><span class=n>partial_corr</span><span class=p>,</span> <span class=n>rev_partial_corr</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=nd>@jit</span><span class=p>(</span><span class=n>nopython</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>def</span><span class=w> </span><span class=nf>__calculate_partial_correlations_</span><span class=p>(</span>
        <span class=n>matching_paircorr</span><span class=p>,</span> <span class=n>control_paircorr</span><span class=p>,</span> <span class=n>template_corr</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate partial correlations.&quot;&quot;&quot;</span>

        <span class=k>def</span><span class=w> </span><span class=nf>__explained_variance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>covar</span><span class=p>):</span>
<span class=w>            </span><span class=sd>&quot;&quot;&quot;Calculate explained variance and reverse explained variance.&quot;&quot;&quot;</span>

            <span class=c1># Calculate covariance matrix</span>
            <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>covar</span><span class=p>)</span>
            <span class=n>valid</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
                <span class=n>valid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=ow>not</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>covar</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=ow>or</span> <span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>x</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=ow>or</span> <span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>y</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
            <span class=n>mat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>((</span><span class=mi>3</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
            <span class=n>mat</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>covar</span>
            <span class=n>mat</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>x</span>
            <span class=n>mat</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>y</span>
            <span class=n>cov</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>corrcoef</span><span class=p>(</span><span class=n>mat</span><span class=p>[:,</span> <span class=n>valid</span><span class=p>])</span>

            <span class=c1># Calculate explained variance</span>
            <span class=n>EV</span> <span class=o>=</span> <span class=p>(</span><span class=n>cov</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span> <span class=o>/</span> <span class=p>(</span>
                <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>((</span><span class=mi>1</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1e-10</span>
            <span class=p>)</span>

            <span class=c1># Calculate reverse explained variance</span>
            <span class=n>rEV</span> <span class=o>=</span> <span class=p>(</span><span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>*</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span> <span class=o>/</span> <span class=p>(</span>
                <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>((</span><span class=mi>1</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>cov</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span> <span class=o>**</span> <span class=mi>2</span><span class=p>))</span> <span class=o>+</span> <span class=mf>1e-10</span>
            <span class=p>)</span>

            <span class=k>return</span> <span class=n>EV</span><span class=p>,</span> <span class=n>rEV</span>

        <span class=n>n_matching</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>matching_paircorr</span><span class=p>)</span>
        <span class=n>n_control</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>control_paircorr</span><span class=p>)</span>
        <span class=n>partial_corr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_control</span><span class=p>,</span> <span class=n>n_matching</span><span class=p>))</span>
        <span class=n>rev_partial_corr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_control</span><span class=p>,</span> <span class=n>n_matching</span><span class=p>))</span>

        <span class=k>for</span> <span class=n>m_i</span><span class=p>,</span> <span class=n>m_pairs</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>matching_paircorr</span><span class=p>):</span>
            <span class=k>for</span> <span class=n>c_i</span><span class=p>,</span> <span class=n>c_pairs</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>control_paircorr</span><span class=p>):</span>
                <span class=n>partial_corr</span><span class=p>[</span><span class=n>c_i</span><span class=p>,</span> <span class=n>m_i</span><span class=p>],</span> <span class=n>rev_partial_corr</span><span class=p>[</span><span class=n>c_i</span><span class=p>,</span> <span class=n>m_i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=n>__explained_variance</span><span class=p>(</span><span class=n>template_corr</span><span class=p>,</span> <span class=n>m_pairs</span><span class=p>,</span> <span class=n>c_pairs</span><span class=p>)</span>
                <span class=p>)</span>
        <span class=k>return</span> <span class=n>partial_corr</span><span class=p>,</span> <span class=n>rev_partial_corr</span>

    <span class=k>def</span><span class=w> </span><span class=nf>__calculate_statistics</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>partial_corr</span><span class=p>,</span> <span class=n>rev_partial_corr</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Calculate explained variance statistics.&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ev</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rev</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>rev_partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ev_std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanstd</span><span class=p>(</span><span class=n>partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rev_std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanstd</span><span class=p>(</span><span class=n>rev_partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>partial_corr</span> <span class=o>=</span> <span class=n>partial_corr</span><span class=o>**</span><span class=mi>2</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rev_partial_corr</span> <span class=o>=</span> <span class=n>rev_partial_corr</span><span class=o>**</span><span class=mi>2</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>n_pairs</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template_corr</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_windows</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>control_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_windows</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>ev_signal</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Return explained variance signal.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>AnalogSignalArray</span><span class=p>(</span>
            <span class=n>data</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>,</span>
            <span class=n>timestamps</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
            <span class=n>fs</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>)[</span><span class=mi>0</span><span class=p>],</span>
            <span class=n>support</span><span class=o>=</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>stop</span><span class=p>]),</span>
        <span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>rev_signal</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Return reverse explained variance signal.&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>AnalogSignalArray</span><span class=p>(</span>
            <span class=n>data</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>rev</span><span class=p>,</span>
            <span class=n>timestamps</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
            <span class=n>fs</span><span class=o>=</span><span class=mi>1</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>)[</span><span class=mi>0</span><span class=p>],</span>
            <span class=n>support</span><span class=o>=</span><span class=n>EpochArray</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching</span><span class=o>.</span><span class=n>stop</span><span class=p>]),</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>pvalue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_shuffles</span><span class=o>=</span><span class=mi>1000</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Calculate p-value for explained variance by shuffling the template correlations.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=kn>from</span><span class=w> </span><span class=nn>copy</span><span class=w> </span><span class=kn>import</span> <span class=n>deepcopy</span>

        <span class=k>def</span><span class=w> </span><span class=nf>shuffle_template</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
            <span class=n>template_corr</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template_corr</span><span class=p>)</span>
            <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>template_corr</span><span class=p>)</span>

            <span class=n>partial_corr</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_partial_correlations_</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>matching_paircorr</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>control_paircorr</span><span class=p>,</span> <span class=n>template_corr</span>
            <span class=p>)</span>
            <span class=n>ev</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>ev</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>

        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Multiple time points, p-values are not supported&quot;</span><span class=p>)</span>
            <span class=k>return</span>

        <span class=n>ev_shuffle</span> <span class=o>=</span> <span class=p>[</span><span class=n>shuffle_template</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_shuffles</span><span class=p>)]</span>

        <span class=n>ev_shuffle</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>ev_shuffle</span><span class=p>)</span>

        <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>ev_shuffle</span><span class=p>)</span>
        <span class=n>r</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>ev_shuffle</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>)</span>
        <span class=n>pvalues</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>pvalues</span>

    <span class=k>def</span><span class=w> </span><span class=nf>plot</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Plot explained variance.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Only single time point, cannot plot&quot;</span><span class=p>)</span>
            <span class=k>return</span>
        <span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>

        <span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;EV&quot;</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>ev</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev_std</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>ev</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev_std</span><span class=p>,</span>
            <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;rEV&quot;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>rev</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev_std</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>rev</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev_std</span><span class=p>,</span>
            <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
            <span class=n>color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=c1># check if matching time overlaps with control time and plot control time</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_time</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=o>&amp;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_time</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
        <span class=p>):</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>axvspan</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>start</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span>
                <span class=n>color</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
                <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span>
                <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Control&quot;</span><span class=p>,</span>
                <span class=n>zorder</span><span class=o>=-</span><span class=mi>10</span><span class=p>,</span>
            <span class=p>)</span>
        <span class=c1># check if matching time overlaps with template time and plot template time</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span>
            <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>start</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=o>&amp;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>stop</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
        <span class=p>):</span>
            <span class=n>ax</span><span class=o>.</span><span class=n>axvspan</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>start</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span>
                <span class=n>color</span><span class=o>=</span><span class=s2>&quot;purple&quot;</span><span class=p>,</span>
                <span class=n>alpha</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span>
                <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Template&quot;</span><span class=p>,</span>
                <span class=n>zorder</span><span class=o>=-</span><span class=mi>10</span><span class=p>,</span>
            <span class=p>)</span>
        <span class=c1># remove axis spines</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;right&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;top&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

        <span class=n>ax</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>frameon</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&quot;Time (s)&quot;</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&quot;Explained Variance&quot;</span><span class=p>)</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&quot;Explained Variance&quot;</span><span class=p>)</span>
        <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=neuro_py.ensemble.ExplainedVariance.ev_signal class="doc doc-heading"> <code class="highlight language-python"><span class=n>ev_signal</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Return explained variance signal.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=neuro_py.ensemble.ExplainedVariance.rev_signal class="doc doc-heading"> <code class="highlight language-python"><span class=n>rev_signal</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Return reverse explained variance signal.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.ExplainedVariance.plot class="doc doc-heading"> <code class="highlight language-python"><span class=n>plot</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Plot explained variance.</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/explained_variance.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>plot</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Plot explained variance.&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Only single time point, cannot plot&quot;</span><span class=p>)</span>
        <span class=k>return</span>
    <span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>

    <span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;EV&quot;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ev</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev_std</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>ev</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev_std</span><span class=p>,</span>
        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;rEV&quot;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>fill_between</span><span class=p>(</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rev</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev_std</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>rev</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>rev_std</span><span class=p>,</span>
        <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
        <span class=n>color</span><span class=o>=</span><span class=s2>&quot;grey&quot;</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=c1># check if matching time overlaps with control time and plot control time</span>
    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_time</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
        <span class=o>&amp;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>control_time</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
    <span class=p>):</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>axvspan</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>start</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>control</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span>
            <span class=n>color</span><span class=o>=</span><span class=s2>&quot;green&quot;</span><span class=p>,</span>
            <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>,</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Control&quot;</span><span class=p>,</span>
            <span class=n>zorder</span><span class=o>=-</span><span class=mi>10</span><span class=p>,</span>
        <span class=p>)</span>
    <span class=c1># check if matching time overlaps with template time and plot template time</span>
    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span>
        <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>start</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
        <span class=o>&amp;</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>stop</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>matching_time</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
    <span class=p>):</span>
        <span class=n>ax</span><span class=o>.</span><span class=n>axvspan</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>start</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>template</span><span class=o>.</span><span class=n>stop</span><span class=p>,</span>
            <span class=n>color</span><span class=o>=</span><span class=s2>&quot;purple&quot;</span><span class=p>,</span>
            <span class=n>alpha</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span>
            <span class=n>label</span><span class=o>=</span><span class=s2>&quot;Template&quot;</span><span class=p>,</span>
            <span class=n>zorder</span><span class=o>=-</span><span class=mi>10</span><span class=p>,</span>
        <span class=p>)</span>
    <span class=c1># remove axis spines</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;right&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>spines</span><span class=p>[</span><span class=s2>&quot;top&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>set_visible</span><span class=p>(</span><span class=kc>False</span><span class=p>)</span>

    <span class=n>ax</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>frameon</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&quot;Time (s)&quot;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&quot;Explained Variance&quot;</span><span class=p>)</span>
    <span class=n>ax</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&quot;Explained Variance&quot;</span><span class=p>)</span>
    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.ExplainedVariance.pvalue class="doc doc-heading"> <code class="highlight language-python"><span class=n>pvalue</span><span class=p>(</span><span class=n>n_shuffles</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Calculate p-value for explained variance by shuffling the template correlations.</p> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/explained_variance.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>pvalue</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_shuffles</span><span class=o>=</span><span class=mi>1000</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate p-value for explained variance by shuffling the template correlations.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=kn>from</span><span class=w> </span><span class=nn>copy</span><span class=w> </span><span class=kn>import</span> <span class=n>deepcopy</span>

    <span class=k>def</span><span class=w> </span><span class=nf>shuffle_template</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=n>template_corr</span> <span class=o>=</span> <span class=n>deepcopy</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>template_corr</span><span class=p>)</span>
        <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>template_corr</span><span class=p>)</span>

        <span class=n>partial_corr</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>__calculate_partial_correlations_</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>matching_paircorr</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>control_paircorr</span><span class=p>,</span> <span class=n>template_corr</span>
        <span class=p>)</span>
        <span class=n>ev</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>partial_corr</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>ev</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>

    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=s2>&quot;Multiple time points, p-values are not supported&quot;</span><span class=p>)</span>
        <span class=k>return</span>

    <span class=n>ev_shuffle</span> <span class=o>=</span> <span class=p>[</span><span class=n>shuffle_template</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_shuffles</span><span class=p>)]</span>

    <span class=n>ev_shuffle</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>ev_shuffle</span><span class=p>)</span>

    <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>ev_shuffle</span><span class=p>)</span>
    <span class=n>r</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>ev_shuffle</span> <span class=o>&gt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>ev</span><span class=p>)</span>
    <span class=n>pvalues</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>pvalues</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=neuro_py.ensemble.PairwiseBias class="doc doc-heading"> <code>PairwiseBias</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><span title=object>object</span></code></p> <p>Pairwise bias analysis for comparing task and post-task spike sequences.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>num_shuffles</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffles to perform for significance testing. Default is 300.</p> </div> </td> <td> <code>300</code> </td> </tr> <tr class=doc-section-item> <td> <code>n_jobs</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of parallel jobs to run for computing correlations. Default is 10.</p> </div> </td> <td> <code>10</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.total_neurons>total_neurons</span></code></td> <td> <code>int, or None</code> </td> <td> <div class=doc-md-description> <p>Total number of neurons in the dataset.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.task_skew_bias>task_skew_bias</span></code></td> <td> <code>np.ndarray, or None</code> </td> <td> <div class=doc-md-description> <p>Normalized skew-bias matrix for the task data.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.observed_correlation_>observed_correlation_</span></code></td> <td> <code>np.ndarray, or None</code> </td> <td> <div class=doc-md-description> <p>Observed cosine similarity between task and post-task bias matrices.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.shuffled_correlations_>shuffled_correlations_</span></code></td> <td> <code>np.ndarray, or None</code> </td> <td> <div class=doc-md-description> <p>Shuffled cosine similarities for significance testing.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.z_score_>z_score_</span></code></td> <td> <code>np.ndarray, or None</code> </td> <td> <div class=doc-md-description> <p>Z-score of the observed correlation compared to the shuffled distribution.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=neuro_py.ensemble.PairwiseBias.p_value_>p_value_</span></code></td> <td> <code>np.ndarray, or None</code> </td> <td> <div class=doc-md-description> <p>p-value for significance test.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Methods:</span></p> <table> <thead> <tr> <th>Name</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.PairwiseBias.fit>fit</a></code></td> <td> <div class=doc-md-description> <p>Fit the model using the task spike data.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.PairwiseBias.transform>transform</a></code></td> <td> <div class=doc-md-description> <p>Transform the post-task data to compute z-scores and p-values.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.PairwiseBias.fit_transform>fit_transform</a></code></td> <td> <div class=doc-md-description> <p>Fit the model with task data and transform the post-task data.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 867</span>
<span class=normal> 868</span>
<span class=normal> 869</span>
<span class=normal> 870</span>
<span class=normal> 871</span>
<span class=normal> 872</span>
<span class=normal> 873</span>
<span class=normal> 874</span>
<span class=normal> 875</span>
<span class=normal> 876</span>
<span class=normal> 877</span>
<span class=normal> 878</span>
<span class=normal> 879</span>
<span class=normal> 880</span>
<span class=normal> 881</span>
<span class=normal> 882</span>
<span class=normal> 883</span>
<span class=normal> 884</span>
<span class=normal> 885</span>
<span class=normal> 886</span>
<span class=normal> 887</span>
<span class=normal> 888</span>
<span class=normal> 889</span>
<span class=normal> 890</span>
<span class=normal> 891</span>
<span class=normal> 892</span>
<span class=normal> 893</span>
<span class=normal> 894</span>
<span class=normal> 895</span>
<span class=normal> 896</span>
<span class=normal> 897</span>
<span class=normal> 898</span>
<span class=normal> 899</span>
<span class=normal> 900</span>
<span class=normal> 901</span>
<span class=normal> 902</span>
<span class=normal> 903</span>
<span class=normal> 904</span>
<span class=normal> 905</span>
<span class=normal> 906</span>
<span class=normal> 907</span>
<span class=normal> 908</span>
<span class=normal> 909</span>
<span class=normal> 910</span>
<span class=normal> 911</span>
<span class=normal> 912</span>
<span class=normal> 913</span>
<span class=normal> 914</span>
<span class=normal> 915</span>
<span class=normal> 916</span>
<span class=normal> 917</span>
<span class=normal> 918</span>
<span class=normal> 919</span>
<span class=normal> 920</span>
<span class=normal> 921</span>
<span class=normal> 922</span>
<span class=normal> 923</span>
<span class=normal> 924</span>
<span class=normal> 925</span>
<span class=normal> 926</span>
<span class=normal> 927</span>
<span class=normal> 928</span>
<span class=normal> 929</span>
<span class=normal> 930</span>
<span class=normal> 931</span>
<span class=normal> 932</span>
<span class=normal> 933</span>
<span class=normal> 934</span>
<span class=normal> 935</span>
<span class=normal> 936</span>
<span class=normal> 937</span>
<span class=normal> 938</span>
<span class=normal> 939</span>
<span class=normal> 940</span>
<span class=normal> 941</span>
<span class=normal> 942</span>
<span class=normal> 943</span>
<span class=normal> 944</span>
<span class=normal> 945</span>
<span class=normal> 946</span>
<span class=normal> 947</span>
<span class=normal> 948</span>
<span class=normal> 949</span>
<span class=normal> 950</span>
<span class=normal> 951</span>
<span class=normal> 952</span>
<span class=normal> 953</span>
<span class=normal> 954</span>
<span class=normal> 955</span>
<span class=normal> 956</span>
<span class=normal> 957</span>
<span class=normal> 958</span>
<span class=normal> 959</span>
<span class=normal> 960</span>
<span class=normal> 961</span>
<span class=normal> 962</span>
<span class=normal> 963</span>
<span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span>
<span class=normal>1027</span>
<span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span>
<span class=normal>1096</span>
<span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span>
<span class=normal>1185</span>
<span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>PairwiseBias</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Pairwise bias analysis for comparing task and post-task spike sequences.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    num_shuffles : int, optional</span>
<span class=sd>        Number of shuffles to perform for significance testing. Default is 300.</span>
<span class=sd>    n_jobs : int, optional</span>
<span class=sd>        Number of parallel jobs to run for computing correlations. Default is 10.</span>

<span class=sd>    Attributes</span>
<span class=sd>    ----------</span>
<span class=sd>    total_neurons : int, or None</span>
<span class=sd>        Total number of neurons in the dataset.</span>
<span class=sd>    task_skew_bias : np.ndarray, or None</span>
<span class=sd>        Normalized skew-bias matrix for the task data.</span>
<span class=sd>    observed_correlation_ : np.ndarray, or None</span>
<span class=sd>        Observed cosine similarity between task and post-task bias matrices.</span>
<span class=sd>    shuffled_correlations_ : np.ndarray, or None</span>
<span class=sd>        Shuffled cosine similarities for significance testing.</span>
<span class=sd>    z_score_ : np.ndarray, or None</span>
<span class=sd>        Z-score of the observed correlation compared to the shuffled distribution.</span>
<span class=sd>    p_value_ : np.ndarray, or None</span>
<span class=sd>        p-value for significance test.</span>

<span class=sd>    Methods</span>
<span class=sd>    -------</span>
<span class=sd>    fit(task_spikes: Union[List[float], np.ndarray], task_neurons: Union[List[int], np.ndarray]) -&gt; &#39;PairwiseBias&#39;</span>
<span class=sd>        Fit the model using the task spike data.</span>
<span class=sd>    transform(post_spikes: Union[List[float], np.ndarray], post_neurons: Union[List[int], np.ndarray], post_intervals: np.ndarray) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>        Transform the post-task data to compute z-scores and p-values.</span>
<span class=sd>    fit_transform(task_spikes: Union[List[float], np.ndarray], task_neurons: Union[List[int], np.ndarray], post_spikes: Union[List[float], np.ndarray], post_neurons: Union[List[int], np.ndarray], post_intervals: np.ndarray) -&gt; Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>        Fit the model with task data and transform the post-task data.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>num_shuffles</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>300</span><span class=p>,</span> <span class=n>n_jobs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=n>fillneutral</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
    <span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>num_shuffles</span> <span class=o>=</span> <span class=n>num_shuffles</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span> <span class=o>=</span> <span class=n>n_jobs</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span> <span class=o>=</span> <span class=n>fillneutral</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>z_score_</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>p_value_</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>bias_matrix</span><span class=p>(</span>
        <span class=n>spike_times</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>neuron_ids</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>total_neurons</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
        <span class=n>fillneutral</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Optimized computation of the bias matrix B_k for a given sequence of spikes using vectorized operations.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        spike_times : np.ndarray</span>
<span class=sd>            Spike times for the sequence.</span>
<span class=sd>        neuron_ids : np.ndarray</span>
<span class=sd>            Neuron identifiers corresponding to spike_times.</span>
<span class=sd>        total_neurons : int</span>
<span class=sd>            Total number of neurons being considered.</span>
<span class=sd>        fillneutral : float, optional</span>
<span class=sd>            Value to fill the diagonal of the bias matrix and other empty</span>
<span class=sd>            combinations, by default np.nan.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        np.ndarray</span>
<span class=sd>            A matrix of size (total_neurons, total_neurons) representing the bias.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>skew_bias_matrix</span><span class=p>(</span><span class=n>spike_times</span><span class=p>,</span> <span class=n>neuron_ids</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>fillneutral</span><span class=p>)</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Computes the cosine similarity between two flattened bias matrices.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        matrix1 : np.ndarray</span>
<span class=sd>            A normalized bias matrix.</span>
<span class=sd>        matrix2 : np.ndarray</span>
<span class=sd>            Another normalized bias matrix.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        float</span>
<span class=sd>            The cosine similarity between the two matrices.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>observed_and_shuffled_correlation</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>task_skew_bias</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>interval_i</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Compute observed and shuffled correlation for a given post-task interval.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        post_spikes : np.ndarray</span>
<span class=sd>            Spike times during post-task (e.g., sleep).</span>
<span class=sd>        post_neurons : np.ndarray</span>
<span class=sd>            Neuron identifiers for post-task spikes.</span>
<span class=sd>        task_normalized : np.ndarray</span>
<span class=sd>            Normalized task bias matrix.</span>
<span class=sd>        post_intervals : np.ndarray</span>
<span class=sd>            Intervals for post-task epochs.</span>
<span class=sd>        interval_i : int</span>
<span class=sd>            Index of the current post-task interval.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Tuple[float, List[float]]</span>
<span class=sd>            The observed correlation and a list of shuffled correlations.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>post_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>post_neurons</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>

        <span class=n>start</span><span class=p>,</span> <span class=n>end</span> <span class=o>=</span> <span class=n>post_intervals</span><span class=p>[</span><span class=n>interval_i</span><span class=p>]</span>
        <span class=n>start_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;left&quot;</span><span class=p>)</span>
        <span class=n>end_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>end</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span>

        <span class=n>filtered_spikes</span> <span class=o>=</span> <span class=n>post_spikes</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>
        <span class=n>filtered_neurons</span> <span class=o>=</span> <span class=n>post_neurons</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>

        <span class=n>post_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
            <span class=n>filtered_spikes</span><span class=p>,</span>
            <span class=n>filtered_neurons</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
            <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
        <span class=p>)</span>

        <span class=n>observed_correlation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cosine_similarity_matrices</span><span class=p>(</span>
            <span class=n>task_skew_bias</span><span class=p>,</span> <span class=n>post_skew_bias</span>
        <span class=p>)</span>

        <span class=n>shuffled_correlation</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_shuffles</span><span class=p>):</span>
            <span class=n>shuffled_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>filtered_neurons</span><span class=p>)</span>
            <span class=n>shuffled_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
                <span class=n>filtered_spikes</span><span class=p>,</span>
                <span class=n>shuffled_neurons</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
                <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=n>shuffled_correlation</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>task_skew_bias</span><span class=p>,</span> <span class=n>shuffled_skew_bias</span><span class=p>)</span>
            <span class=p>)</span>

        <span class=k>return</span> <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlation</span>

    <span class=k>def</span><span class=w> </span><span class=nf>fit</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>task_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>task_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>task_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;PairwiseBias&quot;</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Fit the model using the task spike data.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        task_spikes : np.ndarray</span>
<span class=sd>            Spike times during the task.</span>
<span class=sd>        task_neurons : np.ndarray</span>
<span class=sd>            Neuron identifiers for task spikes.</span>
<span class=sd>        task_intervals : np.ndarray, optional</span>
<span class=sd>            Intervals for task epochs, by default None. If None, the entire task</span>
<span class=sd>            data is used. Otherwise, the average bias matrix is computed across</span>
<span class=sd>            all task intervals. Shape: (n_intervals, 2).</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        PairwiseBias</span>
<span class=sd>            Returns the instance itself.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Convert task_neurons to numpy array of integers</span>
        <span class=n>task_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>task_neurons</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>

        <span class=c1># Calculate the total number of neurons based on unique entries in task_neurons</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>task_neurons</span><span class=p>))</span>

        <span class=k>if</span> <span class=n>task_intervals</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># Compute bias matrix for task data and normalize</span>
            <span class=n>task_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
                <span class=n>task_spikes</span><span class=p>,</span>
                <span class=n>task_neurons</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
                <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span> <span class=o>=</span> <span class=n>task_skew_bias</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Compute bias matrices for each task interval</span>
            <span class=n>task_skew_biases</span> <span class=o>=</span> <span class=p>[]</span>

            <span class=k>for</span> <span class=n>interval</span> <span class=ow>in</span> <span class=n>task_intervals</span><span class=p>:</span>
                <span class=c1># find the indices of spikes within the interval</span>
                <span class=n>start_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;left&quot;</span><span class=p>)</span>
                <span class=n>end_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span>

                <span class=c1># Extract spikes and neurons within the interval</span>
                <span class=n>interval_spikes</span> <span class=o>=</span> <span class=n>task_spikes</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>
                <span class=n>interval_neurons</span> <span class=o>=</span> <span class=n>task_neurons</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>

                <span class=c1># Compute the bias matrix for the interval</span>
                <span class=n>interval_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
                    <span class=n>interval_spikes</span><span class=p>,</span>
                    <span class=n>interval_neurons</span><span class=p>,</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
                    <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=n>task_skew_biases</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>interval_skew_bias</span><span class=p>)</span>

            <span class=c1># Average the normalized bias matrices</span>
            <span class=c1># I expect to see RuntimeWarnings in this block</span>
            <span class=k>with</span> <span class=n>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=p>():</span>
                <span class=n>warnings</span><span class=o>.</span><span class=n>simplefilter</span><span class=p>(</span><span class=s2>&quot;ignore&quot;</span><span class=p>,</span> <span class=n>category</span><span class=o>=</span><span class=ne>RuntimeWarning</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>task_skew_biases</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span>

    <span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>allow_reverse_replay</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>parallel</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Transform the post-task data to compute z-scores and p-values.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        post_spikes : np.ndarray</span>
<span class=sd>            Spike times during post-task (e.g., sleep).</span>
<span class=sd>        post_neurons : np.ndarray</span>
<span class=sd>            Neuron identifiers for post-task spikes.</span>
<span class=sd>        post_intervals : np.ndarray</span>
<span class=sd>            Intervals for post-task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>        allow_reverse_replay : bool, optional</span>
<span class=sd>            Whether to allow reverse sequences, by default False.</span>
<span class=sd>        parallel : bool, optional</span>
<span class=sd>            Whether to run in parallel, by default True.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>            z_score: The z-score of the observed correlation compared to the shuffled distribution.</span>
<span class=sd>            p_value: p-value for significance test.</span>
<span class=sd>            observed_correlation_: The observed correlation for each interval.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Check if the number of jobs is less than the number of intervals</span>
        <span class=k>if</span> <span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span> <span class=o>=</span> <span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

        <span class=k>if</span> <span class=n>parallel</span><span class=p>:</span>
            <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
                <span class=o>*</span><span class=n>Parallel</span><span class=p>(</span><span class=n>n_jobs</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span><span class=p>)(</span>
                    <span class=n>delayed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>observed_and_shuffled_correlation</span><span class=p>)(</span>
                        <span class=n>post_spikes</span><span class=p>,</span>
                        <span class=n>post_neurons</span><span class=p>,</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span><span class=p>,</span>
                        <span class=n>post_intervals</span><span class=p>,</span>
                        <span class=n>interval_i</span><span class=p>,</span>
                    <span class=p>)</span>
                    <span class=k>for</span> <span class=n>interval_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
                <span class=p>)</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>  <span class=c1># Run in serial for debugging</span>
            <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
                <span class=o>*</span><span class=p>[</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>observed_and_shuffled_correlation</span><span class=p>(</span>
                        <span class=n>post_spikes</span><span class=p>,</span>
                        <span class=n>post_neurons</span><span class=p>,</span>
                        <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span><span class=p>,</span>
                        <span class=n>post_intervals</span><span class=p>,</span>
                        <span class=n>interval_i</span><span class=p>,</span>
                    <span class=p>)</span>
                    <span class=k>for</span> <span class=n>interval_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
                <span class=p>]</span>
            <span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
            <span class=n>observed_correlation</span>
        <span class=p>)</span>  <span class=c1># Shape: (n_intervals,)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
            <span class=n>shuffled_correlations</span>
        <span class=p>)</span>  <span class=c1># Shape: (n_intervals, n_shuffles)</span>

        <span class=n>shuffled_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>shuffled_std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>z_score_</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span> <span class=o>-</span> <span class=n>shuffled_mean</span><span class=p>)</span> <span class=o>/</span> <span class=n>shuffled_std</span>

        <span class=n>observed_correlation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span>
        <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span>
        <span class=k>if</span> <span class=n>allow_reverse_replay</span><span class=p>:</span>
            <span class=n>observed_correlation</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>observed_correlation</span><span class=p>)</span>
            <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=p>)</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>p_value_</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
                <span class=n>shuffled_correlations</span><span class=o>.</span><span class=n>T</span> <span class=o>&gt;</span> <span class=n>observed_correlation</span><span class=p>,</span>
                <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=o>+</span> <span class=mi>1</span>
        <span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_shuffles</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>z_score_</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p_value_</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span>

    <span class=k>def</span><span class=w> </span><span class=nf>fit_transform</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>task_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>task_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>task_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
        <span class=n>allow_reverse_replay</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
        <span class=n>parallel</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Fit the model with task data and transform the post-task data.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        task_spikes : np.ndarray</span>
<span class=sd>            Spike times during the task.</span>
<span class=sd>        task_neurons : np.ndarray</span>
<span class=sd>            Neuron identifiers for task spikes.</span>
<span class=sd>        task_intervals : np.ndarray</span>
<span class=sd>            Intervals for task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>        post_spikes : np.ndarray</span>
<span class=sd>            Spike times during post-task (e.g., sleep).</span>
<span class=sd>        post_neurons : np.ndarray</span>
<span class=sd>            Neuron identifiers for post-task spikes.</span>
<span class=sd>        post_intervals : np.ndarray</span>
<span class=sd>            Intervals for post-task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>        allow_reverse_replay : bool, optional</span>
<span class=sd>            Whether to allow reverse sequences, by default False.</span>
<span class=sd>        parallel : bool, optional</span>
<span class=sd>            Whether to run in parallel, by default True.</span>

<span class=sd>        Returns</span>
<span class=sd>        -------</span>
<span class=sd>        Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>            z_score: The z-score of the observed correlation compared to the shuffled distribution.</span>
<span class=sd>            p_value: p-value for significance test.</span>
<span class=sd>            observed_correlation_: The observed correlation for each interval.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>task_intervals</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span>
            <span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>allow_reverse_replay</span><span class=p>,</span> <span class=n>parallel</span>
        <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.bias_matrix class="doc doc-heading"> <code class="highlight language-python"><span class=n>bias_matrix</span><span class=p>(</span><span class=n>spike_times</span><span class=p>,</span> <span class=n>neuron_ids</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>fillneutral</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Optimized computation of the bias matrix B_k for a given sequence of spikes using vectorized operations.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spike_times</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times for the sequence.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>neuron_ids</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers corresponding to spike_times.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>total_neurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Total number of neurons being considered.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fillneutral</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Value to fill the diagonal of the bias matrix and other empty combinations, by default np.nan.</p> </div> </td> <td> <code><span title=numpy.nan>nan</span></code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A matrix of size (total_neurons, total_neurons) representing the bias.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>916</span>
<span class=normal>917</span>
<span class=normal>918</span>
<span class=normal>919</span>
<span class=normal>920</span>
<span class=normal>921</span>
<span class=normal>922</span>
<span class=normal>923</span>
<span class=normal>924</span>
<span class=normal>925</span>
<span class=normal>926</span>
<span class=normal>927</span>
<span class=normal>928</span>
<span class=normal>929</span>
<span class=normal>930</span>
<span class=normal>931</span>
<span class=normal>932</span>
<span class=normal>933</span>
<span class=normal>934</span>
<span class=normal>935</span>
<span class=normal>936</span>
<span class=normal>937</span>
<span class=normal>938</span>
<span class=normal>939</span>
<span class=normal>940</span>
<span class=normal>941</span>
<span class=normal>942</span>
<span class=normal>943</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>bias_matrix</span><span class=p>(</span>
    <span class=n>spike_times</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>neuron_ids</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>total_neurons</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>fillneutral</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Optimized computation of the bias matrix B_k for a given sequence of spikes using vectorized operations.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    spike_times : np.ndarray</span>
<span class=sd>        Spike times for the sequence.</span>
<span class=sd>    neuron_ids : np.ndarray</span>
<span class=sd>        Neuron identifiers corresponding to spike_times.</span>
<span class=sd>    total_neurons : int</span>
<span class=sd>        Total number of neurons being considered.</span>
<span class=sd>    fillneutral : float, optional</span>
<span class=sd>        Value to fill the diagonal of the bias matrix and other empty</span>
<span class=sd>        combinations, by default np.nan.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        A matrix of size (total_neurons, total_neurons) representing the bias.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>skew_bias_matrix</span><span class=p>(</span><span class=n>spike_times</span><span class=p>,</span> <span class=n>neuron_ids</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>fillneutral</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.cosine_similarity_matrices class="doc doc-heading"> <code class="highlight language-python"><span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Computes the cosine similarity between two flattened bias matrices.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>matrix1</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A normalized bias matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>matrix2</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Another normalized bias matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The cosine similarity between the two matrices.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>945</span>
<span class=normal>946</span>
<span class=normal>947</span>
<span class=normal>948</span>
<span class=normal>949</span>
<span class=normal>950</span>
<span class=normal>951</span>
<span class=normal>952</span>
<span class=normal>953</span>
<span class=normal>954</span>
<span class=normal>955</span>
<span class=normal>956</span>
<span class=normal>957</span>
<span class=normal>958</span>
<span class=normal>959</span>
<span class=normal>960</span>
<span class=normal>961</span>
<span class=normal>962</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Computes the cosine similarity between two flattened bias matrices.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    matrix1 : np.ndarray</span>
<span class=sd>        A normalized bias matrix.</span>
<span class=sd>    matrix2 : np.ndarray</span>
<span class=sd>        Another normalized bias matrix.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        The cosine similarity between the two matrices.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.fit class="doc doc-heading"> <code class="highlight language-python"><span class=n>fit</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>task_intervals</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Fit the model using the task spike data.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>task_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times during the task.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers for task spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for task epochs, by default None. If None, the entire task data is used. Otherwise, the average bias matrix is computed across all task intervals. Shape: (n_intervals, 2).</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><a class="autorefs autorefs-internal" href=replay/#neuro_py.ensemble.replay.PairwiseBias>PairwiseBias</a></code> </td> <td> <div class=doc-md-description> <p>Returns the instance itself.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1028</span>
<span class=normal>1029</span>
<span class=normal>1030</span>
<span class=normal>1031</span>
<span class=normal>1032</span>
<span class=normal>1033</span>
<span class=normal>1034</span>
<span class=normal>1035</span>
<span class=normal>1036</span>
<span class=normal>1037</span>
<span class=normal>1038</span>
<span class=normal>1039</span>
<span class=normal>1040</span>
<span class=normal>1041</span>
<span class=normal>1042</span>
<span class=normal>1043</span>
<span class=normal>1044</span>
<span class=normal>1045</span>
<span class=normal>1046</span>
<span class=normal>1047</span>
<span class=normal>1048</span>
<span class=normal>1049</span>
<span class=normal>1050</span>
<span class=normal>1051</span>
<span class=normal>1052</span>
<span class=normal>1053</span>
<span class=normal>1054</span>
<span class=normal>1055</span>
<span class=normal>1056</span>
<span class=normal>1057</span>
<span class=normal>1058</span>
<span class=normal>1059</span>
<span class=normal>1060</span>
<span class=normal>1061</span>
<span class=normal>1062</span>
<span class=normal>1063</span>
<span class=normal>1064</span>
<span class=normal>1065</span>
<span class=normal>1066</span>
<span class=normal>1067</span>
<span class=normal>1068</span>
<span class=normal>1069</span>
<span class=normal>1070</span>
<span class=normal>1071</span>
<span class=normal>1072</span>
<span class=normal>1073</span>
<span class=normal>1074</span>
<span class=normal>1075</span>
<span class=normal>1076</span>
<span class=normal>1077</span>
<span class=normal>1078</span>
<span class=normal>1079</span>
<span class=normal>1080</span>
<span class=normal>1081</span>
<span class=normal>1082</span>
<span class=normal>1083</span>
<span class=normal>1084</span>
<span class=normal>1085</span>
<span class=normal>1086</span>
<span class=normal>1087</span>
<span class=normal>1088</span>
<span class=normal>1089</span>
<span class=normal>1090</span>
<span class=normal>1091</span>
<span class=normal>1092</span>
<span class=normal>1093</span>
<span class=normal>1094</span>
<span class=normal>1095</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>fit</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>task_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&quot;PairwiseBias&quot;</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Fit the model using the task spike data.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    task_spikes : np.ndarray</span>
<span class=sd>        Spike times during the task.</span>
<span class=sd>    task_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers for task spikes.</span>
<span class=sd>    task_intervals : np.ndarray, optional</span>
<span class=sd>        Intervals for task epochs, by default None. If None, the entire task</span>
<span class=sd>        data is used. Otherwise, the average bias matrix is computed across</span>
<span class=sd>        all task intervals. Shape: (n_intervals, 2).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    PairwiseBias</span>
<span class=sd>        Returns the instance itself.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Convert task_neurons to numpy array of integers</span>
    <span class=n>task_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>task_neurons</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>

    <span class=c1># Calculate the total number of neurons based on unique entries in task_neurons</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>task_neurons</span><span class=p>))</span>

    <span class=k>if</span> <span class=n>task_intervals</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=c1># Compute bias matrix for task data and normalize</span>
        <span class=n>task_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
            <span class=n>task_spikes</span><span class=p>,</span>
            <span class=n>task_neurons</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
            <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span> <span class=o>=</span> <span class=n>task_skew_bias</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># Compute bias matrices for each task interval</span>
        <span class=n>task_skew_biases</span> <span class=o>=</span> <span class=p>[]</span>

        <span class=k>for</span> <span class=n>interval</span> <span class=ow>in</span> <span class=n>task_intervals</span><span class=p>:</span>
            <span class=c1># find the indices of spikes within the interval</span>
            <span class=n>start_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;left&quot;</span><span class=p>)</span>
            <span class=n>end_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>interval</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span>

            <span class=c1># Extract spikes and neurons within the interval</span>
            <span class=n>interval_spikes</span> <span class=o>=</span> <span class=n>task_spikes</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>
            <span class=n>interval_neurons</span> <span class=o>=</span> <span class=n>task_neurons</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>

            <span class=c1># Compute the bias matrix for the interval</span>
            <span class=n>interval_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
                <span class=n>interval_spikes</span><span class=p>,</span>
                <span class=n>interval_neurons</span><span class=p>,</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
                <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=n>task_skew_biases</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>interval_skew_bias</span><span class=p>)</span>

        <span class=c1># Average the normalized bias matrices</span>
        <span class=c1># I expect to see RuntimeWarnings in this block</span>
        <span class=k>with</span> <span class=n>warnings</span><span class=o>.</span><span class=n>catch_warnings</span><span class=p>():</span>
            <span class=n>warnings</span><span class=o>.</span><span class=n>simplefilter</span><span class=p>(</span><span class=s2>&quot;ignore&quot;</span><span class=p>,</span> <span class=n>category</span><span class=o>=</span><span class=ne>RuntimeWarning</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>task_skew_biases</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
    <span class=k>return</span> <span class=bp>self</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.fit_transform class="doc doc-heading"> <code class="highlight language-python"><span class=n>fit_transform</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>task_intervals</span><span class=p>,</span> <span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>allow_reverse_replay</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>parallel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Fit the model with task data and transform the post-task data.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>task_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times during the task.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers for task spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for task epochs. Shape: (n_intervals, 2).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times during post-task (e.g., sleep).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers for post-task spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for post-task epochs. Shape: (n_intervals, 2).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>allow_reverse_replay</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to allow reverse sequences, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>parallel</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to run in parallel, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>z_score: The z-score of the observed correlation compared to the shuffled distribution. p_value: p-value for significance test. observed_correlation_: The observed correlation for each interval.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1186</span>
<span class=normal>1187</span>
<span class=normal>1188</span>
<span class=normal>1189</span>
<span class=normal>1190</span>
<span class=normal>1191</span>
<span class=normal>1192</span>
<span class=normal>1193</span>
<span class=normal>1194</span>
<span class=normal>1195</span>
<span class=normal>1196</span>
<span class=normal>1197</span>
<span class=normal>1198</span>
<span class=normal>1199</span>
<span class=normal>1200</span>
<span class=normal>1201</span>
<span class=normal>1202</span>
<span class=normal>1203</span>
<span class=normal>1204</span>
<span class=normal>1205</span>
<span class=normal>1206</span>
<span class=normal>1207</span>
<span class=normal>1208</span>
<span class=normal>1209</span>
<span class=normal>1210</span>
<span class=normal>1211</span>
<span class=normal>1212</span>
<span class=normal>1213</span>
<span class=normal>1214</span>
<span class=normal>1215</span>
<span class=normal>1216</span>
<span class=normal>1217</span>
<span class=normal>1218</span>
<span class=normal>1219</span>
<span class=normal>1220</span>
<span class=normal>1221</span>
<span class=normal>1222</span>
<span class=normal>1223</span>
<span class=normal>1224</span>
<span class=normal>1225</span>
<span class=normal>1226</span>
<span class=normal>1227</span>
<span class=normal>1228</span>
<span class=normal>1229</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>fit_transform</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>task_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>allow_reverse_replay</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>parallel</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Fit the model with task data and transform the post-task data.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    task_spikes : np.ndarray</span>
<span class=sd>        Spike times during the task.</span>
<span class=sd>    task_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers for task spikes.</span>
<span class=sd>    task_intervals : np.ndarray</span>
<span class=sd>        Intervals for task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>    post_spikes : np.ndarray</span>
<span class=sd>        Spike times during post-task (e.g., sleep).</span>
<span class=sd>    post_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers for post-task spikes.</span>
<span class=sd>    post_intervals : np.ndarray</span>
<span class=sd>        Intervals for post-task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>    allow_reverse_replay : bool, optional</span>
<span class=sd>        Whether to allow reverse sequences, by default False.</span>
<span class=sd>    parallel : bool, optional</span>
<span class=sd>        Whether to run in parallel, by default True.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>        z_score: The z-score of the observed correlation compared to the shuffled distribution.</span>
<span class=sd>        p_value: p-value for significance test.</span>
<span class=sd>        observed_correlation_: The observed correlation for each interval.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>task_intervals</span><span class=p>)</span>
    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span>
        <span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>allow_reverse_replay</span><span class=p>,</span> <span class=n>parallel</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.observed_and_shuffled_correlation class="doc doc-heading"> <code class="highlight language-python"><span class=n>observed_and_shuffled_correlation</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>task_skew_bias</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>interval_i</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Compute observed and shuffled correlation for a given post-task interval.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>post_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times during post-task (e.g., sleep).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers for post-task spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_normalized</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Normalized task bias matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for post-task epochs.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>interval_i</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of the current post-task interval.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=float>float</span>, <span title=typing.List>List</span>[<span title=float>float</span>]]</code> </td> <td> <div class=doc-md-description> <p>The observed correlation and a list of shuffled correlations.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 964</span>
<span class=normal> 965</span>
<span class=normal> 966</span>
<span class=normal> 967</span>
<span class=normal> 968</span>
<span class=normal> 969</span>
<span class=normal> 970</span>
<span class=normal> 971</span>
<span class=normal> 972</span>
<span class=normal> 973</span>
<span class=normal> 974</span>
<span class=normal> 975</span>
<span class=normal> 976</span>
<span class=normal> 977</span>
<span class=normal> 978</span>
<span class=normal> 979</span>
<span class=normal> 980</span>
<span class=normal> 981</span>
<span class=normal> 982</span>
<span class=normal> 983</span>
<span class=normal> 984</span>
<span class=normal> 985</span>
<span class=normal> 986</span>
<span class=normal> 987</span>
<span class=normal> 988</span>
<span class=normal> 989</span>
<span class=normal> 990</span>
<span class=normal> 991</span>
<span class=normal> 992</span>
<span class=normal> 993</span>
<span class=normal> 994</span>
<span class=normal> 995</span>
<span class=normal> 996</span>
<span class=normal> 997</span>
<span class=normal> 998</span>
<span class=normal> 999</span>
<span class=normal>1000</span>
<span class=normal>1001</span>
<span class=normal>1002</span>
<span class=normal>1003</span>
<span class=normal>1004</span>
<span class=normal>1005</span>
<span class=normal>1006</span>
<span class=normal>1007</span>
<span class=normal>1008</span>
<span class=normal>1009</span>
<span class=normal>1010</span>
<span class=normal>1011</span>
<span class=normal>1012</span>
<span class=normal>1013</span>
<span class=normal>1014</span>
<span class=normal>1015</span>
<span class=normal>1016</span>
<span class=normal>1017</span>
<span class=normal>1018</span>
<span class=normal>1019</span>
<span class=normal>1020</span>
<span class=normal>1021</span>
<span class=normal>1022</span>
<span class=normal>1023</span>
<span class=normal>1024</span>
<span class=normal>1025</span>
<span class=normal>1026</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>observed_and_shuffled_correlation</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_skew_bias</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>interval_i</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute observed and shuffled correlation for a given post-task interval.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    post_spikes : np.ndarray</span>
<span class=sd>        Spike times during post-task (e.g., sleep).</span>
<span class=sd>    post_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers for post-task spikes.</span>
<span class=sd>    task_normalized : np.ndarray</span>
<span class=sd>        Normalized task bias matrix.</span>
<span class=sd>    post_intervals : np.ndarray</span>
<span class=sd>        Intervals for post-task epochs.</span>
<span class=sd>    interval_i : int</span>
<span class=sd>        Index of the current post-task interval.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[float, List[float]]</span>
<span class=sd>        The observed correlation and a list of shuffled correlations.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>post_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>post_neurons</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>

    <span class=n>start</span><span class=p>,</span> <span class=n>end</span> <span class=o>=</span> <span class=n>post_intervals</span><span class=p>[</span><span class=n>interval_i</span><span class=p>]</span>
    <span class=n>start_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;left&quot;</span><span class=p>)</span>
    <span class=n>end_idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>end</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span>

    <span class=n>filtered_spikes</span> <span class=o>=</span> <span class=n>post_spikes</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>
    <span class=n>filtered_neurons</span> <span class=o>=</span> <span class=n>post_neurons</span><span class=p>[</span><span class=n>start_idx</span><span class=p>:</span><span class=n>end_idx</span><span class=p>]</span>

    <span class=n>post_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
        <span class=n>filtered_spikes</span><span class=p>,</span>
        <span class=n>filtered_neurons</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
        <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
    <span class=p>)</span>

    <span class=n>observed_correlation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cosine_similarity_matrices</span><span class=p>(</span>
        <span class=n>task_skew_bias</span><span class=p>,</span> <span class=n>post_skew_bias</span>
    <span class=p>)</span>

    <span class=n>shuffled_correlation</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_shuffles</span><span class=p>):</span>
        <span class=n>shuffled_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>filtered_neurons</span><span class=p>)</span>
        <span class=n>shuffled_skew_bias</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>bias_matrix</span><span class=p>(</span>
            <span class=n>filtered_spikes</span><span class=p>,</span>
            <span class=n>shuffled_neurons</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>total_neurons</span><span class=p>,</span>
            <span class=n>fillneutral</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fillneutral</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=n>shuffled_correlation</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>task_skew_bias</span><span class=p>,</span> <span class=n>shuffled_skew_bias</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=k>return</span> <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlation</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=neuro_py.ensemble.PairwiseBias.transform class="doc doc-heading"> <code class="highlight language-python"><span class=n>transform</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>allow_reverse_replay</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>parallel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Transform the post-task data to compute z-scores and p-values.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>post_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times during post-task (e.g., sleep).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers for post-task spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for post-task epochs. Shape: (n_intervals, 2).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>allow_reverse_replay</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to allow reverse sequences, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>parallel</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to run in parallel, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>z_score: The z-score of the observed correlation compared to the shuffled distribution. p_value: p-value for significance test. observed_correlation_: The observed correlation for each interval.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1097</span>
<span class=normal>1098</span>
<span class=normal>1099</span>
<span class=normal>1100</span>
<span class=normal>1101</span>
<span class=normal>1102</span>
<span class=normal>1103</span>
<span class=normal>1104</span>
<span class=normal>1105</span>
<span class=normal>1106</span>
<span class=normal>1107</span>
<span class=normal>1108</span>
<span class=normal>1109</span>
<span class=normal>1110</span>
<span class=normal>1111</span>
<span class=normal>1112</span>
<span class=normal>1113</span>
<span class=normal>1114</span>
<span class=normal>1115</span>
<span class=normal>1116</span>
<span class=normal>1117</span>
<span class=normal>1118</span>
<span class=normal>1119</span>
<span class=normal>1120</span>
<span class=normal>1121</span>
<span class=normal>1122</span>
<span class=normal>1123</span>
<span class=normal>1124</span>
<span class=normal>1125</span>
<span class=normal>1126</span>
<span class=normal>1127</span>
<span class=normal>1128</span>
<span class=normal>1129</span>
<span class=normal>1130</span>
<span class=normal>1131</span>
<span class=normal>1132</span>
<span class=normal>1133</span>
<span class=normal>1134</span>
<span class=normal>1135</span>
<span class=normal>1136</span>
<span class=normal>1137</span>
<span class=normal>1138</span>
<span class=normal>1139</span>
<span class=normal>1140</span>
<span class=normal>1141</span>
<span class=normal>1142</span>
<span class=normal>1143</span>
<span class=normal>1144</span>
<span class=normal>1145</span>
<span class=normal>1146</span>
<span class=normal>1147</span>
<span class=normal>1148</span>
<span class=normal>1149</span>
<span class=normal>1150</span>
<span class=normal>1151</span>
<span class=normal>1152</span>
<span class=normal>1153</span>
<span class=normal>1154</span>
<span class=normal>1155</span>
<span class=normal>1156</span>
<span class=normal>1157</span>
<span class=normal>1158</span>
<span class=normal>1159</span>
<span class=normal>1160</span>
<span class=normal>1161</span>
<span class=normal>1162</span>
<span class=normal>1163</span>
<span class=normal>1164</span>
<span class=normal>1165</span>
<span class=normal>1166</span>
<span class=normal>1167</span>
<span class=normal>1168</span>
<span class=normal>1169</span>
<span class=normal>1170</span>
<span class=normal>1171</span>
<span class=normal>1172</span>
<span class=normal>1173</span>
<span class=normal>1174</span>
<span class=normal>1175</span>
<span class=normal>1176</span>
<span class=normal>1177</span>
<span class=normal>1178</span>
<span class=normal>1179</span>
<span class=normal>1180</span>
<span class=normal>1181</span>
<span class=normal>1182</span>
<span class=normal>1183</span>
<span class=normal>1184</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>allow_reverse_replay</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>parallel</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Transform the post-task data to compute z-scores and p-values.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    post_spikes : np.ndarray</span>
<span class=sd>        Spike times during post-task (e.g., sleep).</span>
<span class=sd>    post_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers for post-task spikes.</span>
<span class=sd>    post_intervals : np.ndarray</span>
<span class=sd>        Intervals for post-task epochs. Shape: (n_intervals, 2).</span>
<span class=sd>    allow_reverse_replay : bool, optional</span>
<span class=sd>        Whether to allow reverse sequences, by default False.</span>
<span class=sd>    parallel : bool, optional</span>
<span class=sd>        Whether to run in parallel, by default True.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[np.ndarray, np.ndarray, np.ndarray]</span>
<span class=sd>        z_score: The z-score of the observed correlation compared to the shuffled distribution.</span>
<span class=sd>        p_value: p-value for significance test.</span>
<span class=sd>        observed_correlation_: The observed correlation for each interval.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Check if the number of jobs is less than the number of intervals</span>
    <span class=k>if</span> <span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span> <span class=o>=</span> <span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>parallel</span><span class=p>:</span>
        <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
            <span class=o>*</span><span class=n>Parallel</span><span class=p>(</span><span class=n>n_jobs</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>n_jobs</span><span class=p>)(</span>
                <span class=n>delayed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>observed_and_shuffled_correlation</span><span class=p>)(</span>
                    <span class=n>post_spikes</span><span class=p>,</span>
                    <span class=n>post_neurons</span><span class=p>,</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span><span class=p>,</span>
                    <span class=n>post_intervals</span><span class=p>,</span>
                    <span class=n>interval_i</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>interval_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>)</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>  <span class=c1># Run in serial for debugging</span>
        <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
            <span class=o>*</span><span class=p>[</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>observed_and_shuffled_correlation</span><span class=p>(</span>
                    <span class=n>post_spikes</span><span class=p>,</span>
                    <span class=n>post_neurons</span><span class=p>,</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>task_skew_bias</span><span class=p>,</span>
                    <span class=n>post_intervals</span><span class=p>,</span>
                    <span class=n>interval_i</span><span class=p>,</span>
                <span class=p>)</span>
                <span class=k>for</span> <span class=n>interval_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
            <span class=p>]</span>
        <span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
        <span class=n>observed_correlation</span>
    <span class=p>)</span>  <span class=c1># Shape: (n_intervals,)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span>
        <span class=n>shuffled_correlations</span>
    <span class=p>)</span>  <span class=c1># Shape: (n_intervals, n_shuffles)</span>

    <span class=n>shuffled_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>shuffled_std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>z_score_</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span> <span class=o>-</span> <span class=n>shuffled_mean</span><span class=p>)</span> <span class=o>/</span> <span class=n>shuffled_std</span>

    <span class=n>observed_correlation</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span>
    <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>shuffled_correlations_</span>
    <span class=k>if</span> <span class=n>allow_reverse_replay</span><span class=p>:</span>
        <span class=n>observed_correlation</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>observed_correlation</span><span class=p>)</span>
        <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=p>)</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>p_value_</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span>
            <span class=n>shuffled_correlations</span><span class=o>.</span><span class=n>T</span> <span class=o>&gt;</span> <span class=n>observed_correlation</span><span class=p>,</span>
            <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=o>+</span> <span class=mi>1</span>
    <span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>num_shuffles</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>

    <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>z_score_</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p_value_</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>observed_correlation_</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.WeightedCorr class="doc doc-heading"> <code class="highlight language-python"><span class=n>WeightedCorr</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate the weighted correlation between the X and Y dimensions of the matrix.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>weights</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A matrix of weights.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>x</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>X-values for each column and row, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>y</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Y-values for each column and row, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The weighted correlation coefficient.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>WeightedCorr</span><span class=p>(</span>
    <span class=n>weights</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>x</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>y</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate the weighted correlation between the X and Y dimensions of the matrix.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    weights : np.ndarray</span>
<span class=sd>        A matrix of weights.</span>
<span class=sd>    x : Optional[np.ndarray], optional</span>
<span class=sd>        X-values for each column and row, by default None.</span>
<span class=sd>    y : Optional[np.ndarray], optional</span>
<span class=sd>        Y-values for each column and row, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        The weighted correlation coefficient.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>weights</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>weights</span><span class=p>)]</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>x</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>ndim</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=p>(</span><span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>1</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>x</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>meshgrid</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>y</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>ndim</span><span class=p>(</span><span class=n>y</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=p>(</span><span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>1</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>_</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>meshgrid</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span>

    <span class=n>x</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
    <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
    <span class=n>w</span> <span class=o>=</span> <span class=n>weights</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>

    <span class=n>mX</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=n>x</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>
    <span class=n>mY</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=n>y</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>

    <span class=n>covXY</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>mX</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>y</span> <span class=o>-</span> <span class=n>mY</span><span class=p>))</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>
    <span class=n>covXX</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>mX</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>
    <span class=n>covYY</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=p>(</span><span class=n>y</span> <span class=o>-</span> <span class=n>mY</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>

    <span class=n>c</span> <span class=o>=</span> <span class=n>covXY</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>covXX</span> <span class=o>*</span> <span class=n>covYY</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>c</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.WeightedCorrCirc class="doc doc-heading"> <code class="highlight language-python"><span class=n>WeightedCorrCirc</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the correlation between x and y dimensions of a matrix with angular (circular) values.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>weights</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A 2D numpy array of weights.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>x</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A 2D numpy array of x-values, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>alpha</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A 2D numpy array of angular (circular) y-values, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The correlation between x and y dimensions.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>WeightedCorrCirc</span><span class=p>(</span>
    <span class=n>weights</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>x</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>alpha</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute the correlation between x and y dimensions of a matrix with angular (circular) values.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    weights : np.ndarray</span>
<span class=sd>        A 2D numpy array of weights.</span>
<span class=sd>    x : Optional[np.ndarray], optional</span>
<span class=sd>        A 2D numpy array of x-values, by default None.</span>
<span class=sd>    alpha : Optional[np.ndarray], optional</span>
<span class=sd>        A 2D numpy array of angular (circular) y-values, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        The correlation between x and y dimensions.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>weights</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>weights</span><span class=p>)]</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>x</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>ndim</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=p>(</span><span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>1</span><span class=p>))</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>x</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>meshgrid</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=k>if</span> <span class=n>alpha</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>alpha</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>pi</span><span class=p>,</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>endpoint</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
            <span class=p>(</span><span class=n>weights</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>1</span><span class=p>),</span>
        <span class=p>)</span><span class=o>.</span><span class=n>T</span>

    <span class=n>rxs</span> <span class=o>=</span> <span class=n>WeightedCorr</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>alpha</span><span class=p>))</span>
    <span class=n>rxc</span> <span class=o>=</span> <span class=n>WeightedCorr</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>alpha</span><span class=p>))</span>
    <span class=n>rcs</span> <span class=o>=</span> <span class=n>WeightedCorr</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>alpha</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>alpha</span><span class=p>))</span>

    <span class=c1># Compute angular-linear correlation</span>
    <span class=n>rho</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>((</span><span class=n>rxc</span><span class=o>**</span><span class=mi>2</span> <span class=o>+</span> <span class=n>rxs</span><span class=o>**</span><span class=mi>2</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>rxc</span> <span class=o>*</span> <span class=n>rxs</span> <span class=o>*</span> <span class=n>rcs</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>rcs</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>rho</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.binshuffling class="doc doc-heading"> <code class="highlight language-python"><span class=n>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Perform bin shuffling to generate statistical threshold.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Perform bin shuffling to generate statistical threshold.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>()</span>

    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>shui</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>):</span>
        <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>zactmat</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>neuroni</span><span class=p>,</span> <span class=n>activity</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>):</span>
            <span class=n>randomorder</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nbins</span><span class=p>))</span>
            <span class=n>zactmat_</span><span class=p>[</span><span class=n>neuroni</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>activity</span><span class=p>[</span><span class=n>randomorder</span><span class=p>]</span>
        <span class=n>lambdamax_</span><span class=p>[</span><span class=n>shui</span><span class=p>]</span> <span class=o>=</span> <span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span>

    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>lambdamax_</span><span class=p>,</span> <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.bottom_up_replay_detection class="doc doc-heading"> <code class="highlight language-python"><span class=n>bottom_up_replay_detection</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=n>time_centers</span><span class=p>,</span> <span class=n>bin_centers</span><span class=p>,</span> <span class=n>speed_times</span><span class=p>,</span> <span class=n>speed_values</span><span class=p>,</span> <span class=n>window_dt</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>speed_thresh</span><span class=o>=</span><span class=mf>5.0</span><span class=p>,</span> <span class=n>spread_thresh</span><span class=o>=</span><span class=mf>10.0</span><span class=p>,</span> <span class=n>com_jump_thresh</span><span class=o>=</span><span class=mf>20.0</span><span class=p>,</span> <span class=n>merge_spatial_gap</span><span class=o>=</span><span class=mf>20.0</span><span class=p>,</span> <span class=n>merge_time_gap</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span> <span class=n>min_duration</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> <span class=n>dispersion_thresh</span><span class=o>=</span><span class=mf>12.0</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=s1>&#39;com&#39;</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Bottom-up replay detector following Widloski &amp; Foster (2022) "Replay detection and analysis".</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>posterior</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Shape (n_time, n_space_bins) posterior probability for each time window.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>time_centers</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Center time of each posterior time bin (length n_time) in seconds.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>bin_centers</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spatial bin centers (length n_space_bins) in same units as thresholds (cm).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>speed_times</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Time stamps and speed values (cm/s) for the animal; used to interpolate speed at time_centers.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>speed_values</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Time stamps and speed values (cm/s) for the animal; used to interpolate speed at time_centers.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>window_dt</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=float>float</span>]</code> </td> <td> <div class=doc-md-description> <p>Duration of each posterior time bin. If None, computed from time_centers diff.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>speed_thresh</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Speed threshold for filtering candidate replays (cm/s).</p> </div> </td> <td> <code>5.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>spread_thresh</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Spread threshold for filtering candidate replays (cm).</p> </div> </td> <td> <code>10.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>com_jump_thresh</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Center-of-mass jump threshold for filtering candidate replays (cm).</p> </div> </td> <td> <code>20.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>merge_spatial_gap</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Spatial gap threshold for merging candidate replays (cm).</p> </div> </td> <td> <code>20.0</code> </td> </tr> <tr class=doc-section-item> <td> <code>merge_time_gap</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Temporal gap threshold for merging candidate replays (s).</p> </div> </td> <td> <code>0.05</code> </td> </tr> <tr class=doc-section-item> <td> <code>min_duration</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Minimum duration for keeping candidate replays (s).</p> </div> </td> <td> <code>0.1</code> </td> </tr> <tr class=doc-section-item> <td> <code>dispersion_thresh</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Dispersion threshold (mean absolute deviation of COM across sequence) for labeling replays (cm).</p> </div> </td> <td> <code>12.0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>replays</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of replay events that passed dispersion threshold; shape (k,2) start/end times.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>meta</code></td> <td> <code><span title=dict>dict</span></code> </td> <td> <div class=doc-md-description> <p>Metadata dict with keys: - 'candidates': candidate subsequences before dispersion filter; list of dicts with keys: - 'start_time': start time of each candidate - 'end_time': end time of each candidate - 'start_idx': start index of each candidate - 'end_idx': end index of each candidate - 'duration': duration of each candidate (s) - 'D2': dispersion (RMS radial deviation) per candidate (cm) - 'com_trace': NaN-removed sequence of center-of-mass positions used for metrics - 'path_length': path length (sum of consecutive COM step distances) across valid bins (cm) - 'maxJump_NaN': maximum consecutive-step jump computed on the raw COM slice (may be NaN) - 'maxJump_NaNremoved': maximum consecutive-step jump computed on the NaN-removed COM trace (cm) - 'maxJump_NaNremoved_time': maximum temporal gap between valid (NaN-removed) samples (s) - 'posteriorSpreadMax': maximum per-bin posterior spread across the candidate (cm) - 'posteriorSpreadMean': mean per-bin posterior spread across the candidate (cm) - 'com': center-of-mass per kept bin (array of shape (n_time, ) or (n_time,2)) - 'spread': posterior spread per kept bin (array of length n_time) - 'mask': boolean mask of kept bins (array of length n_time)</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>This implementation assumes 1D and 2D spatial decoding.</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1232</span>
<span class=normal>1233</span>
<span class=normal>1234</span>
<span class=normal>1235</span>
<span class=normal>1236</span>
<span class=normal>1237</span>
<span class=normal>1238</span>
<span class=normal>1239</span>
<span class=normal>1240</span>
<span class=normal>1241</span>
<span class=normal>1242</span>
<span class=normal>1243</span>
<span class=normal>1244</span>
<span class=normal>1245</span>
<span class=normal>1246</span>
<span class=normal>1247</span>
<span class=normal>1248</span>
<span class=normal>1249</span>
<span class=normal>1250</span>
<span class=normal>1251</span>
<span class=normal>1252</span>
<span class=normal>1253</span>
<span class=normal>1254</span>
<span class=normal>1255</span>
<span class=normal>1256</span>
<span class=normal>1257</span>
<span class=normal>1258</span>
<span class=normal>1259</span>
<span class=normal>1260</span>
<span class=normal>1261</span>
<span class=normal>1262</span>
<span class=normal>1263</span>
<span class=normal>1264</span>
<span class=normal>1265</span>
<span class=normal>1266</span>
<span class=normal>1267</span>
<span class=normal>1268</span>
<span class=normal>1269</span>
<span class=normal>1270</span>
<span class=normal>1271</span>
<span class=normal>1272</span>
<span class=normal>1273</span>
<span class=normal>1274</span>
<span class=normal>1275</span>
<span class=normal>1276</span>
<span class=normal>1277</span>
<span class=normal>1278</span>
<span class=normal>1279</span>
<span class=normal>1280</span>
<span class=normal>1281</span>
<span class=normal>1282</span>
<span class=normal>1283</span>
<span class=normal>1284</span>
<span class=normal>1285</span>
<span class=normal>1286</span>
<span class=normal>1287</span>
<span class=normal>1288</span>
<span class=normal>1289</span>
<span class=normal>1290</span>
<span class=normal>1291</span>
<span class=normal>1292</span>
<span class=normal>1293</span>
<span class=normal>1294</span>
<span class=normal>1295</span>
<span class=normal>1296</span>
<span class=normal>1297</span>
<span class=normal>1298</span>
<span class=normal>1299</span>
<span class=normal>1300</span>
<span class=normal>1301</span>
<span class=normal>1302</span>
<span class=normal>1303</span>
<span class=normal>1304</span>
<span class=normal>1305</span>
<span class=normal>1306</span>
<span class=normal>1307</span>
<span class=normal>1308</span>
<span class=normal>1309</span>
<span class=normal>1310</span>
<span class=normal>1311</span>
<span class=normal>1312</span>
<span class=normal>1313</span>
<span class=normal>1314</span>
<span class=normal>1315</span>
<span class=normal>1316</span>
<span class=normal>1317</span>
<span class=normal>1318</span>
<span class=normal>1319</span>
<span class=normal>1320</span>
<span class=normal>1321</span>
<span class=normal>1322</span>
<span class=normal>1323</span>
<span class=normal>1324</span>
<span class=normal>1325</span>
<span class=normal>1326</span>
<span class=normal>1327</span>
<span class=normal>1328</span>
<span class=normal>1329</span>
<span class=normal>1330</span>
<span class=normal>1331</span>
<span class=normal>1332</span>
<span class=normal>1333</span>
<span class=normal>1334</span>
<span class=normal>1335</span>
<span class=normal>1336</span>
<span class=normal>1337</span>
<span class=normal>1338</span>
<span class=normal>1339</span>
<span class=normal>1340</span>
<span class=normal>1341</span>
<span class=normal>1342</span>
<span class=normal>1343</span>
<span class=normal>1344</span>
<span class=normal>1345</span>
<span class=normal>1346</span>
<span class=normal>1347</span>
<span class=normal>1348</span>
<span class=normal>1349</span>
<span class=normal>1350</span>
<span class=normal>1351</span>
<span class=normal>1352</span>
<span class=normal>1353</span>
<span class=normal>1354</span>
<span class=normal>1355</span>
<span class=normal>1356</span>
<span class=normal>1357</span>
<span class=normal>1358</span>
<span class=normal>1359</span>
<span class=normal>1360</span>
<span class=normal>1361</span>
<span class=normal>1362</span>
<span class=normal>1363</span>
<span class=normal>1364</span>
<span class=normal>1365</span>
<span class=normal>1366</span>
<span class=normal>1367</span>
<span class=normal>1368</span>
<span class=normal>1369</span>
<span class=normal>1370</span>
<span class=normal>1371</span>
<span class=normal>1372</span>
<span class=normal>1373</span>
<span class=normal>1374</span>
<span class=normal>1375</span>
<span class=normal>1376</span>
<span class=normal>1377</span>
<span class=normal>1378</span>
<span class=normal>1379</span>
<span class=normal>1380</span>
<span class=normal>1381</span>
<span class=normal>1382</span>
<span class=normal>1383</span>
<span class=normal>1384</span>
<span class=normal>1385</span>
<span class=normal>1386</span>
<span class=normal>1387</span>
<span class=normal>1388</span>
<span class=normal>1389</span>
<span class=normal>1390</span>
<span class=normal>1391</span>
<span class=normal>1392</span>
<span class=normal>1393</span>
<span class=normal>1394</span>
<span class=normal>1395</span>
<span class=normal>1396</span>
<span class=normal>1397</span>
<span class=normal>1398</span>
<span class=normal>1399</span>
<span class=normal>1400</span>
<span class=normal>1401</span>
<span class=normal>1402</span>
<span class=normal>1403</span>
<span class=normal>1404</span>
<span class=normal>1405</span>
<span class=normal>1406</span>
<span class=normal>1407</span>
<span class=normal>1408</span>
<span class=normal>1409</span>
<span class=normal>1410</span>
<span class=normal>1411</span>
<span class=normal>1412</span>
<span class=normal>1413</span>
<span class=normal>1414</span>
<span class=normal>1415</span>
<span class=normal>1416</span>
<span class=normal>1417</span>
<span class=normal>1418</span>
<span class=normal>1419</span>
<span class=normal>1420</span>
<span class=normal>1421</span>
<span class=normal>1422</span>
<span class=normal>1423</span>
<span class=normal>1424</span>
<span class=normal>1425</span>
<span class=normal>1426</span>
<span class=normal>1427</span>
<span class=normal>1428</span>
<span class=normal>1429</span>
<span class=normal>1430</span>
<span class=normal>1431</span>
<span class=normal>1432</span>
<span class=normal>1433</span>
<span class=normal>1434</span>
<span class=normal>1435</span>
<span class=normal>1436</span>
<span class=normal>1437</span>
<span class=normal>1438</span>
<span class=normal>1439</span>
<span class=normal>1440</span>
<span class=normal>1441</span>
<span class=normal>1442</span>
<span class=normal>1443</span>
<span class=normal>1444</span>
<span class=normal>1445</span>
<span class=normal>1446</span>
<span class=normal>1447</span>
<span class=normal>1448</span>
<span class=normal>1449</span>
<span class=normal>1450</span>
<span class=normal>1451</span>
<span class=normal>1452</span>
<span class=normal>1453</span>
<span class=normal>1454</span>
<span class=normal>1455</span>
<span class=normal>1456</span>
<span class=normal>1457</span>
<span class=normal>1458</span>
<span class=normal>1459</span>
<span class=normal>1460</span>
<span class=normal>1461</span>
<span class=normal>1462</span>
<span class=normal>1463</span>
<span class=normal>1464</span>
<span class=normal>1465</span>
<span class=normal>1466</span>
<span class=normal>1467</span>
<span class=normal>1468</span>
<span class=normal>1469</span>
<span class=normal>1470</span>
<span class=normal>1471</span>
<span class=normal>1472</span>
<span class=normal>1473</span>
<span class=normal>1474</span>
<span class=normal>1475</span>
<span class=normal>1476</span>
<span class=normal>1477</span>
<span class=normal>1478</span>
<span class=normal>1479</span>
<span class=normal>1480</span>
<span class=normal>1481</span>
<span class=normal>1482</span>
<span class=normal>1483</span>
<span class=normal>1484</span>
<span class=normal>1485</span>
<span class=normal>1486</span>
<span class=normal>1487</span>
<span class=normal>1488</span>
<span class=normal>1489</span>
<span class=normal>1490</span>
<span class=normal>1491</span>
<span class=normal>1492</span>
<span class=normal>1493</span>
<span class=normal>1494</span>
<span class=normal>1495</span>
<span class=normal>1496</span>
<span class=normal>1497</span>
<span class=normal>1498</span>
<span class=normal>1499</span>
<span class=normal>1500</span>
<span class=normal>1501</span>
<span class=normal>1502</span>
<span class=normal>1503</span>
<span class=normal>1504</span>
<span class=normal>1505</span>
<span class=normal>1506</span>
<span class=normal>1507</span>
<span class=normal>1508</span>
<span class=normal>1509</span>
<span class=normal>1510</span>
<span class=normal>1511</span>
<span class=normal>1512</span>
<span class=normal>1513</span>
<span class=normal>1514</span>
<span class=normal>1515</span>
<span class=normal>1516</span>
<span class=normal>1517</span>
<span class=normal>1518</span>
<span class=normal>1519</span>
<span class=normal>1520</span>
<span class=normal>1521</span>
<span class=normal>1522</span>
<span class=normal>1523</span>
<span class=normal>1524</span>
<span class=normal>1525</span>
<span class=normal>1526</span>
<span class=normal>1527</span>
<span class=normal>1528</span>
<span class=normal>1529</span>
<span class=normal>1530</span>
<span class=normal>1531</span>
<span class=normal>1532</span>
<span class=normal>1533</span>
<span class=normal>1534</span>
<span class=normal>1535</span>
<span class=normal>1536</span>
<span class=normal>1537</span>
<span class=normal>1538</span>
<span class=normal>1539</span>
<span class=normal>1540</span>
<span class=normal>1541</span>
<span class=normal>1542</span>
<span class=normal>1543</span>
<span class=normal>1544</span>
<span class=normal>1545</span>
<span class=normal>1546</span>
<span class=normal>1547</span>
<span class=normal>1548</span>
<span class=normal>1549</span>
<span class=normal>1550</span>
<span class=normal>1551</span>
<span class=normal>1552</span>
<span class=normal>1553</span>
<span class=normal>1554</span>
<span class=normal>1555</span>
<span class=normal>1556</span>
<span class=normal>1557</span>
<span class=normal>1558</span>
<span class=normal>1559</span>
<span class=normal>1560</span>
<span class=normal>1561</span>
<span class=normal>1562</span>
<span class=normal>1563</span>
<span class=normal>1564</span>
<span class=normal>1565</span>
<span class=normal>1566</span>
<span class=normal>1567</span>
<span class=normal>1568</span>
<span class=normal>1569</span>
<span class=normal>1570</span>
<span class=normal>1571</span>
<span class=normal>1572</span>
<span class=normal>1573</span>
<span class=normal>1574</span>
<span class=normal>1575</span>
<span class=normal>1576</span>
<span class=normal>1577</span>
<span class=normal>1578</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>bottom_up_replay_detection</span><span class=p>(</span>
    <span class=n>posterior</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>time_centers</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>bin_centers</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>speed_times</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>speed_values</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>window_dt</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>float</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>speed_thresh</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>5.0</span><span class=p>,</span>
    <span class=n>spread_thresh</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>10.0</span><span class=p>,</span>
    <span class=n>com_jump_thresh</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>20.0</span><span class=p>,</span>
    <span class=n>merge_spatial_gap</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>20.0</span><span class=p>,</span>
    <span class=n>merge_time_gap</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.05</span><span class=p>,</span>
    <span class=n>min_duration</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.1</span><span class=p>,</span>
    <span class=n>dispersion_thresh</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>12.0</span><span class=p>,</span>
    <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;com&quot;</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>dict</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Bottom-up replay detector following Widloski &amp; Foster (2022) &quot;Replay detection and analysis&quot;.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    posterior : np.ndarray</span>
<span class=sd>        Shape (n_time, n_space_bins) posterior probability for each time window.</span>
<span class=sd>    time_centers : np.ndarray</span>
<span class=sd>        Center time of each posterior time bin (length n_time) in seconds.</span>
<span class=sd>    bin_centers : np.ndarray</span>
<span class=sd>        Spatial bin centers (length n_space_bins) in same units as thresholds (cm).</span>
<span class=sd>    speed_times, speed_values : np.ndarray</span>
<span class=sd>        Time stamps and speed values (cm/s) for the animal; used to interpolate</span>
<span class=sd>        speed at time_centers.</span>
<span class=sd>    window_dt : Optional[float]</span>
<span class=sd>        Duration of each posterior time bin. If None, computed from time_centers diff.</span>
<span class=sd>    speed_thresh : float</span>
<span class=sd>        Speed threshold for filtering candidate replays (cm/s).</span>
<span class=sd>    spread_thresh : float</span>
<span class=sd>        Spread threshold for filtering candidate replays (cm).</span>
<span class=sd>    com_jump_thresh : float</span>
<span class=sd>        Center-of-mass jump threshold for filtering candidate replays (cm).</span>
<span class=sd>    merge_spatial_gap : float</span>
<span class=sd>        Spatial gap threshold for merging candidate replays (cm).</span>
<span class=sd>    merge_time_gap : float</span>
<span class=sd>        Temporal gap threshold for merging candidate replays (s).</span>
<span class=sd>    min_duration : float</span>
<span class=sd>        Minimum duration for keeping candidate replays (s).</span>
<span class=sd>    dispersion_thresh : float</span>
<span class=sd>        Dispersion threshold (mean absolute deviation of COM across sequence) for labeling replays (cm).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    replays : np.ndarray</span>
<span class=sd>        Array of replay events that passed dispersion threshold; shape (k,2) start/end times.</span>
<span class=sd>    meta : dict</span>
<span class=sd>        Metadata dict with keys:</span>
<span class=sd>         - &#39;candidates&#39;: candidate subsequences before dispersion filter; list of dicts with keys:</span>
<span class=sd>            - &#39;start_time&#39;: start time of each candidate</span>
<span class=sd>            - &#39;end_time&#39;: end time of each candidate</span>
<span class=sd>            - &#39;start_idx&#39;: start index of each candidate</span>
<span class=sd>            - &#39;end_idx&#39;: end index of each candidate</span>
<span class=sd>            - &#39;duration&#39;: duration of each candidate (s)</span>
<span class=sd>            - &#39;D2&#39;: dispersion (RMS radial deviation) per candidate (cm)</span>
<span class=sd>            - &#39;com_trace&#39;: NaN-removed sequence of center-of-mass positions used for metrics</span>
<span class=sd>            - &#39;path_length&#39;: path length (sum of consecutive COM step distances) across valid bins (cm)</span>
<span class=sd>            - &#39;maxJump_NaN&#39;: maximum consecutive-step jump computed on the raw COM slice (may be NaN)</span>
<span class=sd>            - &#39;maxJump_NaNremoved&#39;: maximum consecutive-step jump computed on the NaN-removed COM trace (cm)</span>
<span class=sd>            - &#39;maxJump_NaNremoved_time&#39;: maximum temporal gap between valid (NaN-removed) samples (s)</span>
<span class=sd>            - &#39;posteriorSpreadMax&#39;: maximum per-bin posterior spread across the candidate (cm)</span>
<span class=sd>            - &#39;posteriorSpreadMean&#39;: mean per-bin posterior spread across the candidate (cm)</span>
<span class=sd>         - &#39;com&#39;: center-of-mass per kept bin (array of shape (n_time, ) or (n_time,2))</span>
<span class=sd>         - &#39;spread&#39;: posterior spread per kept bin (array of length n_time)</span>
<span class=sd>         - &#39;mask&#39;: boolean mask of kept bins (array of length n_time)</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    This implementation assumes 1D and 2D spatial decoding.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>posterior</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>posterior</span><span class=p>)</span>
    <span class=n>time_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>time_centers</span><span class=p>)</span>

    <span class=c1># Support posteriors where time is the last axis (space..., time)</span>
    <span class=c1># Move time axis to front so internal code works with shape (n_time, ...)</span>
    <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>&gt;=</span> <span class=mi>2</span> <span class=ow>and</span> <span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=n>time_centers</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
        <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>time_centers</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
            <span class=n>posterior</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>moveaxis</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;posterior time dimension does not match time_centers&quot;</span><span class=p>)</span>
    <span class=c1># bin_centers may be a 1D array for 1D posteriors or a tuple (y_centers, x_centers)</span>
    <span class=c1># for 2D posteriors. Don&#39;t force-cast a tuple into an ndarray.</span>
    <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>bin_centers</span><span class=p>,</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>))</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>bin_centers</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span><span class=p>):</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;For 2D posterior, bin_centers must be (y_centers, x_centers)&quot;</span>
            <span class=p>)</span>
        <span class=n>y_centers</span><span class=p>,</span> <span class=n>x_centers</span> <span class=o>=</span> <span class=n>bin_centers</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>bin_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>bin_centers</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>!=</span> <span class=n>time_centers</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;posterior and time_centers must have matching first dimension&quot;</span>
        <span class=p>)</span>

    <span class=n>n_time</span> <span class=o>=</span> <span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=c1># bin duration</span>
    <span class=k>if</span> <span class=n>window_dt</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>n_time</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
            <span class=n>window_dt</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>median</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>time_centers</span><span class=p>))</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>window_dt</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=c1># compute COMs and spread; support 1D and 2D posteriors</span>
    <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
        <span class=c1># 1D posterior: shape (n_time, n_space)</span>
        <span class=n>com</span> <span class=o>=</span> <span class=n>position_estimator</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=n>bin_centers</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=n>method</span><span class=p>)</span>

        <span class=c1># compute posterior spread (weighted std)</span>
        <span class=n>spread</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>n_time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>ti</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_time</span><span class=p>):</span>
            <span class=n>P</span> <span class=o>=</span> <span class=n>posterior</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span>
            <span class=n>s</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>P</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>Pn</span> <span class=o>=</span> <span class=n>P</span> <span class=o>/</span> <span class=n>s</span>
                <span class=n>mu</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>bin_centers</span> <span class=o>*</span> <span class=n>Pn</span><span class=p>)</span>
                <span class=n>spread</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(((</span><span class=n>bin_centers</span> <span class=o>-</span> <span class=n>mu</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>Pn</span><span class=p>))</span>

        <span class=c1># compute COM jump sizes (between consecutive bins)</span>
        <span class=n>com_jump</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>n_time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
        <span class=n>com_diff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com</span><span class=p>,</span> <span class=n>prepend</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>))</span>
        <span class=n>com_jump</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>=</span> <span class=n>com_diff</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>

    <span class=k>elif</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
        <span class=c1># 2D posterior: shape (n_time, ny, nx)</span>
        <span class=n>y_centers</span><span class=p>,</span> <span class=n>x_centers</span> <span class=o>=</span> <span class=n>bin_centers</span>
        <span class=n>xx</span><span class=p>,</span> <span class=n>yy</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>meshgrid</span><span class=p>(</span><span class=n>x_centers</span><span class=p>,</span> <span class=n>y_centers</span><span class=p>,</span> <span class=n>indexing</span><span class=o>=</span><span class=s2>&quot;xy&quot;</span><span class=p>)</span>

        <span class=n>com</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>((</span><span class=n>n_time</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
        <span class=n>spread</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>n_time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>ti</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_time</span><span class=p>):</span>
            <span class=n>P</span> <span class=o>=</span> <span class=n>posterior</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span>
            <span class=n>s</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>P</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>s</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>Pn</span> <span class=o>=</span> <span class=n>P</span> <span class=o>/</span> <span class=n>s</span>
                <span class=n>mu_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>xx</span> <span class=o>*</span> <span class=n>Pn</span><span class=p>)</span>
                <span class=n>mu_y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>yy</span> <span class=o>*</span> <span class=n>Pn</span><span class=p>)</span>
                <span class=n>com</span><span class=p>[</span><span class=n>ti</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>mu_x</span>
                <span class=n>com</span><span class=p>[</span><span class=n>ti</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>mu_y</span>
                <span class=c1># RMS distance from mean</span>
                <span class=n>spread</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(((</span><span class=n>xx</span> <span class=o>-</span> <span class=n>mu_x</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span> <span class=o>+</span> <span class=p>(</span><span class=n>yy</span> <span class=o>-</span> <span class=n>mu_y</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>*</span> <span class=n>Pn</span><span class=p>))</span>

        <span class=c1># compute COM jump sizes (Euclidean distance between consecutive COMs)</span>
        <span class=n>com_jump</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>n_time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>ti</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_time</span><span class=p>):</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>com</span><span class=p>[</span><span class=n>ti</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]))</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>com</span><span class=p>[</span><span class=n>ti</span><span class=p>])):</span>
                <span class=n>com_jump</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>com</span><span class=p>[</span><span class=n>ti</span><span class=p>]</span> <span class=o>-</span> <span class=n>com</span><span class=p>[</span><span class=n>ti</span> <span class=o>-</span> <span class=mi>1</span><span class=p>])</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;posterior must be 2D (time,x) or 3D (time,y,x)&quot;</span><span class=p>)</span>

    <span class=c1># interpolate speed at time_centers</span>
    <span class=n>speed</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>interp</span><span class=p>(</span><span class=n>time_centers</span><span class=p>,</span> <span class=n>speed_times</span><span class=p>,</span> <span class=n>speed_values</span><span class=p>)</span>

    <span class=c1># treat NaN COM-jumps (e.g. first bin) as failing the com_jump criterion</span>
    <span class=c1># to avoid letting NaNs silently pass (np.nan_to_num -&gt; 0). Set NaNs to +inf</span>
    <span class=c1># so they are excluded when compared to com_jump_thresh.</span>
    <span class=n>com_jump</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>com_jump</span><span class=p>,</span> <span class=n>copy</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>com_jump</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>com_jump</span><span class=p>)]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>

    <span class=c1># mask time bins that satisfy all three criteria</span>
    <span class=n>mask</span> <span class=o>=</span> <span class=p>(</span>
        <span class=p>(</span><span class=n>speed</span> <span class=o>&lt;</span> <span class=n>speed_thresh</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>spread</span> <span class=o>&lt;</span> <span class=n>spread_thresh</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>com_jump</span> <span class=o>&lt;</span> <span class=n>com_jump_thresh</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=c1># find contiguous subsequences of True in mask</span>
    <span class=n>subseqs</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>mask</span><span class=p>):</span>
        <span class=n>edges</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>mask</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>))</span>
        <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>edges</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=n>ends</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>edges</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span>
        <span class=k>if</span> <span class=n>mask</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span>
            <span class=n>starts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(([</span><span class=mi>0</span><span class=p>],</span> <span class=n>starts</span><span class=p>))</span>
        <span class=k>if</span> <span class=n>mask</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
            <span class=n>ends</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>((</span><span class=n>ends</span><span class=p>,</span> <span class=p>[</span><span class=n>n_time</span><span class=p>]))</span>

        <span class=k>for</span> <span class=n>s</span><span class=p>,</span> <span class=n>e</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>starts</span><span class=p>,</span> <span class=n>ends</span><span class=p>):</span>
            <span class=n>subseqs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=p>{</span>
                    <span class=s2>&quot;start_idx&quot;</span><span class=p>:</span> <span class=n>s</span><span class=p>,</span>
                    <span class=s2>&quot;end_idx&quot;</span><span class=p>:</span> <span class=n>e</span><span class=p>,</span>
                    <span class=s2>&quot;start_time&quot;</span><span class=p>:</span> <span class=n>time_centers</span><span class=p>[</span><span class=n>s</span><span class=p>],</span>
                    <span class=s2>&quot;end_time&quot;</span><span class=p>:</span> <span class=n>time_centers</span><span class=p>[</span><span class=n>e</span> <span class=o>-</span> <span class=mi>1</span><span class=p>],</span>
                <span class=p>}</span>
            <span class=p>)</span>

    <span class=c1># merge neighboring subsequences based on spatial and temporal gaps</span>
    <span class=n>merged</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>seq</span> <span class=ow>in</span> <span class=n>subseqs</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>merged</span><span class=p>:</span>
            <span class=n>merged</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>seq</span><span class=p>)</span>
            <span class=k>continue</span>
        <span class=n>prev</span> <span class=o>=</span> <span class=n>merged</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>temporal_gap</span> <span class=o>=</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_time&quot;</span><span class=p>]</span> <span class=o>-</span> <span class=n>prev</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>]</span>
        <span class=c1># compute spatial gap differently for 1D vs 2D COM</span>
        <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
            <span class=n>spatial_gap</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>com</span><span class=p>[</span><span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_idx&quot;</span><span class=p>]]</span> <span class=o>-</span> <span class=n>com</span><span class=p>[</span><span class=n>prev</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>])</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># com entries are 2D vectors (mu_x, mu_y)</span>
            <span class=n>a</span> <span class=o>=</span> <span class=n>com</span><span class=p>[</span><span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_idx&quot;</span><span class=p>]]</span>
            <span class=n>b</span> <span class=o>=</span> <span class=n>com</span><span class=p>[</span><span class=n>prev</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>]</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>a</span><span class=p>))</span> <span class=ow>or</span> <span class=n>np</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>b</span><span class=p>)):</span>
                <span class=n>spatial_gap</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>spatial_gap</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=n>b</span><span class=p>))</span>

        <span class=k>if</span> <span class=n>temporal_gap</span> <span class=o>&lt;=</span> <span class=n>merge_time_gap</span> <span class=ow>and</span> <span class=n>spatial_gap</span> <span class=o>&lt;=</span> <span class=n>merge_spatial_gap</span><span class=p>:</span>
            <span class=c1># merge</span>
            <span class=n>prev</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>]</span>
            <span class=n>prev</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>]</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=n>merged</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>seq</span><span class=p>)</span>

    <span class=c1># candidate sequences: duration &gt; min_duration</span>
    <span class=n>candidates</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>seq</span> <span class=ow>in</span> <span class=n>merged</span><span class=p>:</span>
        <span class=n>duration</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>]</span> <span class=o>-</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_time&quot;</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>window_dt</span> <span class=k>if</span> <span class=n>window_dt</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mf>0.0</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>duration</span> <span class=o>&gt;=</span> <span class=n>min_duration</span><span class=p>:</span>
            <span class=c1># record COM trace for sequence and compute metrics on NaN-removed trace</span>
            <span class=n>idxs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_idx&quot;</span><span class=p>],</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>])</span>
            <span class=n>com_trace</span> <span class=o>=</span> <span class=n>com</span><span class=p>[</span><span class=n>idxs</span><span class=p>]</span>

            <span class=c1># remove NaN entries (bins with no posterior mass)</span>
            <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
                <span class=c1># 1D case: com_trace is 1D array</span>
                <span class=n>valid_mask</span> <span class=o>=</span> <span class=o>~</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>com_trace</span><span class=p>)</span>
                <span class=n>com_trace_valid</span> <span class=o>=</span> <span class=n>com_trace</span><span class=p>[</span><span class=n>valid_mask</span><span class=p>]</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=c1># 2D case: com_trace is (n_bins, 2)</span>
                <span class=n>valid_mask</span> <span class=o>=</span> <span class=o>~</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>com_trace</span><span class=p>)</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
                <span class=n>com_trace_valid</span> <span class=o>=</span> <span class=n>com_trace</span><span class=p>[</span><span class=n>valid_mask</span><span class=p>]</span>

            <span class=c1># dispersion D2 = RMS radial deviation from centroid (match MATLAB)</span>
            <span class=k>if</span> <span class=n>com_trace_valid</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>D2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=n>centroid</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>posterior</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
                    <span class=n>centroid</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>)</span>
                    <span class=n>D2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>((</span><span class=n>com_trace_valid</span> <span class=o>-</span> <span class=n>centroid</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>centroid</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
                    <span class=n>diffs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>com_trace_valid</span> <span class=o>-</span> <span class=n>centroid</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
                    <span class=n>D2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>diffs</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>

            <span class=c1># compute path length (sum of Euclidean distances between consecutive valid COM points)</span>
            <span class=k>if</span> <span class=n>com_trace_valid</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>path_length</span> <span class=o>=</span> <span class=mf>0.0</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>com_trace_valid</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                    <span class=n>steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
                <span class=n>path_length</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>steps</span><span class=p>))</span>

            <span class=c1># compute maxJump on raw (may contain NaNs) and on NaN-removed trace</span>
            <span class=c1># For raw trace: compute diffs and allow NaNs to propagate (max may be NaN)</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>com_trace</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                    <span class=n>maxJump_NaN</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=k>if</span> <span class=n>com_trace</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                        <span class=n>raw_steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace</span><span class=p>))</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=n>raw_steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
                    <span class=n>maxJump_NaN</span> <span class=o>=</span> <span class=p>(</span>
                        <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nanmax</span><span class=p>(</span><span class=n>raw_steps</span><span class=p>))</span> <span class=k>if</span> <span class=n>raw_steps</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                    <span class=p>)</span>
            <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
                <span class=n>maxJump_NaN</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>

            <span class=c1># For NaN-removed trace</span>
            <span class=k>if</span> <span class=n>com_trace_valid</span><span class=o>.</span><span class=n>size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>maxJump_NaNremoved</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=n>maxJump_NaNremoved_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>com_trace_valid</span><span class=o>.</span><span class=n>ndim</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
                    <span class=n>valid_steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>valid_steps</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span>
                        <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>com_trace_valid</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
                    <span class=p>)</span>
                <span class=n>maxJump_NaNremoved</span> <span class=o>=</span> <span class=p>(</span>
                    <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nanmax</span><span class=p>(</span><span class=n>valid_steps</span><span class=p>))</span> <span class=k>if</span> <span class=n>valid_steps</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=p>)</span>

                <span class=c1># compute times of valid samples to get max time gap</span>
                <span class=n>times_seq</span> <span class=o>=</span> <span class=n>time_centers</span><span class=p>[</span><span class=n>idxs</span><span class=p>]</span>
                <span class=n>times_valid</span> <span class=o>=</span> <span class=n>times_seq</span><span class=p>[</span><span class=n>valid_mask</span><span class=p>]</span>
                <span class=k>if</span> <span class=n>times_valid</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
                    <span class=n>maxJump_NaNremoved_time</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>times_valid</span><span class=p>)))</span>
                <span class=k>else</span><span class=p>:</span>
                    <span class=n>maxJump_NaNremoved_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>

            <span class=c1># posteriorSpreadMax and posteriorSpreadMean for the sequence (NaN-removed)</span>
            <span class=n>seq_spreads</span> <span class=o>=</span> <span class=n>spread</span><span class=p>[</span><span class=n>idxs</span><span class=p>]</span>
            <span class=n>seq_spreads_valid</span> <span class=o>=</span> <span class=n>seq_spreads</span><span class=p>[</span><span class=o>~</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>seq_spreads</span><span class=p>)]</span>
            <span class=k>if</span> <span class=n>seq_spreads_valid</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
                <span class=n>posteriorSpreadMax</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>seq_spreads_valid</span><span class=p>))</span>
                <span class=n>posteriorSpreadMean</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>seq_spreads_valid</span><span class=p>))</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>posteriorSpreadMax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=n>posteriorSpreadMean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>

            <span class=n>candidates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                <span class=p>{</span>
                    <span class=s2>&quot;start_time&quot;</span><span class=p>:</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_time&quot;</span><span class=p>],</span>
                    <span class=s2>&quot;end_time&quot;</span><span class=p>:</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>],</span>
                    <span class=s2>&quot;start_idx&quot;</span><span class=p>:</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;start_idx&quot;</span><span class=p>],</span>
                    <span class=s2>&quot;end_idx&quot;</span><span class=p>:</span> <span class=n>seq</span><span class=p>[</span><span class=s2>&quot;end_idx&quot;</span><span class=p>],</span>
                    <span class=s2>&quot;duration&quot;</span><span class=p>:</span> <span class=n>duration</span><span class=p>,</span>
                    <span class=s2>&quot;D2&quot;</span><span class=p>:</span> <span class=n>D2</span><span class=p>,</span>
                    <span class=s2>&quot;com_trace&quot;</span><span class=p>:</span> <span class=n>com_trace_valid</span><span class=p>,</span>
                    <span class=s2>&quot;path_length&quot;</span><span class=p>:</span> <span class=n>path_length</span><span class=p>,</span>
                    <span class=s2>&quot;maxJump_NaN&quot;</span><span class=p>:</span> <span class=n>maxJump_NaN</span><span class=p>,</span>
                    <span class=s2>&quot;maxJump_NaNremoved&quot;</span><span class=p>:</span> <span class=n>maxJump_NaNremoved</span><span class=p>,</span>
                    <span class=s2>&quot;maxJump_NaNremoved_time&quot;</span><span class=p>:</span> <span class=n>maxJump_NaNremoved_time</span><span class=p>,</span>
                    <span class=s2>&quot;posteriorSpreadMax&quot;</span><span class=p>:</span> <span class=n>posteriorSpreadMax</span><span class=p>,</span>
                    <span class=s2>&quot;posteriorSpreadMean&quot;</span><span class=p>:</span> <span class=n>posteriorSpreadMean</span><span class=p>,</span>
                <span class=p>}</span>
            <span class=p>)</span>

    <span class=c1># select replays by dispersion threshold</span>
    <span class=n>replays</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>candidates</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>c</span><span class=p>[</span><span class=s2>&quot;D2&quot;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=n>dispersion_thresh</span><span class=p>:</span>
            <span class=n>replays</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>c</span><span class=p>[</span><span class=s2>&quot;start_time&quot;</span><span class=p>],</span> <span class=n>c</span><span class=p>[</span><span class=s2>&quot;end_time&quot;</span><span class=p>]])</span>

    <span class=n>replays</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>replays</span><span class=p>)</span>

    <span class=n>meta</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s2>&quot;candidates&quot;</span><span class=p>:</span> <span class=n>candidates</span><span class=p>,</span>
        <span class=s2>&quot;com&quot;</span><span class=p>:</span> <span class=n>com</span><span class=p>,</span>
        <span class=s2>&quot;spread&quot;</span><span class=p>:</span> <span class=n>spread</span><span class=p>,</span>
        <span class=s2>&quot;mask&quot;</span><span class=p>:</span> <span class=n>mask</span><span class=p>,</span>
        <span class=s2>&quot;window_dt&quot;</span><span class=p>:</span> <span class=n>window_dt</span><span class=p>,</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=n>replays</span><span class=p>,</span> <span class=n>meta</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.circshuffling class="doc doc-heading"> <code class="highlight language-python"><span class=n>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Perform circular shuffling to generate statistical threshold.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Perform circular shuffling to generate statistical threshold.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>()</span>

    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>shui</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>):</span>
        <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>zactmat</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>neuroni</span><span class=p>,</span> <span class=n>activity</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>):</span>
            <span class=n>cut</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nbins</span> <span class=o>*</span> <span class=mi>2</span><span class=p>))</span>
            <span class=n>zactmat_</span><span class=p>[</span><span class=n>neuroni</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>roll</span><span class=p>(</span><span class=n>activity</span><span class=p>,</span> <span class=n>cut</span><span class=p>)</span>
        <span class=n>lambdamax_</span><span class=p>[</span><span class=n>shui</span><span class=p>]</span> <span class=o>=</span> <span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span>

    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>lambdamax_</span><span class=p>,</span> <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.computeAssemblyActivity class="doc doc-heading"> <code class="highlight language-python"><span class=n>computeAssemblyActivity</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=n>zactmat</span><span class=p>,</span> <span class=n>zerodiag</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute assembly activity.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>patterns</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Co-activation patterns (assemblies, neurons).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix (neurons, time bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>zerodiag</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, diagonal of projection matrix is set to zero, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Assembly activity matrix (assemblies, time bins).</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>computeAssemblyActivity</span><span class=p>(</span>
    <span class=n>patterns</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>zerodiag</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute assembly activity.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    patterns : np.ndarray</span>
<span class=sd>        Co-activation patterns (assemblies, neurons).</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix (neurons, time bins).</span>
<span class=sd>    zerodiag : bool, optional</span>
<span class=sd>        If True, diagonal of projection matrix is set to zero, by default True.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Optional[np.ndarray]</span>
<span class=sd>        Assembly activity matrix (assemblies, time bins).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># check if patterns is empty (no assembly detected) and return None if so</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>patterns</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>None</span>

    <span class=c1># number of assemblies and time bins</span>
    <span class=n>nassemblies</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>patterns</span><span class=p>)</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=c1># transpose for later matrix multiplication</span>
    <span class=n>zactmat</span> <span class=o>=</span> <span class=n>zactmat</span><span class=o>.</span><span class=n>T</span>

    <span class=c1># preallocate assembly activity matrix (nassemblies, nbins)</span>
    <span class=n>assemblyAct</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>nbins</span><span class=p>))</span>

    <span class=c1># loop over assemblies</span>
    <span class=k>for</span> <span class=n>assemblyi</span><span class=p>,</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>patterns</span><span class=p>):</span>
        <span class=c1># compute projection matrix (neurons, neurons)</span>
        <span class=n>projMat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>pattern</span><span class=p>)</span>

        <span class=c1># set the diagonal to zero to not count coactivation of i and j when i=j</span>
        <span class=k>if</span> <span class=n>zerodiag</span><span class=p>:</span>
            <span class=n>np</span><span class=o>.</span><span class=n>fill_diagonal</span><span class=p>(</span><span class=n>projMat</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

        <span class=c1># project assembly pattern onto z-scored activity matrix</span>
        <span class=n>assemblyAct</span><span class=p>[</span><span class=n>assemblyi</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>zactmat</span> <span class=o>@</span> <span class=n>projMat</span> <span class=o>*</span> <span class=n>zactmat</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>assemblyAct</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.cosine_similarity class="doc doc-heading"> <code class="highlight language-python"><span class=n>cosine_similarity</span><span class=p>(</span><span class=n>pv1</span><span class=p>,</span> <span class=n>pv2</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Cosine similarity between temporal difference vectors of two firing rate vector trajectories.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>pv1</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Temporal difference of firing rate vector trajectory in one context. Shape: (num_bins, num_neurons)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>pv2</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Temporal difference of firing rate vector trajectory in another context. Shape: (num_bins, num_neurons)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Cosine similarity between the two contexts.</p> </div> </td> </tr> </tbody> </table> <details class=references open> <summary>References</summary> <p>.. [1] Guidera, J. A., Gramling, D. P., Comrie, A. E., Joshi, A., Denovellis, E. L., Lee, K. H., Zhou, J., Thompson, P., Hernandez, J., Yorita, A., Haque, R., Kirst, C., &amp; Frank, L. M. (2024). Regional specialization manifests in the reliability of neural population codes. bioRxiv : the preprint server for biology, 2024.01.25.576941. https://doi.org/10.1101/2024.01.25.576941</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/dynamics.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>cosine_similarity</span><span class=p>(</span><span class=n>pv1</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>pv2</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Cosine similarity between temporal difference vectors of two firing rate</span>
<span class=sd>    vector trajectories.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    pv1 : numpy.ndarray</span>
<span class=sd>        Temporal difference of firing rate vector trajectory in one context.</span>
<span class=sd>        Shape: (num_bins, num_neurons)</span>

<span class=sd>    pv2 : numpy.ndarray</span>
<span class=sd>        Temporal difference of firing rate vector trajectory in another context.</span>
<span class=sd>        Shape: (num_bins, num_neurons)</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    numpy.ndarray</span>
<span class=sd>        Cosine similarity between the two contexts.</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [1] Guidera, J. A., Gramling, D. P., Comrie, A. E., Joshi, A.,</span>
<span class=sd>    Denovellis, E. L., Lee, K. H., Zhou, J., Thompson, P., Hernandez, J.,</span>
<span class=sd>    Yorita, A., Haque, R., Kirst, C., &amp; Frank, L. M. (2024). Regional</span>
<span class=sd>    specialization manifests in the reliability of neural population codes.</span>
<span class=sd>    bioRxiv : the preprint server for biology, 2024.01.25.576941.</span>
<span class=sd>    https://doi.org/10.1101/2024.01.25.576941</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>cosine_mat</span> <span class=o>=</span> <span class=n>sklearn</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>pairwise</span><span class=o>.</span><span class=n>cosine_similarity</span><span class=p>(</span><span class=n>pv1</span><span class=p>,</span> <span class=n>pv2</span><span class=p>)</span>
    <span class=n>cosine_sim</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diag</span><span class=p>(</span><span class=n>cosine_mat</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>cosine_sim</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.cosine_similarity_matrices class="doc doc-heading"> <code class="highlight language-python"><span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the cosine similarity between two flattened matrices</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>matrix1</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A normalized bias matrix</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>matrix2</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Another normalized bias matrix</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>The cosine similarity between the two matrices.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/pairwise_bias_correlation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>cosine_similarity_matrices</span><span class=p>(</span><span class=n>matrix1</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>matrix2</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute the cosine similarity between two flattened matrices</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    matrix1 : numpy.ndarray</span>
<span class=sd>        A normalized bias matrix</span>
<span class=sd>    matrix2 : numpy.ndarray</span>
<span class=sd>        Another normalized bias matrix</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        The cosine similarity between the two matrices.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Flatten matrices</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>matrix1</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>y</span> <span class=o>=</span> <span class=n>matrix2</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=ow>or</span> <span class=n>np</span><span class=o>.</span><span class=n>all</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>y</span><span class=p>)):</span>
        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>

    <span class=c1># handle nan values</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan_to_num</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
    <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan_to_num</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>

    <span class=n>cossim</span> <span class=o>=</span> <span class=n>sklearn</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>pairwise</span><span class=o>.</span><span class=n>cosine_similarity</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>

    <span class=c1># Compute cosine similarity</span>
    <span class=k>return</span> <span class=n>cossim</span><span class=o>.</span><span class=n>item</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.extractPatterns class="doc doc-heading"> <code class="highlight language-python"><span class=n>extractPatterns</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=s1>&#39;unit-variance&#39;</span><span class=p>,</span> <span class=n>cross_structural</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Extract co-activation patterns (assemblies).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>actmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Method to extract assembly patterns (ica, pca).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>whiten</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Whitening method, by default "unit-variance".</p> </div> </td> <td> <code>&#39;unit-variance&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Categorical vector indicating group membership for each neuron. If provided and method is 'ica', will run ICA on data with modified cross-structural correlation structure, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Co-activation patterns (assemblies).</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>extractPatterns</span><span class=p>(</span>
    <span class=n>actmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>,</span>
    <span class=n>method</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>whiten</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unit-variance&quot;</span><span class=p>,</span>
    <span class=n>cross_structural</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Extract co-activation patterns (assemblies).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    actmat : np.ndarray</span>
<span class=sd>        Activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>
<span class=sd>    method : str</span>
<span class=sd>        Method to extract assembly patterns (ica, pca).</span>
<span class=sd>    whiten : str, optional</span>
<span class=sd>        Whitening method, by default &quot;unit-variance&quot;.</span>
<span class=sd>    cross_structural : Optional[np.ndarray], optional</span>
<span class=sd>        Categorical vector indicating group membership for each neuron.</span>
<span class=sd>        If provided and method is &#39;ica&#39;, will run ICA on data with modified</span>
<span class=sd>        cross-structural correlation structure, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Co-activation patterns (assemblies).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>nassemblies</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span>

    <span class=k>if</span> <span class=n>method</span> <span class=o>==</span> <span class=s2>&quot;pca&quot;</span><span class=p>:</span>
        <span class=n>idxs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=o>-</span><span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span><span class=p>)[</span><span class=mi>0</span><span class=p>:</span><span class=n>nassemblies</span><span class=p>]</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>components_</span><span class=p>[</span><span class=n>idxs</span><span class=p>,</span> <span class=p>:]</span>
    <span class=k>elif</span> <span class=n>method</span> <span class=o>==</span> <span class=s2>&quot;ica&quot;</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># For cross-structural ICA, modify the input data to reflect the cross-structural correlation structure</span>
            <span class=n>correlations</span> <span class=o>=</span> <span class=n>_compute_cross_structural_correlation</span><span class=p>(</span>
                <span class=n>actmat</span><span class=p>,</span> <span class=n>cross_structural</span>
            <span class=p>)</span>

            <span class=c1># Eigenvalue decomposition to get the cross-structural subspace</span>
            <span class=n>eigenvalues</span><span class=p>,</span> <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>eigh</span><span class=p>(</span><span class=n>correlations</span><span class=p>)</span>
            <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>eigenvalues</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
            <span class=n>eigenvalues</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
            <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=n>idx</span><span class=p>]</span>

            <span class=c1># Use the top nassemblies components (already determined)</span>
            <span class=n>eigenvectors_sig</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=p>:</span><span class=n>nassemblies</span><span class=p>]</span>
            <span class=n>eigenvalues_sig</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[:</span><span class=n>nassemblies</span><span class=p>]</span>

            <span class=c1># Project the data onto the cross-structural subspace</span>
            <span class=n>projected_data</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>eigenvectors_sig</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=n>eigenvalues_sig</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
            <span class=p>)</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>actmat</span>

            <span class=c1># Run ICA on the projected data</span>
            <span class=n>ica</span> <span class=o>=</span> <span class=n>FastICA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>)</span>
            <span class=n>ica</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>projected_data</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
            <span class=c1># Transform ICA components back to original space</span>
            <span class=n>patterns</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>ica</span><span class=o>.</span><span class=n>components_</span>
                <span class=o>@</span> <span class=p>(</span><span class=n>eigenvectors_sig</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=n>eigenvalues_sig</span><span class=p>,</span> <span class=mi>0</span><span class=p>)))</span><span class=o>.</span><span class=n>T</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Standard ICA</span>
            <span class=n>ica</span> <span class=o>=</span> <span class=n>FastICA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>)</span>
            <span class=n>ica</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>actmat</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
            <span class=n>patterns</span> <span class=o>=</span> <span class=n>ica</span><span class=o>.</span><span class=n>components_</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;assembly extraction method &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>method</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; not understood&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>patterns</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>:</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>patterns</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>nassemblies</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>

        <span class=c1># sets norm of assembly vectors to 1</span>
        <span class=n>norms</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>patterns</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>norms</span><span class=p>,</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>T</span>

    <span class=k>return</span> <span class=n>patterns</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.getlambdacontrol class="doc doc-heading"> <code class="highlight language-python"><span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get the maximum eigenvalue from PCA.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat_</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Maximum eigenvalue.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get the maximum eigenvalue from PCA.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat_ : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Maximum eigenvalue.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>significance_</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>()</span>
    <span class=n>significance_</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>zactmat_</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>significance_</span><span class=o>.</span><span class=n>explained_variance_</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdamax_</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.marcenkopastur class="doc doc-heading"> <code class="highlight language-python"><span class=n>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate statistical threshold from Marcenko-Pastur distribution.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate statistical threshold from Marcenko-Pastur distribution.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nbins</span>
    <span class=n>nneurons</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nneurons</span>
    <span class=n>tracywidom</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>tracywidom</span>

    <span class=c1># calculates statistical threshold from Marcenko-Pastur distribution</span>
    <span class=n>q</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>nbins</span><span class=p>)</span> <span class=o>/</span> <span class=nb>float</span><span class=p>(</span><span class=n>nneurons</span><span class=p>)</span>  <span class=c1># note that silent neurons are counted too</span>
    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>((</span><span class=mi>1</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>q</span><span class=p>)),</span> <span class=mi>2</span><span class=p>)</span>
    <span class=n>lambdaMax</span> <span class=o>+=</span> <span class=n>tracywidom</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>nneurons</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.0</span> <span class=o>/</span> <span class=mi>3</span><span class=p>)</span>  <span class=c1># Tracy-Widom correction</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.observed_and_shuffled_correlation class="doc doc-heading"> <code class="highlight language-python"><span class=n>observed_and_shuffled_correlation</span><span class=p>(</span><span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>task_normalized</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>,</span> <span class=n>interval_i</span><span class=p>,</span> <span class=n>num_shuffles</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate observed and shuffled correlations between task and post-task neural activity.</p> <p>This function computes the correlation between normalized task bias matrix and post-task bias matrix, as well as correlations with shuffled post-task data.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>post_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of post-task spike times.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of neuron IDs corresponding to post_spikes.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>total_neurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Total number of neurons in the dataset.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_normalized</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Normalized bias matrix from task period.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Array of post-task intervals, shape (n_intervals, 2).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>interval_i</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Index of the current interval to analyze.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>num_shuffles</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of times to shuffle post-task data for null distribution, by default 100.</p> </div> </td> <td> <code>100</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=float>float</span>, <span title=typing.List>List</span>[<span title=float>float</span>]]</code> </td> <td> <div class=doc-md-description> <p>A tuple containing: - observed_correlation: float Cosine similarity between task and post-task bias matrices. - shuffled_correlation: List[float] List of cosine similarities between task and shuffled post-task bias matrices.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/pairwise_bias_correlation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>observed_and_shuffled_correlation</span><span class=p>(</span>
    <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>total_neurons</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>task_normalized</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>interval_i</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>num_shuffles</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate observed and shuffled correlations between task and post-task neural activity.</span>

<span class=sd>    This function computes the correlation between normalized task bias matrix and</span>
<span class=sd>    post-task bias matrix, as well as correlations with shuffled post-task data.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    post_spikes : np.ndarray</span>
<span class=sd>        Array of post-task spike times.</span>
<span class=sd>    post_neurons : np.ndarray</span>
<span class=sd>        Array of neuron IDs corresponding to post_spikes.</span>
<span class=sd>    total_neurons : int</span>
<span class=sd>        Total number of neurons in the dataset.</span>
<span class=sd>    task_normalized : np.ndarray</span>
<span class=sd>        Normalized bias matrix from task period.</span>
<span class=sd>    post_intervals : np.ndarray</span>
<span class=sd>        Array of post-task intervals, shape (n_intervals, 2).</span>
<span class=sd>    interval_i : int</span>
<span class=sd>        Index of the current interval to analyze.</span>
<span class=sd>    num_shuffles : int, optional</span>
<span class=sd>        Number of times to shuffle post-task data for null distribution, by default 100.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[float, List[float]]</span>
<span class=sd>        A tuple containing:</span>
<span class=sd>        - observed_correlation: float</span>
<span class=sd>            Cosine similarity between task and post-task bias matrices.</span>
<span class=sd>        - shuffled_correlation: List[float]</span>
<span class=sd>            List of cosine similarities between task and shuffled post-task bias matrices.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># for i_interval in range(post_intervals.shape[0]):</span>
    <span class=n>idx</span> <span class=o>=</span> <span class=p>(</span><span class=n>post_spikes</span> <span class=o>&gt;</span> <span class=n>post_intervals</span><span class=p>[</span><span class=n>interval_i</span><span class=p>][</span><span class=mi>0</span><span class=p>])</span> <span class=o>&amp;</span> <span class=p>(</span>
        <span class=n>post_spikes</span> <span class=o>&lt;</span> <span class=n>post_intervals</span><span class=p>[</span><span class=n>interval_i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span>
    <span class=p>)</span>

    <span class=n>post_bias_matrix</span> <span class=o>=</span> <span class=n>skew_bias_matrix</span><span class=p>(</span>
        <span class=n>post_spikes</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>post_neurons</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>total_neurons</span>
    <span class=p>)</span>

    <span class=c1># Compute cosine similarity between task and post-task bias matrices</span>
    <span class=n>observed_correlation</span> <span class=o>=</span> <span class=n>cosine_similarity_matrices</span><span class=p>(</span><span class=n>task_normalized</span><span class=p>,</span> <span class=n>post_bias_matrix</span><span class=p>)</span>

    <span class=c1># Shuffle post-task spikes and compute bias matrix</span>
    <span class=n>shuffled_correlation</span> <span class=o>=</span> <span class=p>[</span>
        <span class=n>cosine_similarity_matrices</span><span class=p>(</span>
            <span class=n>task_normalized</span><span class=p>,</span>
            <span class=n>skew_bias_matrix</span><span class=p>(</span>
                <span class=n>post_spikes</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span>
                <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>post_neurons</span><span class=p>[</span><span class=n>idx</span><span class=p>]),</span>
                <span class=n>total_neurons</span><span class=p>,</span>
            <span class=p>),</span>
        <span class=p>)</span>
        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_shuffles</span><span class=p>)</span>
    <span class=p>]</span>

    <span class=k>return</span> <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlation</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.position_estimator class="doc doc-heading"> <code class="highlight language-python"><span class=n>position_estimator</span><span class=p>(</span><span class=n>posterior_prob</span><span class=p>,</span> <span class=o>*</span><span class=n>bin_centers</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=s1>&#39;com&#39;</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Decode 1D or 2D position from posterior probability distributions.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>posterior_prob</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Posterior probability distributions over spatial bins for each time bin. For 1D: shape (n_time_bins, n_bins) For 2D: shape (n_time_bins, n_y_bins, n_x_bins) Each time slice should contain non-negative values.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>*bin_centers</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Coordinate values for the center of each spatial bin. For 1D: single array of shape (n_bins,) For 2D: two arrays - y_bin_centers of shape (n_y_bins,) and x_bin_centers of shape (n_x_bins,)</p> </div> </td> <td> <code>()</code> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Decoding method to use. Options are: - "com" : Center of mass (weighted average) (default) - "max" : Maximum a posteriori (position of maximum probability)</p> </div> </td> <td> <code>&#39;com&#39;</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>position</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Decoded positions for each time bin. For 1D: shape (n_time_bins,) containing position coordinates For 2D: shape (n_time_bins, 2) where position[:, 0] contains x-coordinates and position[:, 1] contains y-coordinates Time bins with zero probability sum are filled with NaN.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Raises:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=ValueError>ValueError</span></code> </td> <td> <div class=doc-md-description> <p>If method is not "com" or "max", or if dimensions don't match expectations.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>For the center of mass method, probabilities are normalized before computing the weighted average. For time bins where all probabilities are zero, the decoded position is set to NaN.</p> <p>The function automatically detects whether to perform 1D or 2D decoding based on the shape of the posterior_prob array and number of bin_centers provided.</p> </details> <p><span class=doc-section-title>Examples:</span></p> <p>1D example:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>posterior_1d</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>  <span class=c1># 10 time bins, 20 spatial bins</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>bin_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>positions</span> <span class=o>=</span> <span class=n>decode_position</span><span class=p>(</span><span class=n>posterior_1d</span><span class=p>,</span> <span class=n>bin_centers</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>positions</span><span class=o>.</span><span class=n>shape</span>
<span class=go>(10,)</span>
</code></pre></div> <p>2D example:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>posterior_2d</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>  <span class=c1># 10 time bins, 5x4 spatial grid</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>y_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>x_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>positions</span> <span class=o>=</span> <span class=n>decode_position</span><span class=p>(</span><span class=n>posterior_2d</span><span class=p>,</span> <span class=n>y_centers</span><span class=p>,</span> <span class=n>x_centers</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>positions</span><span class=o>.</span><span class=n>shape</span>
<span class=go>(10, 2)</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>position_estimator</span><span class=p>(</span>
    <span class=n>posterior_prob</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=o>*</span><span class=n>bin_centers</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;com&quot;</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Decode 1D or 2D position from posterior probability distributions.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    posterior_prob : np.ndarray</span>
<span class=sd>        Posterior probability distributions over spatial bins for each time bin.</span>
<span class=sd>        For 1D: shape (n_time_bins, n_bins)</span>
<span class=sd>        For 2D: shape (n_time_bins, n_y_bins, n_x_bins)</span>
<span class=sd>        Each time slice should contain non-negative values.</span>
<span class=sd>    *bin_centers : np.ndarray</span>
<span class=sd>        Coordinate values for the center of each spatial bin.</span>
<span class=sd>        For 1D: single array of shape (n_bins,)</span>
<span class=sd>        For 2D: two arrays - y_bin_centers of shape (n_y_bins,) and</span>
<span class=sd>                x_bin_centers of shape (n_x_bins,)</span>
<span class=sd>    method : str, optional</span>
<span class=sd>        Decoding method to use. Options are:</span>
<span class=sd>        - &quot;com&quot; : Center of mass (weighted average) (default)</span>
<span class=sd>        - &quot;max&quot; : Maximum a posteriori (position of maximum probability)</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    position : np.ndarray</span>
<span class=sd>        Decoded positions for each time bin.</span>
<span class=sd>        For 1D: shape (n_time_bins,) containing position coordinates</span>
<span class=sd>        For 2D: shape (n_time_bins, 2) where position[:, 0] contains</span>
<span class=sd>                x-coordinates and position[:, 1] contains y-coordinates</span>
<span class=sd>        Time bins with zero probability sum are filled with NaN.</span>

<span class=sd>    Raises</span>
<span class=sd>    ------</span>
<span class=sd>    ValueError</span>
<span class=sd>        If method is not &quot;com&quot; or &quot;max&quot;, or if dimensions don&#39;t match expectations.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    For the center of mass method, probabilities are normalized before computing</span>
<span class=sd>    the weighted average. For time bins where all probabilities are zero,</span>
<span class=sd>    the decoded position is set to NaN.</span>

<span class=sd>    The function automatically detects whether to perform 1D or 2D decoding</span>
<span class=sd>    based on the shape of the posterior_prob array and number of bin_centers provided.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    1D example:</span>
<span class=sd>    &gt;&gt;&gt; posterior_1d = np.random.rand(10, 20)  # 10 time bins, 20 spatial bins</span>
<span class=sd>    &gt;&gt;&gt; bin_centers = np.linspace(0, 19, 20)</span>
<span class=sd>    &gt;&gt;&gt; positions = decode_position(posterior_1d, bin_centers)</span>
<span class=sd>    &gt;&gt;&gt; positions.shape</span>
<span class=sd>    (10,)</span>

<span class=sd>    2D example:</span>
<span class=sd>    &gt;&gt;&gt; posterior_2d = np.random.rand(10, 5, 4)  # 10 time bins, 5x4 spatial grid</span>
<span class=sd>    &gt;&gt;&gt; y_centers = np.linspace(0, 4, 5)</span>
<span class=sd>    &gt;&gt;&gt; x_centers = np.linspace(0, 3, 4)</span>
<span class=sd>    &gt;&gt;&gt; positions = decode_position(posterior_2d, y_centers, x_centers)</span>
<span class=sd>    &gt;&gt;&gt; positions.shape</span>
<span class=sd>    (10, 2)</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>method</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&quot;com&quot;</span><span class=p>,</span> <span class=s2>&quot;max&quot;</span><span class=p>]:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Method &#39;</span><span class=si>{</span><span class=n>method</span><span class=si>}</span><span class=s2>&#39; not recognized. Use &#39;com&#39; or &#39;max&#39;.&quot;</span><span class=p>)</span>

    <span class=n>n_dims</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>posterior_prob</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>  <span class=c1># Subtract time dimension</span>
    <span class=n>n_time_bins</span> <span class=o>=</span> <span class=n>posterior_prob</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>n_dims</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>_position_estimator_1d</span><span class=p>(</span>
            <span class=n>posterior_prob</span><span class=p>,</span> <span class=n>bin_centers</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>method</span><span class=p>,</span> <span class=n>n_time_bins</span>
        <span class=p>)</span>
    <span class=k>elif</span> <span class=n>n_dims</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bin_centers</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=s2>&quot;For 2D decoding, provide exactly 2 bin_centers arrays (y_centers, x_centers)&quot;</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=n>_position_estimator_2d</span><span class=p>(</span>
            <span class=n>posterior_prob</span><span class=p>,</span> <span class=n>bin_centers</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>bin_centers</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>method</span><span class=p>,</span> <span class=n>n_time_bins</span>
        <span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Only 1D and 2D decoding supported, got </span><span class=si>{</span><span class=n>n_dims</span><span class=si>}</span><span class=s2>D&quot;</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.potential_landscape class="doc doc-heading"> <code class="highlight language-python"><span class=n>potential_landscape</span><span class=p>(</span><span class=n>X_dyn</span><span class=p>,</span> <span class=n>projbins</span><span class=p>,</span> <span class=n>domainbins</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute numerical approximation of potential energy landscape across 1D state and domain (e.g. time, position, etc.).</p> <p>Potential landscape is defined as the integral of the flow vectors.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>X_dyn</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>State vectors of shape (trials, bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>projbins</code> </td> <td> <code><span title=int>int</span> or <span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>Number of bins for projection axis or bin edges</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>domainbins</code> </td> <td> <code><span title=int>int</span> or <span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>Number of bins for domain axis or bin edges, by default None</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Potential energy landscape across state and domain</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Temporal gradient of potential energy landscape across state and domain</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Histogram of state vectors across state and domain</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Bin edges of state vectors</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Bin edges of domain</p> </div> </td> </tr> </tbody> </table> <details class=references open> <summary>References</summary> <p>.. [1] Wang, S., Falcone, R., Richmond, B. et al. Attractor dynamics reflect decision confidence in macaque prefrontal cortex. Nat Neurosci 26, 1970â1980 (2023).</p> </details> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>X_dyn</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>],</span> <span class=p>[</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>projbins</span> <span class=o>=</span> <span class=mi>3</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>domainbins</span> <span class=o>=</span> <span class=mi>3</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>potential_landscape</span><span class=p>(</span><span class=n>X_dyn</span><span class=p>,</span> <span class=n>projbins</span><span class=p>,</span> <span class=n>domainbins</span><span class=p>)</span>
<span class=go>(array([[ 0.  ,  0.  ,   nan],</span>
<span class=go>        [-0.1 ,  0.  ,   nan],</span>
<span class=go>        [  nan,  0.  , -0.25]]),</span>
<span class=go>array([[0.3 ,  nan,  nan],</span>
<span class=go>       [0.1 ,  nan,  nan],</span>
<span class=go>       [ nan,  nan, 0.25]]),</span>
<span class=go>array([[1., 0., 0.],</span>
<span class=go>       [1., 0., 0.],</span>
<span class=go>       [0., 0., 2.]]),</span>
<span class=go>array([0. , 0.1, 0.2, 0.3]),</span>
<span class=go>array([0.        , 0.33333333, 0.66666667, 1.        ]))</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/dynamics.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>potential_landscape</span><span class=p>(</span>
    <span class=n>X_dyn</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>projbins</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span>
    <span class=n>domainbins</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute numerical approximation of potential energy landscape across</span>
<span class=sd>    1D state and domain (e.g. time, position, etc.).</span>

<span class=sd>    Potential landscape is defined as the integral of the flow vectors.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    X_dyn : np.ndarray</span>
<span class=sd>        State vectors of shape (trials, bins).</span>
<span class=sd>    projbins : int or array-like</span>
<span class=sd>        Number of bins for projection axis or bin edges</span>
<span class=sd>    domainbins : int or array-like, optional</span>
<span class=sd>        Number of bins for domain axis or bin edges, by default None</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Potential energy landscape across state and domain</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Temporal gradient of potential energy landscape across state and domain</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Histogram of state vectors across state and domain</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Bin edges of state vectors</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Bin edges of domain</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [1] Wang, S., Falcone, R., Richmond, B. et al. Attractor dynamics reflect</span>
<span class=sd>           decision confidence in macaque prefrontal cortex. Nat Neurosci 26,</span>
<span class=sd>           1970â1980 (2023).</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; X_dyn = np.array([[0.1, 0.2, 0.4], [0.0, 0.3, 0.6]])</span>
<span class=sd>    &gt;&gt;&gt; projbins = 3</span>
<span class=sd>    &gt;&gt;&gt; domainbins = 3</span>
<span class=sd>    &gt;&gt;&gt; potential_landscape(X_dyn, projbins, domainbins)</span>
<span class=sd>    (array([[ 0.  ,  0.  ,   nan],</span>
<span class=sd>            [-0.1 ,  0.  ,   nan],</span>
<span class=sd>            [  nan,  0.  , -0.25]]),</span>
<span class=sd>    array([[0.3 ,  nan,  nan],</span>
<span class=sd>           [0.1 ,  nan,  nan],</span>
<span class=sd>           [ nan,  nan, 0.25]]),</span>
<span class=sd>    array([[1., 0., 0.],</span>
<span class=sd>           [1., 0., 0.],</span>
<span class=sd>           [0., 0., 2.]]),</span>
<span class=sd>    array([0. , 0.1, 0.2, 0.3]),</span>
<span class=sd>    array([0.        , 0.33333333, 0.66666667, 1.        ]))</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># _t suffix is following notation of paper but applicable across any domain</span>
    <span class=n>nnrns</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=n>ntrials</span><span class=p>,</span> <span class=n>nbins</span> <span class=o>=</span> <span class=n>X_dyn</span><span class=o>.</span><span class=n>shape</span>
    <span class=n>delta_t</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>X_dyn</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># time derivatives: ntrials x nbins-1 x nnrns</span>

    <span class=n>X_t_flat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span>
        <span class=n>X_dyn</span><span class=p>[:,</span> <span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>nnrns</span><span class=p>),</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;F&quot;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>  <span class=c1># skip last bin as no displacement exists for last time point</span>
    <span class=n>delta_t_flat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span>
        <span class=n>delta_t</span><span class=p>,</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>nnrns</span><span class=p>),</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;F&quot;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>  <span class=c1># column-major order</span>
    <span class=n>norm_tpts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>nbins</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=n>ntrials</span><span class=p>)</span>

    <span class=n>nbins_domain</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>nbins</span> <span class=o>-</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>domainbins</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>domainbins</span>
    <span class=p>)</span>  <span class=c1># downsample domain bins</span>

    <span class=c1># 1D state space binning of time derivatives across domain</span>
    <span class=c1># assumes landscape may morph across domain</span>
    <span class=n>H</span><span class=p>,</span> <span class=n>bin_edges</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>binned_statistic_dd</span><span class=p>(</span>  <span class=c1># posbins x time</span>
        <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>((</span><span class=n>X_t_flat</span><span class=p>,</span> <span class=n>norm_tpts</span><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
        <span class=n>delta_t_flat</span><span class=p>,</span>
        <span class=n>statistic</span><span class=o>=</span><span class=s2>&quot;count&quot;</span><span class=p>,</span>
        <span class=n>bins</span><span class=o>=</span><span class=p>(</span><span class=n>projbins</span><span class=p>,</span> <span class=n>nbins_domain</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=n>latentedges</span><span class=p>,</span> <span class=n>domainedges</span> <span class=o>=</span> <span class=n>bin_edges</span>

    <span class=n>grad_pos_t_svm</span> <span class=o>=</span> <span class=n>binned_statistic_dd</span><span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>((</span><span class=n>X_t_flat</span><span class=p>,</span> <span class=n>norm_tpts</span><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
        <span class=n>delta_t_flat</span><span class=p>,</span>
        <span class=n>statistic</span><span class=o>=</span><span class=s2>&quot;sum&quot;</span><span class=p>,</span>
        <span class=n>bins</span><span class=o>=</span><span class=p>(</span><span class=n>projbins</span><span class=p>,</span> <span class=n>nbins_domain</span><span class=p>),</span>
    <span class=p>)</span><span class=o>.</span><span class=n>statistic</span>
    <span class=c1># average derivative, a.k.a. flow/vector field for dynamics underlying</span>
    <span class=c1># population activity</span>
    <span class=n>grad_pos_t_svm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>divide</span><span class=p>(</span><span class=n>grad_pos_t_svm</span><span class=p>,</span> <span class=n>H</span><span class=p>,</span> <span class=n>where</span><span class=o>=</span><span class=n>H</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
    <span class=n>grad_pos_t_svm</span><span class=p>[</span><span class=n>H</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>  <span class=c1># crucial to handle division by zero</span>
    <span class=c1># spatial integration via nnancumsum treats nan as zero for cumulative sum</span>
    <span class=n>potential_pos_t</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>nancumsum</span><span class=p>(</span><span class=n>grad_pos_t_svm</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># projbins x domainbins</span>

    <span class=n>idx_zero_X_t</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>latentedges</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
    <span class=n>offset</span> <span class=o>=</span> <span class=n>potential_pos_t</span><span class=p>[</span><span class=n>idx_zero_X_t</span><span class=p>,</span> <span class=p>:]</span>  <span class=c1># use potential at X_t = 0 as reference</span>
    <span class=n>potential_pos_t</span> <span class=o>=</span> <span class=n>potential_pos_t</span> <span class=o>-</span> <span class=n>offset</span>  <span class=c1># potential difference</span>

    <span class=n>nonzero_mask</span> <span class=o>=</span> <span class=n>H</span> <span class=o>!=</span> <span class=mi>0</span>
    <span class=n>idx_first_nonzero</span><span class=p>,</span> <span class=n>idx_last_nonzero</span> <span class=o>=</span> <span class=n>find_terminal_masked_indices</span><span class=p>(</span>
        <span class=n>nonzero_mask</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span>
    <span class=p>)</span>  <span class=c1># each have shape: time</span>
    <span class=c1># along axis 0 set all values from start to idx_first_nonzero to nan</span>
    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>H</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
        <span class=n>potential_pos_t</span><span class=p>[:</span> <span class=n>idx_first_nonzero</span><span class=p>[</span><span class=n>t</span><span class=p>],</span> <span class=n>t</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
        <span class=n>potential_pos_t</span><span class=p>[</span><span class=n>idx_last_nonzero</span><span class=p>[</span><span class=n>t</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span> <span class=p>:,</span> <span class=n>t</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>

    <span class=k>return</span> <span class=n>potential_pos_t</span><span class=p>,</span> <span class=n>grad_pos_t_svm</span><span class=p>,</span> <span class=n>H</span><span class=p>,</span> <span class=n>latentedges</span><span class=p>,</span> <span class=n>domainedges</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.potential_landscape_nd class="doc doc-heading"> <code class="highlight language-python"><span class=n>potential_landscape_nd</span><span class=p>(</span><span class=n>X_dyn</span><span class=p>,</span> <span class=n>projbins</span><span class=p>,</span> <span class=n>domainbins</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>nanborderempty</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute numerical approximation of potential energy landscape across n-dimensional state and domain (e.g. time, position, etc.).</p> <p>Potential landscape is defined as the integral of the flow vectors.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>X_dyn</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>State vectors of shape (trials, bins, neurons)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>projbins</code> </td> <td> <code><span title=int>int</span> or <span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>Number of bins for projection axis or bin edges for each neuron</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>domainbins</code> </td> <td> <code><span title=int>int</span> or <span title=array>array</span> - <span title=like>like</span></code> </td> <td> <div class=doc-md-description> <p>Number of bins for domain axis or bin edges, by default None</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>nanborderempty</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to set border values to nan if they are empty, by default True</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Potential energy landscape across state averaged across domain for each neuron. Shape: nnrns x projbins times nnrns</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Potential energy landscape across state and domain for each neuron. Shape: projbins times nnrns x domainbins x nnrns</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Temporal gradient of potential energy landscape across state and domain for each neuron. Shape: projbins times nnrns x domainbins x nnrns</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Histogram of state vectors across state and domain for each neuron. Shape: projbins times nnrns x domainbins x nnrns</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Bin edges of state vectors for each neuron</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Bin edges of domain for each neuron</p> </div> </td> </tr> </tbody> </table> <details class=references open> <summary>References</summary> <p>.. [1] Wang, S., Falcone, R., Richmond, B. et al. Attractor dynamics reflect decision confidence in macaque prefrontal cortex. Nat Neurosci 26, 1970â1980 (2023).</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/dynamics.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>potential_landscape_nd</span><span class=p>(</span>
    <span class=n>X_dyn</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>projbins</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span>
    <span class=n>domainbins</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>nanborderempty</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compute numerical approximation of potential energy landscape across</span>
<span class=sd>    n-dimensional state and domain (e.g. time, position, etc.).</span>

<span class=sd>    Potential landscape is defined as the integral of the flow vectors.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    X_dyn : np.ndarray</span>
<span class=sd>        State vectors of shape (trials, bins, neurons)</span>
<span class=sd>    projbins : int or array-like</span>
<span class=sd>        Number of bins for projection axis or bin edges for each neuron</span>
<span class=sd>    domainbins : int or array-like, optional</span>
<span class=sd>        Number of bins for domain axis or bin edges, by default None</span>
<span class=sd>    nanborderempty : bool, optional</span>
<span class=sd>        Whether to set border values to nan if they are empty, by default True</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Potential energy landscape across state averaged across domain for each</span>
<span class=sd>        neuron. Shape: nnrns x projbins times nnrns</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Potential energy landscape across state and domain for each neuron.</span>
<span class=sd>        Shape: projbins times nnrns x domainbins x nnrns</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Temporal gradient of potential energy landscape across state and domain</span>
<span class=sd>        for each neuron. Shape: projbins times nnrns x domainbins x nnrns</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Histogram of state vectors across state and domain for each neuron.</span>
<span class=sd>        Shape: projbins times nnrns x domainbins x nnrns</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Bin edges of state vectors for each neuron</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Bin edges of domain for each neuron</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [1] Wang, S., Falcone, R., Richmond, B. et al. Attractor dynamics reflect</span>
<span class=sd>           decision confidence in macaque prefrontal cortex. Nat Neurosci 26,</span>
<span class=sd>           1970â1980 (2023).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># _t suffix is following notation of paper but applicable across any domain</span>
    <span class=n>ntrials</span><span class=p>,</span> <span class=n>nbins</span><span class=p>,</span> <span class=n>nnrns</span> <span class=o>=</span> <span class=n>X_dyn</span><span class=o>.</span><span class=n>shape</span>
    <span class=n>delta_t</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span>
        <span class=n>X_dyn</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>  <span class=c1># time derivatives: ntrials x ndomainbins-1 x nnrns</span>

    <span class=n>X_t_flat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span>
        <span class=n>X_dyn</span><span class=p>[:,</span> <span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>nnrns</span><span class=p>),</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;F&quot;</span>
    <span class=p>)</span>  <span class=c1># skip last bin as no displacement exists for last time point</span>
    <span class=n>delta_t_flat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>delta_t</span><span class=p>,</span> <span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>nnrns</span><span class=p>),</span> <span class=n>order</span><span class=o>=</span><span class=s2>&quot;F&quot;</span><span class=p>)</span>  <span class=c1># column-major order</span>
    <span class=n>norm_tpts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>repeat</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>nbins</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=n>ntrials</span><span class=p>)</span>

    <span class=n>nbins_domain</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>nbins</span> <span class=o>-</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>domainbins</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=n>domainbins</span>
    <span class=p>)</span>  <span class=c1># downsample domain bins</span>

    <span class=n>potential_pos_t_nrns</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>grad_pos_t_svm_nrns</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>hist_nrns</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>latentedges_nrns</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=n>domainedges_nrns</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>nnrn</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nnrns</span><span class=p>):</span>
        <span class=c1># 1D state space binning of time derivatives across domain</span>
        <span class=c1># assumes landscape may morph across domain</span>
        <span class=n>H</span><span class=p>,</span> <span class=n>bin_edges</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>binned_statistic_dd</span><span class=p>(</span>  <span class=c1># (nnrns times projbins) x time</span>
            <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>((</span><span class=o>*</span><span class=n>X_t_flat</span><span class=o>.</span><span class=n>T</span><span class=p>,</span> <span class=n>norm_tpts</span><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
            <span class=n>delta_t_flat</span><span class=p>[:,</span> <span class=n>nnrn</span><span class=p>],</span>
            <span class=n>statistic</span><span class=o>=</span><span class=s2>&quot;count&quot;</span><span class=p>,</span>
            <span class=n>bins</span><span class=o>=</span><span class=p>(</span>
                <span class=o>*</span><span class=p>[</span>
                    <span class=n>projbins</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>projbins</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=k>else</span> <span class=n>projbins</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
                    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nnrns</span><span class=p>)</span>
                <span class=p>],</span>
                <span class=n>nbins_domain</span><span class=p>,</span>
            <span class=p>),</span>
        <span class=p>)</span>
        <span class=n>latentedges</span> <span class=o>=</span> <span class=n>bin_edges</span><span class=p>[</span><span class=n>nnrn</span><span class=p>]</span>
        <span class=n>domainedges</span> <span class=o>=</span> <span class=n>bin_edges</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>

        <span class=n>grad_pos_t_svm</span> <span class=o>=</span> <span class=n>binned_statistic_dd</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>((</span><span class=o>*</span><span class=n>X_t_flat</span><span class=o>.</span><span class=n>T</span><span class=p>,</span> <span class=n>norm_tpts</span><span class=p>))</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
            <span class=n>delta_t_flat</span><span class=p>[:,</span> <span class=n>nnrn</span><span class=p>],</span>
            <span class=n>statistic</span><span class=o>=</span><span class=s2>&quot;sum&quot;</span><span class=p>,</span>
            <span class=n>bins</span><span class=o>=</span><span class=p>(</span>
                <span class=o>*</span><span class=p>[</span>
                    <span class=n>projbins</span> <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>projbins</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=k>else</span> <span class=n>projbins</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
                    <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nnrns</span><span class=p>)</span>
                <span class=p>],</span>
                <span class=n>nbins_domain</span><span class=p>,</span>
            <span class=p>),</span>
        <span class=p>)</span><span class=o>.</span><span class=n>statistic</span>
        <span class=c1># average derivative, a.k.a. flow/vector field for dynamics underlying</span>
        <span class=c1># population activity</span>
        <span class=n>grad_pos_t_svm</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>divide</span><span class=p>(</span><span class=n>grad_pos_t_svm</span><span class=p>,</span> <span class=n>H</span><span class=p>,</span> <span class=n>where</span><span class=o>=</span><span class=n>H</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
        <span class=n>grad_pos_t_svm</span><span class=p>[</span><span class=n>H</span> <span class=o>==</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>  <span class=c1># crucial to handle division by zero</span>
        <span class=c1># spatial integration via nnancumsum treats nan as zero for cumulative sum</span>
        <span class=n>potential_pos_t</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>nancumsum</span><span class=p>(</span>
            <span class=n>grad_pos_t_svm</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=n>nnrn</span>
        <span class=p>)</span>  <span class=c1># (nnrns times projbins) x domainbins</span>

        <span class=k>if</span> <span class=n>nanborderempty</span><span class=p>:</span>
            <span class=n>nonzero_mask</span> <span class=o>=</span> <span class=n>H</span> <span class=o>!=</span> <span class=mi>0</span>

            <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nbins_domain</span><span class=p>):</span>
                <span class=n>nrndimslices</span> <span class=o>=</span> <span class=p>[</span><span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>)]</span> <span class=o>*</span> <span class=n>nnrns</span>
                <span class=n>nrndimslices</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
                <span class=n>peripheral_zeros_nanmask</span> <span class=o>=</span> <span class=o>~</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span>
                    <span class=n>replace_border_zeros_with_nan</span><span class=p>(</span><span class=n>nonzero_mask</span><span class=p>[</span><span class=nb>tuple</span><span class=p>(</span><span class=n>nrndimslices</span><span class=p>)])</span>
                <span class=p>)</span>
                <span class=n>peripheral_zeros_nanmask</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span>
                    <span class=n>peripheral_zeros_nanmask</span><span class=p>,</span> <span class=n>peripheral_zeros_nanmask</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
                <span class=p>)</span>
                <span class=n>potential_pos_t</span><span class=p>[</span><span class=nb>tuple</span><span class=p>(</span><span class=n>nrndimslices</span><span class=p>)]</span> <span class=o>*=</span> <span class=n>peripheral_zeros_nanmask</span>

        <span class=n>potential_pos_t_nrns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>potential_pos_t</span><span class=p>)</span>
        <span class=n>grad_pos_t_svm_nrns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>grad_pos_t_svm</span><span class=p>)</span>
        <span class=n>hist_nrns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>H</span><span class=p>)</span>
        <span class=n>latentedges_nrns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>latentedges</span><span class=p>)</span>
        <span class=n>domainedges_nrns</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>domainedges</span><span class=p>)</span>

    <span class=n>potential_pos_t_nrns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span>
        <span class=n>potential_pos_t_nrns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span>
    <span class=p>)</span>  <span class=c1># projbins x domainbins x nnrns</span>
    <span class=n>grad_pos_t_svm_nrns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span>
        <span class=n>grad_pos_t_svm_nrns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span>
    <span class=p>)</span>  <span class=c1># projbins x domainbins x nnrns</span>
    <span class=n>hist</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span><span class=n>hist_nrns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># projbins x domainbins x nnrns</span>
    <span class=n>latentedges_nrns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span><span class=n>latentedges_nrns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># projbins x nnrns</span>
    <span class=n>domainedges_nrns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>stack</span><span class=p>(</span><span class=n>domainedges_nrns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># domainbins x nnrns</span>
    <span class=n>nrndimslices</span> <span class=o>=</span> <span class=p>[</span><span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>)]</span> <span class=o>*</span> <span class=p>(</span><span class=n>nnrns</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
    <span class=n>nrndimslices</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
    <span class=n>potential_nrns_pos</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>for</span> <span class=n>nrn</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>nnrns</span><span class=p>):</span>
        <span class=n>nrndimslices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>nrn</span>
        <span class=n>potential_nrns_pos</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span>
                <span class=n>potential_pos_t_nrns</span><span class=p>[</span><span class=nb>tuple</span><span class=p>(</span><span class=n>nrndimslices</span><span class=p>)],</span> <span class=n>axis</span><span class=o>=-</span><span class=mi>1</span>
            <span class=p>)</span>  <span class=c1># average across domainbins</span>
        <span class=p>)</span>
    <span class=n>potential_nrns_pos</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>potential_nrns_pos</span><span class=p>)</span>  <span class=c1># nnrns x nnrns times projbins</span>

    <span class=k>return</span> <span class=p>(</span>
        <span class=n>potential_nrns_pos</span><span class=p>,</span>
        <span class=n>potential_pos_t_nrns</span><span class=p>,</span>
        <span class=n>grad_pos_t_svm_nrns</span><span class=p>,</span>
        <span class=n>hist</span><span class=p>,</span>
        <span class=n>latentedges_nrns</span><span class=p>,</span>
        <span class=n>domainedges_nrns</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.proximity class="doc doc-heading"> <code class="highlight language-python"><span class=n>proximity</span><span class=p>(</span><span class=n>pv1</span><span class=p>,</span> <span class=n>pv2</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Proximity between two firing rate vector trajectories.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>pv1</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Firing rate vector trajectory in one context. Shape: (num_bins, num_neurons)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>pv2</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Firing rate vector trajectory in another context. Shape: (num_bins, num_neurons)</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Proximity between the two contexts.</p> </div> </td> </tr> </tbody> </table> <details class=references open> <summary>References</summary> <p>.. [1] Guidera, J. A., Gramling, D. P., Comrie, A. E., Joshi, A., Denovellis, E. L., Lee, K. H., Zhou, J., Thompson, P., Hernandez, J., Yorita, A., Haque, R., Kirst, C., &amp; Frank, L. M. (2024). Regional specialization manifests in the reliability of neural population codes. bioRxiv : the preprint server for biology, 2024.01.25.576941. https://doi.org/10.1101/2024.01.25.576941</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/geometry.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>proximity</span><span class=p>(</span><span class=n>pv1</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>pv2</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Proximity between two firing rate vector trajectories.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    pv1 : numpy.ndarray</span>
<span class=sd>        Firing rate vector trajectory in one context.</span>
<span class=sd>        Shape: (num_bins, num_neurons)</span>

<span class=sd>    pv2 : numpy.ndarray</span>
<span class=sd>        Firing rate vector trajectory in another context.</span>
<span class=sd>        Shape: (num_bins, num_neurons)</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    numpy.ndarray</span>
<span class=sd>        Proximity between the two contexts.</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [1] Guidera, J. A., Gramling, D. P., Comrie, A. E., Joshi, A.,</span>
<span class=sd>        Denovellis, E. L., Lee, K. H., Zhou, J., Thompson, P., Hernandez, J.,</span>
<span class=sd>        Yorita, A., Haque, R., Kirst, C., &amp; Frank, L. M. (2024). Regional</span>
<span class=sd>        specialization manifests in the reliability of neural population codes.</span>
<span class=sd>        bioRxiv : the preprint server for biology, 2024.01.25.576941.</span>
<span class=sd>        https://doi.org/10.1101/2024.01.25.576941</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Calculate the norms</span>
    <span class=n>norm_diff</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>pv1</span> <span class=o>-</span> <span class=n>pv2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=n>norm_diff_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>apply_along_axis</span><span class=p>(</span>
        <span class=k>lambda</span> <span class=n>e</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>e</span> <span class=o>-</span> <span class=n>pv2</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)),</span> <span class=n>arr</span><span class=o>=</span><span class=n>pv1</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span>
    <span class=p>)</span>

    <span class=c1># Calculate proximity</span>
    <span class=n>prox</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=p>(</span><span class=n>norm_diff</span> <span class=o>/</span> <span class=n>norm_diff_mean</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>prox</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.runPatterns class="doc doc-heading"> <code class="highlight language-python"><span class=n>runPatterns</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=s1>&#39;ica&#39;</span><span class=p>,</span> <span class=n>nullhyp</span><span class=o>=</span><span class=s1>&#39;mp&#39;</span><span class=p>,</span> <span class=n>nshu</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>percentile</span><span class=o>=</span><span class=mi>99</span><span class=p>,</span> <span class=n>tracywidom</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=s1>&#39;unit-variance&#39;</span><span class=p>,</span> <span class=n>nassemblies</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cross_structural</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Run pattern detection to identify cell assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>actmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix (neurons, time bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Method to extract assembly patterns (ica, pca), by default "ica".</p> </div> </td> <td> <code>&#39;ica&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nullhyp</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Null hypothesis method (bin, circ, mp), by default "mp".</p> </div> </td> <td> <code>&#39;mp&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nshu</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffling controls, by default 1000.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>percentile</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Percentile for shuffling methods, by default 99.</p> </div> </td> <td> <code>99</code> </td> </tr> <tr class=doc-section-item> <td> <code>tracywidom</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Use Tracy-Widom correction, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>whiten</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Whitening method, by default "unit-variance".</p> </div> </td> <td> <code>&#39;unit-variance&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nassemblies</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Number of assemblies, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A categorical vector indicating group membership for each neuron. If provided, the function will strictly detect cross-structural assemblies (correlations within the same group will be ignored), by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Tuple>Tuple</span>[<span title=typing.Union>Union</span>[<span title=numpy.ndarray>ndarray</span>, None], <span title=object>object</span>, <span title=typing.Union>Union</span>[<span title=numpy.ndarray>ndarray</span>, None]], None]</code> </td> <td> <div class=doc-md-description> <p>Patterns, significance object, and z-scored activity matrix.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>nullhyp 'bin' - bin shuffling, will shuffle time bins of each neuron independently 'circ' - circular shuffling, will shift time bins of each neuron independently 'mp' - Marcenko-Pastur distribution - analytical threshold</p> <p>cross_structural When provided, this vector should have the same length as the number of neurons in actmat. Each element indicates the group membership (e.g., brain region, cell type) for the corresponding neuron. The algorithm will then only detect assemblies that span across different groups by setting within-group correlations to zero.</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>runPatterns</span><span class=p>(</span>
    <span class=n>actmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;ica&quot;</span><span class=p>,</span>
    <span class=n>nullhyp</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;mp&quot;</span><span class=p>,</span>
    <span class=n>nshu</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
    <span class=n>percentile</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>99</span><span class=p>,</span>
    <span class=n>tracywidom</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>whiten</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unit-variance&quot;</span><span class=p>,</span>
    <span class=n>nassemblies</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>cross_structural</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span> <span class=nb>object</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>]],</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run pattern detection to identify cell assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    actmat : np.ndarray</span>
<span class=sd>        Activity matrix (neurons, time bins).</span>
<span class=sd>    method : str, optional</span>
<span class=sd>        Method to extract assembly patterns (ica, pca), by default &quot;ica&quot;.</span>
<span class=sd>    nullhyp : str, optional</span>
<span class=sd>        Null hypothesis method (bin, circ, mp), by default &quot;mp&quot;.</span>
<span class=sd>    nshu : int, optional</span>
<span class=sd>        Number of shuffling controls, by default 1000.</span>
<span class=sd>    percentile : int, optional</span>
<span class=sd>        Percentile for shuffling methods, by default 99.</span>
<span class=sd>    tracywidom : bool, optional</span>
<span class=sd>        Use Tracy-Widom correction, by default False.</span>
<span class=sd>    whiten : str, optional</span>
<span class=sd>        Whitening method, by default &quot;unit-variance&quot;.</span>
<span class=sd>    nassemblies : Optional[int], optional</span>
<span class=sd>        Number of assemblies, by default None.</span>
<span class=sd>    cross_structural : Optional[np.ndarray], optional</span>
<span class=sd>        A categorical vector indicating group membership for each neuron.</span>
<span class=sd>        If provided, the function will strictly detect cross-structural assemblies</span>
<span class=sd>        (correlations within the same group will be ignored), by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Union[Tuple[Union[np.ndarray, None], object, Union[np.ndarray, None]], None]</span>
<span class=sd>        Patterns, significance object, and z-scored activity matrix.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    nullhyp</span>
<span class=sd>        &#39;bin&#39; - bin shuffling, will shuffle time bins of each neuron independently</span>
<span class=sd>        &#39;circ&#39; - circular shuffling, will shift time bins of each neuron independently</span>
<span class=sd>        &#39;mp&#39; - Marcenko-Pastur distribution - analytical threshold</span>

<span class=sd>    cross_structural</span>
<span class=sd>        When provided, this vector should have the same length as the number of neurons</span>
<span class=sd>        in actmat. Each element indicates the group membership (e.g., brain region,</span>
<span class=sd>        cell type) for the corresponding neuron. The algorithm will then only detect</span>
<span class=sd>        assemblies that span across different groups by setting within-group</span>
<span class=sd>        correlations to zero.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>nneurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=c1># Validate cross_structural parameter if provided</span>
    <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>cross_structural</span><span class=p>)</span> <span class=o>!=</span> <span class=n>nneurons</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;cross_structural length (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>cross_structural</span><span class=p>)</span><span class=si>}</span><span class=s2>) must match &quot;</span>
                <span class=sa>f</span><span class=s2>&quot;number of neurons (</span><span class=si>{</span><span class=n>nneurons</span><span class=si>}</span><span class=s2>)&quot;</span>
            <span class=p>)</span>

    <span class=n>silentneurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span>
    <span class=n>actmat_</span> <span class=o>=</span> <span class=n>actmat</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>,</span> <span class=p>:]</span>
    <span class=k>if</span> <span class=n>actmat_</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;no active neurons&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>

    <span class=c1># Update cross_structural to match active neurons only</span>
    <span class=n>cross_structural_</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>cross_structural_</span> <span class=o>=</span> <span class=n>cross_structural</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>]</span>

    <span class=c1># z-scoring activity matrix</span>
    <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>stats</span><span class=o>.</span><span class=n>zscore</span><span class=p>(</span><span class=n>actmat_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=c1># running significance (estimating number of assemblies)</span>
    <span class=n>significance</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>cross_structural_</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=c1># Compute custom correlation matrix for cross-structural assemblies</span>
        <span class=n>correlations</span> <span class=o>=</span> <span class=n>_compute_cross_structural_correlation</span><span class=p>(</span>
            <span class=n>zactmat_</span><span class=p>,</span> <span class=n>cross_structural_</span>
        <span class=p>)</span>
        <span class=c1># Perform eigenvalue decomposition on the custom correlation matrix</span>
        <span class=n>eigenvalues</span><span class=p>,</span> <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>eigh</span><span class=p>(</span><span class=n>correlations</span><span class=p>)</span>
        <span class=c1># Sort in descending order</span>
        <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>eigenvalues</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>eigenvalues</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=n>idx</span><span class=p>]</span>
        <span class=c1># Store results in significance object to mimic PCA interface</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span> <span class=o>=</span> <span class=n>eigenvalues</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>components_</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=o>.</span><span class=n>T</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># Use standard PCA</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>zactmat_</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>

    <span class=n>significance</span><span class=o>.</span><span class=n>nneurons</span> <span class=o>=</span> <span class=n>nneurons</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nbins</span> <span class=o>=</span> <span class=n>nbins</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nshu</span> <span class=o>=</span> <span class=n>nshu</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span> <span class=o>=</span> <span class=n>percentile</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>tracywidom</span> <span class=o>=</span> <span class=n>tracywidom</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>=</span> <span class=n>nullhyp</span>
    <span class=n>significance</span> <span class=o>=</span> <span class=n>runSignificance</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>nassemblies</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>=</span> <span class=n>nassemblies</span>

    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=kc>None</span>

    <span class=k>if</span> <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;no assembly detected&quot;</span><span class=p>)</span>

        <span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>zactmat</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># extracting co-activation patterns</span>
        <span class=n>patterns_</span> <span class=o>=</span> <span class=n>extractPatterns</span><span class=p>(</span>
            <span class=n>zactmat_</span><span class=p>,</span>
            <span class=n>significance</span><span class=p>,</span>
            <span class=n>method</span><span class=p>,</span>
            <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>,</span>
            <span class=n>cross_structural</span><span class=o>=</span><span class=n>cross_structural_</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>patterns_</span> <span class=ow>is</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=c1># putting eventual silent neurons back (their assembly weights are defined as zero)</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>patterns_</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>nneurons</span><span class=p>))</span>
        <span class=n>patterns</span><span class=p>[:,</span> <span class=o>~</span><span class=n>silentneurons</span><span class=p>]</span> <span class=o>=</span> <span class=n>patterns_</span>
        <span class=n>zactmat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>actmat</span><span class=p>)</span>
        <span class=n>zactmat</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>zactmat_</span>

    <span class=k>return</span> <span class=n>patterns</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=n>zactmat</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.runSignificance class="doc doc-heading"> <code class="highlight language-python"><span class=n>runSignificance</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Run significance tests to estimate the number of assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Updated significance object with the number of assemblies.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>runSignificance</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run significance tests to estimate the number of assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    object</span>
<span class=sd>        Updated significance object with the number of assemblies.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;mp&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;bin&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;circ&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;nyll hypothesis method &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; not understood&quot;</span>
        <span class=p>)</span>

    <span class=n>nassemblies</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span> <span class=o>&gt;</span> <span class=n>lambdaMax</span><span class=p>)</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>=</span> <span class=n>nassemblies</span>

    <span class=k>return</span> <span class=n>significance</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.shuffle_and_score class="doc doc-heading"> <code class="highlight language-python"><span class=n>shuffle_and_score</span><span class=p>(</span><span class=n>posterior_array</span><span class=p>,</span> <span class=n>w</span><span class=p>,</span> <span class=n>normalize</span><span class=p>,</span> <span class=n>tc</span><span class=p>,</span> <span class=n>ds</span><span class=p>,</span> <span class=n>dp</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Shuffle the posterior array and compute scores and weighted correlations.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>posterior_array</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>The posterior probability array.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>w</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Weights array.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>normalize</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to normalize the scores.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>, <span title=float>float</span>, <span title=float>float</span>]</code> </td> <td> <div class=doc-md-description> <p>Scores and weighted correlations for time-swapped and column-cycled arrays.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>shuffle_and_score</span><span class=p>(</span>
    <span class=n>posterior_array</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>w</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>normalize</span><span class=p>:</span> <span class=nb>bool</span><span class=p>,</span>
    <span class=n>tc</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>ds</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
    <span class=n>dp</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Shuffle the posterior array and compute scores and weighted correlations.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    posterior_array : np.ndarray</span>
<span class=sd>        The posterior probability array.</span>
<span class=sd>    w : np.ndarray</span>
<span class=sd>        Weights array.</span>
<span class=sd>    normalize : bool</span>
<span class=sd>        Whether to normalize the scores.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[np.ndarray, np.ndarray, float, float]</span>
<span class=sd>        Scores and weighted correlations for time-swapped and column-cycled arrays.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>posterior_ts</span> <span class=o>=</span> <span class=n>replay</span><span class=o>.</span><span class=n>time_swap_array</span><span class=p>(</span><span class=n>posterior_array</span><span class=p>)</span>
    <span class=n>posterior_cs</span> <span class=o>=</span> <span class=n>replay</span><span class=o>.</span><span class=n>column_cycle_array</span><span class=p>(</span><span class=n>posterior_array</span><span class=p>)</span>

    <span class=n>scores_time_swap</span> <span class=o>=</span> <span class=n>replay</span><span class=o>.</span><span class=n>trajectory_score_array</span><span class=p>(</span>
        <span class=n>posterior</span><span class=o>=</span><span class=n>posterior_ts</span><span class=p>,</span> <span class=n>w</span><span class=o>=</span><span class=n>w</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=n>normalize</span>
    <span class=p>)</span>
    <span class=n>scores_col_cycle</span> <span class=o>=</span> <span class=n>replay</span><span class=o>.</span><span class=n>trajectory_score_array</span><span class=p>(</span>
        <span class=n>posterior</span><span class=o>=</span><span class=n>posterior_cs</span><span class=p>,</span> <span class=n>w</span><span class=o>=</span><span class=n>w</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=n>normalize</span>
    <span class=p>)</span>

    <span class=n>weighted_corr_time_swap</span> <span class=o>=</span> <span class=n>weighted_correlation</span><span class=p>(</span><span class=n>posterior_ts</span><span class=p>)</span>
    <span class=n>weighted_corr_col_cycle</span> <span class=o>=</span> <span class=n>weighted_correlation</span><span class=p>(</span><span class=n>posterior_cs</span><span class=p>)</span>

    <span class=k>return</span> <span class=p>(</span>
        <span class=n>scores_time_swap</span><span class=p>,</span>
        <span class=n>scores_col_cycle</span><span class=p>,</span>
        <span class=n>weighted_corr_time_swap</span><span class=p>,</span>
        <span class=n>weighted_corr_col_cycle</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.shuffled_significance class="doc doc-heading"> <code class="highlight language-python"><span class=n>shuffled_significance</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]]),</span> <span class=n>num_shuffles</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> <span class=n>n_jobs</span><span class=o>=-</span><span class=mi>1</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Computes the significance of the task-post correlation by comparing against shuffled distributions.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>task_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike timestamps during the task. Shape is (n_spikes_task,)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>task_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers corresponding to each of <code>task_spikes</code>. Shape is (n_spikes_task,)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_spikes</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike timestamps during post-task (e.g., sleep). Shape is (n_spikes_post,)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_neurons</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers corresponding to <code>post_spikes</code>. Shape is (n_spikes_post,)</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>total_neurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Total number of neurons being considered</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>post_intervals</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Intervals for post-task epochs, with shape (n_intervals, 2). Each row defines the start and end of an interval. May correspond to specific sleep states. Default is <code>np.array([[-np.inf, np.inf]])</code>, representing the entire range of post-task epochs</p> </div> </td> <td> <code><span title=numpy.array>array</span>([[-<span title=numpy.inf>inf</span>, <span title=numpy.inf>inf</span>]])</code> </td> </tr> <tr class=doc-section-item> <td> <code>num_shuffles</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffles to compute the significance. Default is 100</p> </div> </td> <td> <code>100</code> </td> </tr> <tr class=doc-section-item> <td> <code>n_jobs</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of parallel jobs to use for shuffling. Default is -1 (use all available cores).</p> </div> </td> <td> <code>-1</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>z_score</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scores of the observed correlations compared to the shuffled distributions. Shape is (n_intervals,).</p> </div> </td> </tr> <tr class=doc-section-item> <td><code>p_value</code></td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>P-values indicating the significance of the observed correlation. Shape is (n_intervals,).</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>The function uses parallel processing to compute observed and shuffled correlations for each post-task interval. The z-score is calculated as:</p> <pre><code>z_score = (observed_correlation - mean(shuffled_correlations)) / std(shuffled_correlations)
</code></pre> <p>The p-value is computed as the proportion of shuffled correlations greater than the observed correlation, with a small constant added for numerical stability.</p> </details> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>task_spikes</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>1.2</span><span class=p>,</span> <span class=mf>3.4</span><span class=p>,</span> <span class=mf>5.6</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>task_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>post_spikes</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>2.3</span><span class=p>,</span> <span class=mf>4.5</span><span class=p>,</span> <span class=mf>6.7</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>post_neurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>total_neurons</span> <span class=o>=</span> <span class=mi>2</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>post_intervals</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>z_score</span><span class=p>,</span> <span class=n>p_value</span> <span class=o>=</span> <span class=n>shuffled_significance</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>post_spikes</span><span class=p>,</span> <span class=n>post_neurons</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>post_intervals</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>z_score</span>
<span class=go>array([1.23])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>p_value</span>
<span class=go>array([0.04])</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/pairwise_bias_correlation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>shuffled_significance</span><span class=p>(</span>
    <span class=n>task_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>task_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_spikes</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>post_neurons</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>total_neurons</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>post_intervals</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span><span class=p>]]),</span>
    <span class=n>num_shuffles</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span>
    <span class=n>n_jobs</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span>
<span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Computes the significance of the task-post correlation by comparing against shuffled distributions.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    task_spikes : np.ndarray</span>
<span class=sd>        Spike timestamps during the task. Shape is (n_spikes_task,)</span>
<span class=sd>    task_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers corresponding to each of `task_spikes`. Shape is</span>
<span class=sd>        (n_spikes_task,)</span>
<span class=sd>    post_spikes : np.ndarray</span>
<span class=sd>        Spike timestamps during post-task (e.g., sleep). Shape is</span>
<span class=sd>        (n_spikes_post,)</span>
<span class=sd>    post_neurons : np.ndarray</span>
<span class=sd>        Neuron identifiers corresponding to `post_spikes`. Shape is</span>
<span class=sd>        (n_spikes_post,)</span>
<span class=sd>    total_neurons : int</span>
<span class=sd>        Total number of neurons being considered</span>
<span class=sd>    post_intervals : np.ndarray, optional</span>
<span class=sd>        Intervals for post-task epochs, with shape (n_intervals, 2).</span>
<span class=sd>        Each row defines the start and end of an interval. May correspond to</span>
<span class=sd>        specific sleep states. Default is `np.array([[-np.inf, np.inf]])`,</span>
<span class=sd>        representing the entire range of post-task epochs</span>
<span class=sd>    num_shuffles : int, optional</span>
<span class=sd>        Number of shuffles to compute the significance. Default is 100</span>
<span class=sd>    n_jobs : int, optional</span>
<span class=sd>        Number of parallel jobs to use for shuffling. Default is -1 (use all</span>
<span class=sd>        available cores).</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    z_score : np.ndarray</span>
<span class=sd>        Z-scores of the observed correlations compared to the shuffled distributions.</span>
<span class=sd>        Shape is (n_intervals,).</span>
<span class=sd>    p_value : np.ndarray</span>
<span class=sd>        P-values indicating the significance of the observed correlation.</span>
<span class=sd>        Shape is (n_intervals,).</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    The function uses parallel processing to compute observed and shuffled</span>
<span class=sd>    correlations for each post-task interval. The z-score is calculated as:</span>

<span class=sd>        z_score = (observed_correlation - mean(shuffled_correlations)) / std(shuffled_correlations)</span>

<span class=sd>    The p-value is computed as the proportion of shuffled correlations greater than</span>
<span class=sd>    the observed correlation, with a small constant added for numerical stability.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; task_spikes = np.array([1.2, 3.4, 5.6])</span>
<span class=sd>    &gt;&gt;&gt; task_neurons = np.array([0, 1, 0])</span>
<span class=sd>    &gt;&gt;&gt; post_spikes = np.array([2.3, 4.5, 6.7])</span>
<span class=sd>    &gt;&gt;&gt; post_neurons = np.array([1, 0, 1])</span>
<span class=sd>    &gt;&gt;&gt; total_neurons = 2</span>
<span class=sd>    &gt;&gt;&gt; post_intervals = np.array([[0, 10]])</span>
<span class=sd>    &gt;&gt;&gt; z_score, p_value = shuffled_significance(task_spikes, task_neurons, post_spikes, post_neurons, total_neurons, post_intervals)</span>
<span class=sd>    &gt;&gt;&gt; z_score</span>
<span class=sd>    array([1.23])</span>
<span class=sd>    &gt;&gt;&gt; p_value</span>
<span class=sd>    array([0.04])</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># set random seed for reproducibility</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>

    <span class=c1># Compute bias matrices for task epochs</span>
    <span class=n>task_bias_matrix</span> <span class=o>=</span> <span class=n>skew_bias_matrix</span><span class=p>(</span><span class=n>task_spikes</span><span class=p>,</span> <span class=n>task_neurons</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>)</span>

    <span class=c1># Get shuffled and observed correlations using parallel processing</span>
    <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
        <span class=o>*</span><span class=n>Parallel</span><span class=p>(</span><span class=n>n_jobs</span><span class=o>=</span><span class=n>n_jobs</span><span class=p>)(</span>
            <span class=n>delayed</span><span class=p>(</span><span class=n>observed_and_shuffled_correlation</span><span class=p>)(</span>
                <span class=n>post_spikes</span><span class=p>,</span>
                <span class=n>post_neurons</span><span class=p>,</span>
                <span class=n>total_neurons</span><span class=p>,</span>
                <span class=n>task_bias_matrix</span><span class=p>,</span>
                <span class=n>post_intervals</span><span class=p>,</span>
                <span class=n>interval_i</span><span class=p>,</span>
                <span class=n>num_shuffles</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>interval_i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>post_intervals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>shuffled_correlations</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>observed_correlation</span><span class=p>),</span>
        <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=p>),</span>
    <span class=p>)</span>
    <span class=c1># Compute z-score</span>
    <span class=n>shuffled_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>shuffled_std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>std</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
    <span class=n>z_score</span> <span class=o>=</span> <span class=p>(</span><span class=n>observed_correlation</span> <span class=o>-</span> <span class=n>shuffled_mean</span><span class=p>)</span> <span class=o>/</span> <span class=n>shuffled_std</span>

    <span class=c1># significance test between the observed correlation and the shuffled distribution</span>
    <span class=n>p_value</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>shuffled_correlations</span><span class=o>.</span><span class=n>T</span> <span class=o>&gt;</span> <span class=n>observed_correlation</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span>
        <span class=n>num_shuffles</span> <span class=o>+</span> <span class=mi>1</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>z_score</span><span class=p>,</span> <span class=n>p_value</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.skew_bias_matrix class="doc doc-heading"> <code class="highlight language-python"><span class=n>skew_bias_matrix</span><span class=p>(</span><span class=n>spike_times</span><span class=p>,</span> <span class=n>neuron_ids</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>,</span> <span class=n>fillneutral</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute the pairwise skew-bias matrix for a given sequence of spikes.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>spike_times</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Spike times for the sequence, assumed to be sorted.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>neuron_ids</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Neuron identifiers corresponding to <code>spike_times</code>. Values should be integers between 0 and <code>total_neurons - 1</code>.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>total_neurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Total number of neurons being considered.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>fillneutral</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Value to fill for neutral bias, by default 0</p> </div> </td> <td> <code>0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Skew-bias matrix of size <code>(total_neurons, total_neurons)</code> where each entry represents the normalized bias between neuron pairs.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>The probability-bias ( B_{ij} ) for neurons ( i ) and ( j ) is computed as: [ B_{ij} = \frac{nspikes_{ij}}{nspikes_i \cdot nspikes_j} ] where ( nspikes_{ij} ) is the count of spikes from neuron ( i ) occurring before spikes from neuron ( j ). If there are no spikes for either neuron, the bias is set to 0.5 (neutral bias).</p> <p>The skew-bias matrix is computed as: [ S_{ij} = 2 \cdot B_{ij} - 1 ] where ( B_{ij} ) is the probability-bias matrix.</p> <p>The skew-bias matrix is a skew-symmetric matrix as ( S_{ij} = -S_{ji} ). The values are normalized between -1 and 1. A value of 1 indicates that neuron ( i ) spikes before neuron ( j ) in all cases, while -1 indicates the opposite. A value of 0 indicates that the order of spikes is random.</p> </details> <details class=references open> <summary>References</summary> <p>.. [1] Roth, Z. (2016). Analysis of neuronal sequences using pairwise biases. arXiv, 11-16. https://arxiv.org/abs/1603.02916</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/pairwise_bias_correlation.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@njit</span>
<span class=k>def</span><span class=w> </span><span class=nf>skew_bias_matrix</span><span class=p>(</span>
    <span class=n>spike_times</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>neuron_ids</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>total_neurons</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
    <span class=n>fillneutral</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sa>r</span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute the pairwise skew-bias matrix for a given sequence of spikes.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    spike_times : numpy.ndarray</span>
<span class=sd>        Spike times for the sequence, assumed to be sorted.</span>
<span class=sd>    neuron_ids : numpy.ndarray</span>
<span class=sd>        Neuron identifiers corresponding to `spike_times`.</span>
<span class=sd>        Values should be integers between 0 and `total_neurons - 1`.</span>
<span class=sd>    total_neurons : int</span>
<span class=sd>        Total number of neurons being considered.</span>
<span class=sd>    fillneutral : float, optional</span>
<span class=sd>        Value to fill for neutral bias, by default 0</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    numpy.ndarray</span>
<span class=sd>        Skew-bias matrix of size `(total_neurons, total_neurons)` where</span>
<span class=sd>        each entry represents the normalized bias between neuron pairs.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    The probability-bias \( B_{ij} \) for neurons \( i \) and \( j \) is</span>
<span class=sd>    computed as:</span>
<span class=sd>    \[</span>
<span class=sd>    B_{ij} = \frac{nspikes_{ij}}{nspikes_i \cdot nspikes_j}</span>
<span class=sd>    \]</span>
<span class=sd>    where \( nspikes_{ij} \) is the count of spikes from neuron \( i \)</span>
<span class=sd>    occurring before spikes from neuron \( j \). If there are no spikes for</span>
<span class=sd>    either neuron, the bias is set to 0.5 (neutral bias).</span>

<span class=sd>    The skew-bias matrix is computed as:</span>
<span class=sd>    \[</span>
<span class=sd>    S_{ij} = 2 \cdot B_{ij} - 1</span>
<span class=sd>    \]</span>
<span class=sd>    where \( B_{ij} \) is the probability-bias matrix.</span>

<span class=sd>    The skew-bias matrix is a skew-symmetric matrix as \( S_{ij} = -S_{ji} \).</span>
<span class=sd>    The values are normalized between -1 and 1. A value of 1 indicates that</span>
<span class=sd>    neuron \( i \) spikes before neuron \( j \) in all cases, while -1 indicates</span>
<span class=sd>    the opposite. A value of 0 indicates that the order of spikes is random.</span>

<span class=sd>    References</span>
<span class=sd>    ----------</span>
<span class=sd>    .. [1] Roth, Z. (2016). Analysis of neuronal sequences using pairwise</span>
<span class=sd>        biases. arXiv, 11-16. https://arxiv.org/abs/1603.02916</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>bias</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>((</span><span class=n>total_neurons</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>))</span>
    <span class=n>nrn_spk_rindices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>total_neurons</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int64</span><span class=p>)</span>
    <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=n>nrns_st</span> <span class=o>=</span> <span class=n>numba</span><span class=o>.</span><span class=n>typed</span><span class=o>.</span><span class=n>List</span><span class=p>()</span>
    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>total_neurons</span><span class=p>):</span>
        <span class=n>nrns_st</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>numba</span><span class=o>.</span><span class=n>typed</span><span class=o>.</span><span class=n>List</span><span class=o>.</span><span class=n>empty_list</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float64</span><span class=p>))</span>
    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>nrn_id</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>neuron_ids</span><span class=p>):</span>
        <span class=n>nrns_st</span><span class=p>[</span><span class=n>nrn_id</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>spike_times</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
    <span class=k>for</span> <span class=n>nnrn</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>total_neurons</span><span class=p>):</span>
        <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>nnrn</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>nnrn</span><span class=p>]</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>nrns_st</span><span class=p>[</span><span class=n>nnrn</span><span class=p>])</span>

    <span class=n>nrns_st_all</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>empty</span><span class=p>(</span><span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float64</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>nnrn</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>total_neurons</span><span class=p>):</span>
        <span class=n>nrns_st_all</span><span class=p>[</span><span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>nnrn</span><span class=p>]</span> <span class=p>:</span> <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>nnrn</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span>
            <span class=n>nrns_st</span><span class=p>[</span><span class=n>nnrn</span><span class=p>]</span>
        <span class=p>)</span>

    <span class=c1># Build bias matrix</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>total_neurons</span><span class=p>):</span>
        <span class=n>spikes_i</span> <span class=o>=</span> <span class=n>nrns_st_all</span><span class=p>[</span><span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>:</span> <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>
        <span class=n>nspikes_i</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>spikes_i</span><span class=p>)</span>

        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>total_neurons</span><span class=p>):</span>
            <span class=n>nspikes_j</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>nrns_st</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>nspikes_i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>nspikes_j</span> <span class=o>==</span> <span class=mi>0</span><span class=p>):</span>
                <span class=n>bias</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>bias</span><span class=p>[</span><span class=n>j</span><span class=p>,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>fillneutral</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>spikes_j</span> <span class=o>=</span> <span class=n>nrns_st_all</span><span class=p>[</span><span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=p>:</span> <span class=n>nrn_spk_rindices</span><span class=p>[</span><span class=n>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>

                <span class=n>nspikes_ij</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>searchsorted</span><span class=p>(</span><span class=n>spikes_i</span><span class=p>,</span> <span class=n>spikes_j</span><span class=p>,</span> <span class=n>side</span><span class=o>=</span><span class=s2>&quot;right&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
                <span class=n>bias</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=p>(</span><span class=n>nspikes_ij</span> <span class=o>/</span> <span class=p>(</span><span class=n>nspikes_i</span> <span class=o>*</span> <span class=n>nspikes_j</span><span class=p>))</span> <span class=o>-</span> <span class=mi>1</span>
                <span class=n>bias</span><span class=p>[</span><span class=n>j</span><span class=p>,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=n>bias</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>]</span>

    <span class=c1># set diagonal to fillneutral</span>
    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>total_neurons</span><span class=p>):</span>
        <span class=n>bias</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>fillneutral</span>

    <span class=k>return</span> <span class=n>bias</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.toyExample class="doc doc-heading"> <code class="highlight language-python"><span class=n>toyExample</span><span class=p>(</span><span class=n>assemblies</span><span class=p>,</span> <span class=n>nneurons</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>nbins</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>rate</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Generate a toy example activity matrix with assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>assemblies</code> </td> <td> <code><a class="autorefs autorefs-internal" href=assembly/#neuro_py.ensemble.assembly.ToyAssemblies>ToyAssemblies</a></code> </td> <td> <div class=doc-md-description> <p>The toy assemblies.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>nneurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of neurons, by default 10.</p> </div> </td> <td> <code>10</code> </td> </tr> <tr class=doc-section-item> <td> <code>nbins</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of time bins, by default 1000.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>rate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Poisson rate, by default 1.0.</p> </div> </td> <td> <code>1.0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>toyExample</span><span class=p>(</span>
    <span class=n>assemblies</span><span class=p>:</span> <span class=s2>&quot;ToyAssemblies&quot;</span><span class=p>,</span>
    <span class=n>nneurons</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
    <span class=n>nbins</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
    <span class=n>rate</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Generate a toy example activity matrix with assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    assemblies : ToyAssemblies</span>
<span class=sd>        The toy assemblies.</span>
<span class=sd>    nneurons : int, optional</span>
<span class=sd>        Number of neurons, by default 10.</span>
<span class=sd>    nbins : int, optional</span>
<span class=sd>        Number of time bins, by default 1000.</span>
<span class=sd>    rate : float, optional</span>
<span class=sd>        Poisson rate, by default 1.0.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Activity matrix.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>

    <span class=n>actmat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>poisson</span><span class=p>(</span><span class=n>rate</span><span class=p>,</span> <span class=n>nneurons</span> <span class=o>*</span> <span class=n>nbins</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>nneurons</span><span class=p>,</span> <span class=n>nbins</span><span class=p>)</span>
    <span class=n>assemblies</span><span class=o>.</span><span class=n>actbins</span> <span class=o>=</span> <span class=p>[</span><span class=kc>None</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>assemblies</span><span class=o>.</span><span class=n>membership</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>ai</span><span class=p>,</span> <span class=n>members</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>assemblies</span><span class=o>.</span><span class=n>membership</span><span class=p>):</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>members</span><span class=p>)</span>
        <span class=n>nact</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>nbins</span> <span class=o>*</span> <span class=n>assemblies</span><span class=o>.</span><span class=n>actrate</span><span class=p>[</span><span class=n>ai</span><span class=p>])</span>
        <span class=n>actstrength_</span> <span class=o>=</span> <span class=n>rate</span> <span class=o>*</span> <span class=n>assemblies</span><span class=o>.</span><span class=n>actstrength</span><span class=p>[</span><span class=n>ai</span><span class=p>]</span>

        <span class=n>actbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>nbins</span><span class=p>))[</span><span class=mi>0</span><span class=p>:</span><span class=n>nact</span><span class=p>]</span>

        <span class=n>actmat</span><span class=p>[</span><span class=n>members</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>actbins</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>members</span><span class=p>),</span> <span class=n>nact</span><span class=p>))</span> <span class=o>+</span> <span class=n>actstrength_</span>
        <span class=p>)</span>

        <span class=n>assemblies</span><span class=o>.</span><span class=n>actbins</span><span class=p>[</span><span class=n>ai</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>actbins</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>actmat</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.trajectory_score_bst class="doc doc-heading"> <code class="highlight language-python"><span class=n>trajectory_score_bst</span><span class=p>(</span><span class=n>bst</span><span class=p>,</span> <span class=n>tuningcurve</span><span class=p>,</span> <span class=n>w</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>n_shuffles</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>weights</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>parallel</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate trajectory scores and weighted correlations for Bayesian spike train decoding.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>bst</code> </td> <td> <code><span title=nelpy.core.BinnedSpikeTrainArray>BinnedSpikeTrainArray</span></code> </td> <td> <div class=doc-md-description> <p>Binned spike train object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>tuningcurve</code> </td> <td> <code><span title=nelpy.TuningCurve1D>TuningCurve1D</span></code> </td> <td> <div class=doc-md-description> <p>Tuning curve object.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>w</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Window size, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>n_shuffles</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffles, by default 1000.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>weights</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Weights array, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>normalize</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to normalize the scores, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>parallel</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Whether to run in parallel, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>Union[</code> </td> <td> <div class=doc-md-description> <p>Tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray], Tuple[np.ndarray, np.ndarray],</p> </div> </td> </tr> <tr class=doc-section-item> <td> <code>]</code> </td> <td> <div class=doc-md-description> <p>Scores and weighted correlations for original, time-swapped, and column-cycled arrays.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>719</span>
<span class=normal>720</span>
<span class=normal>721</span>
<span class=normal>722</span>
<span class=normal>723</span>
<span class=normal>724</span>
<span class=normal>725</span>
<span class=normal>726</span>
<span class=normal>727</span>
<span class=normal>728</span>
<span class=normal>729</span>
<span class=normal>730</span>
<span class=normal>731</span>
<span class=normal>732</span>
<span class=normal>733</span>
<span class=normal>734</span>
<span class=normal>735</span>
<span class=normal>736</span>
<span class=normal>737</span>
<span class=normal>738</span>
<span class=normal>739</span>
<span class=normal>740</span>
<span class=normal>741</span>
<span class=normal>742</span>
<span class=normal>743</span>
<span class=normal>744</span>
<span class=normal>745</span>
<span class=normal>746</span>
<span class=normal>747</span>
<span class=normal>748</span>
<span class=normal>749</span>
<span class=normal>750</span>
<span class=normal>751</span>
<span class=normal>752</span>
<span class=normal>753</span>
<span class=normal>754</span>
<span class=normal>755</span>
<span class=normal>756</span>
<span class=normal>757</span>
<span class=normal>758</span>
<span class=normal>759</span>
<span class=normal>760</span>
<span class=normal>761</span>
<span class=normal>762</span>
<span class=normal>763</span>
<span class=normal>764</span>
<span class=normal>765</span>
<span class=normal>766</span>
<span class=normal>767</span>
<span class=normal>768</span>
<span class=normal>769</span>
<span class=normal>770</span>
<span class=normal>771</span>
<span class=normal>772</span>
<span class=normal>773</span>
<span class=normal>774</span>
<span class=normal>775</span>
<span class=normal>776</span>
<span class=normal>777</span>
<span class=normal>778</span>
<span class=normal>779</span>
<span class=normal>780</span>
<span class=normal>781</span>
<span class=normal>782</span>
<span class=normal>783</span>
<span class=normal>784</span>
<span class=normal>785</span>
<span class=normal>786</span>
<span class=normal>787</span>
<span class=normal>788</span>
<span class=normal>789</span>
<span class=normal>790</span>
<span class=normal>791</span>
<span class=normal>792</span>
<span class=normal>793</span>
<span class=normal>794</span>
<span class=normal>795</span>
<span class=normal>796</span>
<span class=normal>797</span>
<span class=normal>798</span>
<span class=normal>799</span>
<span class=normal>800</span>
<span class=normal>801</span>
<span class=normal>802</span>
<span class=normal>803</span>
<span class=normal>804</span>
<span class=normal>805</span>
<span class=normal>806</span>
<span class=normal>807</span>
<span class=normal>808</span>
<span class=normal>809</span>
<span class=normal>810</span>
<span class=normal>811</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>trajectory_score_bst</span><span class=p>(</span>
    <span class=n>bst</span><span class=p>:</span> <span class=n>BinnedSpikeTrainArray</span><span class=p>,</span>
    <span class=n>tuningcurve</span><span class=p>:</span> <span class=n>TuningCurve1D</span><span class=p>,</span>
    <span class=n>w</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>n_shuffles</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
    <span class=n>weights</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>normalize</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>parallel</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span>
    <span class=n>Tuple</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>],</span>
<span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate trajectory scores and weighted correlations for Bayesian spike train decoding.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    bst : BinnedSpikeTrainArray</span>
<span class=sd>        Binned spike train object.</span>
<span class=sd>    tuningcurve : TuningCurve1D</span>
<span class=sd>        Tuning curve object.</span>
<span class=sd>    w : Optional[int], optional</span>
<span class=sd>        Window size, by default None.</span>
<span class=sd>    n_shuffles : int, optional</span>
<span class=sd>        Number of shuffles, by default 1000.</span>
<span class=sd>    weights : Optional[np.ndarray], optional</span>
<span class=sd>        Weights array, by default None.</span>
<span class=sd>    normalize : bool, optional</span>
<span class=sd>        Whether to normalize the scores, by default False.</span>
<span class=sd>    parallel : bool, optional</span>
<span class=sd>        Whether to run in parallel, by default True.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Union[</span>
<span class=sd>        Tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray, np.ndarray],</span>
<span class=sd>        Tuple[np.ndarray, np.ndarray],</span>
<span class=sd>    ]</span>
<span class=sd>        Scores and weighted correlations for original, time-swapped, and column-cycled arrays.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>if</span> <span class=n>w</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>w</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=nb>float</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=o>.</span><span class=n>is_integer</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;w has to be an integer!&quot;</span><span class=p>)</span>

    <span class=k>if</span> <span class=nb>float</span><span class=p>(</span><span class=n>n_shuffles</span><span class=p>)</span><span class=o>.</span><span class=n>is_integer</span><span class=p>:</span>
        <span class=n>n_shuffles</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>n_shuffles</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;n_shuffles must be an integer!&quot;</span><span class=p>)</span>

    <span class=n>posterior</span><span class=p>,</span> <span class=n>bdries</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>decode</span><span class=p>(</span><span class=n>bst</span><span class=o>=</span><span class=n>bst</span><span class=p>,</span> <span class=n>ratemap</span><span class=o>=</span><span class=n>tuningcurve</span><span class=p>)</span>

    <span class=n>num_cores</span> <span class=o>=</span> <span class=mi>1</span>

    <span class=k>if</span> <span class=n>parallel</span><span class=p>:</span>
        <span class=c1># all but one core</span>
        <span class=n>num_cores</span> <span class=o>=</span> <span class=n>multiprocessing</span><span class=o>.</span><span class=n>cpu_count</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span>

    <span class=n>ds</span><span class=p>,</span> <span class=n>dp</span> <span class=o>=</span> <span class=n>bst</span><span class=o>.</span><span class=n>ds</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>diff</span><span class=p>(</span><span class=n>tuningcurve</span><span class=o>.</span><span class=n>bins</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>

    <span class=p>(</span>
        <span class=n>scores</span><span class=p>,</span>
        <span class=n>weighted_corr</span><span class=p>,</span>
        <span class=n>scores_time_swap</span><span class=p>,</span>
        <span class=n>scores_col_cycle</span><span class=p>,</span>
        <span class=n>weighted_corr_time_swap</span><span class=p>,</span>
        <span class=n>weighted_corr_col_cycle</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>=</span> <span class=nb>zip</span><span class=p>(</span>
        <span class=o>*</span><span class=n>Parallel</span><span class=p>(</span><span class=n>n_jobs</span><span class=o>=</span><span class=n>num_cores</span><span class=p>)(</span>
            <span class=n>delayed</span><span class=p>(</span><span class=n>_shuffle_and_score</span><span class=p>)(</span>
                <span class=n>posterior</span><span class=p>[:,</span> <span class=n>bdries</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span> <span class=p>:</span> <span class=n>bdries</span><span class=p>[</span><span class=n>idx</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]],</span>
                <span class=n>tuningcurve</span><span class=p>,</span>
                <span class=n>w</span><span class=p>,</span>
                <span class=n>normalize</span><span class=p>,</span>
                <span class=n>ds</span><span class=p>,</span>
                <span class=n>dp</span><span class=p>,</span>
                <span class=n>n_shuffles</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>bst</span><span class=o>.</span><span class=n>n_epochs</span><span class=p>)</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=n>n_shuffles</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>scores</span><span class=p>),</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>weighted_corr</span><span class=p>),</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>scores_time_swap</span><span class=p>)</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>scores_col_cycle</span><span class=p>)</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>weighted_corr_time_swap</span><span class=p>)</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>weighted_corr_col_cycle</span><span class=p>)</span><span class=o>.</span><span class=n>T</span><span class=p>,</span>
        <span class=p>)</span>
    <span class=k>return</span> <span class=n>scores</span><span class=p>,</span> <span class=n>weighted_corr</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.weighted_corr_2d class="doc doc-heading"> <code class="highlight language-python"><span class=n>weighted_corr_2d</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x_coords</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>y_coords</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>time_coords</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate the weighted correlation between the X and Y dimensions of the matrix.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>weights</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A matrix of weights.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>x_coords</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>X-values for each column and row, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>y_coords</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Y-values for each column and row, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>time_coords</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Time-values for each column and row, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Tuple>Tuple</span>[<span title=float>float</span>, <span title=numpy.ndarray>ndarray</span>, <span title=numpy.ndarray>ndarray</span>, <span title=float>float</span>, <span title=float>float</span>, <span title=float>float</span>, <span title=float>float</span>]</code> </td> <td> <div class=doc-md-description> <p>The weighted correlation coefficient, x trajectory, y trajectory, slope_x, slope_y, mean_x, mean_y.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>weights</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]],</span> <span class=p>[[</span><span class=mi>7</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>],</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>]]])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>x_coords</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>y_coords</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>time_coords</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>weighted_corr_2d</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x_coords</span><span class=p>,</span> <span class=n>y_coords</span><span class=p>,</span> <span class=n>time_coords</span><span class=p>)</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>weighted_corr_2d</span><span class=p>(</span>
    <span class=n>weights</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>x_coords</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>y_coords</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>time_coords</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate the weighted correlation between the X and Y dimensions of the matrix.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    weights : np.ndarray</span>
<span class=sd>        A matrix of weights.</span>
<span class=sd>    x_coords : Optional[np.ndarray], optional</span>
<span class=sd>        X-values for each column and row, by default None.</span>
<span class=sd>    y_coords : Optional[np.ndarray], optional</span>
<span class=sd>        Y-values for each column and row, by default None.</span>
<span class=sd>    time_coords : Optional[np.ndarray], optional</span>
<span class=sd>        Time-values for each column and row, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Tuple[float, np.ndarray, np.ndarray, float, float, float, float]</span>
<span class=sd>        The weighted correlation coefficient, x trajectory, y trajectory,</span>
<span class=sd>        slope_x, slope_y, mean_x, mean_y.</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    &gt;&gt;&gt; import numpy as np</span>
<span class=sd>    &gt;&gt;&gt; weights = np.array([[[1, 2, 3], [4, 5, 6]], [[7, 8, 9], [10, 11, 12]]])</span>
<span class=sd>    &gt;&gt;&gt; x_coords = np.array([0, 1])</span>
<span class=sd>    &gt;&gt;&gt; y_coords = np.array([0, 1])</span>
<span class=sd>    &gt;&gt;&gt; time_coords = np.array([0, 1, 2])</span>
<span class=sd>    &gt;&gt;&gt; weighted_corr_2d(weights, x_coords, y_coords, time_coords)</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>x_dim</span><span class=p>,</span> <span class=n>y_dim</span><span class=p>,</span> <span class=n>t_dim</span> <span class=o>=</span> <span class=n>weights</span><span class=o>.</span><span class=n>shape</span>
    <span class=n>dtype</span> <span class=o>=</span> <span class=n>weights</span><span class=o>.</span><span class=n>dtype</span>

    <span class=n>x_coords</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>x_dim</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>x_coords</span> <span class=ow>is</span> <span class=kc>None</span>
        <span class=k>else</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>x_coords</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>y_coords</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>y_dim</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>y_coords</span> <span class=ow>is</span> <span class=kc>None</span>
        <span class=k>else</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>y_coords</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>time_coords</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>t_dim</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>time_coords</span> <span class=ow>is</span> <span class=kc>None</span>
        <span class=k>else</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>time_coords</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>dtype</span><span class=p>)</span>
    <span class=p>)</span>

    <span class=k>return</span> <span class=n>__weighted_corr_2d_jit</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>x_coords</span><span class=p>,</span> <span class=n>y_coords</span><span class=p>,</span> <span class=n>time_coords</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.weighted_correlation class="doc doc-heading"> <code class="highlight language-python"><span class=n>weighted_correlation</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=n>time</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>place_bin_centers</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>return_full_output</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate the weighted correlation between time and place bin centers using a posterior probability matrix.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>posterior</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>A 2D numpy array representing the posterior probability matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>time</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A 1D numpy array representing the time bins, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>place_bin_centers</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A 1D numpy array representing the place bin centers, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>return_full_output</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, return trajectory, slopes, means, and intercept in addition to correlation, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Union>Union</span>[<span title=float>float</span>, <span title=typing.Tuple>Tuple</span>[<span title=float>float</span>, <span title=numpy.ndarray>ndarray</span>, <span title=float>float</span>, <span title=float>float</span>, <span title=float>float</span>, <span title=float>float</span>]]</code> </td> <td> <div class=doc-md-description> <p>If return_full_output is False: The weighted correlation coefficient (float). If return_full_output is True: Tuple of (correlation, place_trajectory, slope_place, mean_time, mean_place, intercept_place) where: - correlation: weighted correlation coefficient - place_trajectory: place position at each time bin - slope_place: slope of place vs time - mean_time: weighted mean of time - mean_place: weighted mean of place - intercept_place: intercept of linear relationship (place = intercept + slope_place * time)</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Examples:</span></p> <p>Basic usage with just a posterior matrix:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
<span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span><span class=w> </span><span class=nn>matplotlib.pyplot</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>plt</span>
<span class=gp>&gt;&gt;&gt; </span><span class=c1># Create a synthetic posterior with forward replay pattern</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>n_place_bins</span><span class=p>,</span> <span class=n>n_time_bins</span> <span class=o>=</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>10</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>posterior</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n_place_bins</span><span class=p>,</span> <span class=n>n_time_bins</span><span class=p>))</span>
<span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_time_bins</span><span class=p>):</span>
<span class=gp>... </span>    <span class=n>posterior</span><span class=p>[</span><span class=mi>2</span><span class=o>*</span><span class=n>t</span><span class=p>:</span><span class=mi>2</span><span class=o>*</span><span class=n>t</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span> <span class=n>t</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.0</span>  <span class=c1># diagonal pattern</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>correlation</span> <span class=o>=</span> <span class=n>weighted_correlation</span><span class=p>(</span><span class=n>posterior</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Correlation: </span><span class=si>{</span><span class=n>correlation</span><span class=si>:</span><span class=s2>.3f</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>With custom time and place bin centers:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n_time_bins</span><span class=p>)</span>  <span class=c1># 1 second duration</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>place_bin_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linspace</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>,</span> <span class=n>n_place_bins</span><span class=p>)</span>  <span class=c1># 100 cm track</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>correlation</span> <span class=o>=</span> <span class=n>weighted_correlation</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=n>time</span><span class=p>,</span> <span class=n>place_bin_centers</span><span class=p>)</span>
</code></pre></div> <p>Getting full output including trajectory and slope:</p> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>corr</span><span class=p>,</span> <span class=n>traj</span><span class=p>,</span> <span class=n>slope</span><span class=p>,</span> <span class=n>mean_t</span><span class=p>,</span> <span class=n>mean_p</span><span class=p>,</span> <span class=n>intercept</span> <span class=o>=</span> <span class=n>weighted_correlation</span><span class=p>(</span>
<span class=gp>... </span>    <span class=n>posterior</span><span class=p>,</span> <span class=n>time</span><span class=p>,</span> <span class=n>place_bin_centers</span><span class=p>,</span> <span class=n>return_full_output</span><span class=o>=</span><span class=kc>True</span>
<span class=gp>... </span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Replay speed: </span><span class=si>{</span><span class=n>slope</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2> cm/s&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=gp>&gt;&gt;&gt; </span><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span>
<span class=gp>... </span>   <span class=n>posterior</span><span class=p>,</span>
<span class=gp>... </span>   <span class=n>aspect</span><span class=o>=</span><span class=s2>&quot;auto&quot;</span><span class=p>,</span>
<span class=gp>... </span>   <span class=n>origin</span><span class=o>=</span><span class=s2>&quot;lower&quot;</span><span class=p>,</span>
<span class=gp>... </span>   <span class=n>extent</span><span class=o>=</span><span class=p>[</span><span class=n>time</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>time</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>place_bin_centers</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>place_bin_centers</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]],</span>
<span class=gp>... </span>  <span class=n>cmap</span><span class=o>=</span><span class=s2>&quot;bone_r&quot;</span>
<span class=gp>... </span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>plt</span><span class=o>.</span><span class=n>colorbar</span><span class=p>(</span><span class=n>label</span><span class=o>=</span><span class=s2>&quot;Posterior Probability Density&quot;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>slope</span> <span class=o>*</span> <span class=n>time</span> <span class=o>+</span> <span class=n>intercept</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&quot;red&quot;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&quot;fit line&quot;</span><span class=p>)</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
<span class=gp>&gt;&gt;&gt; </span><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&quot;Time (s)&quot;</span><span class=p>)</span>
</code></pre></div> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/replay.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span>
<span class=normal>574</span>
<span class=normal>575</span>
<span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>weighted_correlation</span><span class=p>(</span>
    <span class=n>posterior</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>time</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>place_bin_centers</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>return_full_output</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>float</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=nb>float</span><span class=p>]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate the weighted correlation between time and place bin centers using a posterior probability matrix.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    posterior : np.ndarray</span>
<span class=sd>        A 2D numpy array representing the posterior probability matrix.</span>
<span class=sd>    time : Optional[np.ndarray], optional</span>
<span class=sd>        A 1D numpy array representing the time bins, by default None.</span>
<span class=sd>    place_bin_centers : Optional[np.ndarray], optional</span>
<span class=sd>        A 1D numpy array representing the place bin centers, by default None.</span>
<span class=sd>    return_full_output : bool, optional</span>
<span class=sd>        If True, return trajectory, slopes, means, and intercept in addition to correlation, by default False.</span>
<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Union[float, Tuple[float, np.ndarray, float, float, float, float]]</span>
<span class=sd>        If return_full_output is False:</span>
<span class=sd>            The weighted correlation coefficient (float).</span>
<span class=sd>        If return_full_output is True:</span>
<span class=sd>            Tuple of (correlation, place_trajectory, slope_place, mean_time, mean_place, intercept_place)</span>
<span class=sd>            where:</span>
<span class=sd>            - correlation: weighted correlation coefficient</span>
<span class=sd>            - place_trajectory: place position at each time bin</span>
<span class=sd>            - slope_place: slope of place vs time</span>
<span class=sd>            - mean_time: weighted mean of time</span>
<span class=sd>            - mean_place: weighted mean of place</span>
<span class=sd>            - intercept_place: intercept of linear relationship (place = intercept + slope_place * time)</span>

<span class=sd>    Examples</span>
<span class=sd>    --------</span>
<span class=sd>    Basic usage with just a posterior matrix:</span>

<span class=sd>    &gt;&gt;&gt; import numpy as np</span>
<span class=sd>    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class=sd>    &gt;&gt;&gt; # Create a synthetic posterior with forward replay pattern</span>
<span class=sd>    &gt;&gt;&gt; n_place_bins, n_time_bins = 20, 10</span>
<span class=sd>    &gt;&gt;&gt; posterior = np.zeros((n_place_bins, n_time_bins))</span>
<span class=sd>    &gt;&gt;&gt; for t in range(n_time_bins):</span>
<span class=sd>    ...     posterior[2*t:2*t+3, t] = 1.0  # diagonal pattern</span>
<span class=sd>    &gt;&gt;&gt; correlation = weighted_correlation(posterior)</span>
<span class=sd>    &gt;&gt;&gt; print(f&quot;Correlation: {correlation:.3f}&quot;)</span>

<span class=sd>    With custom time and place bin centers:</span>

<span class=sd>    &gt;&gt;&gt; time = np.linspace(0, 1, n_time_bins)  # 1 second duration</span>
<span class=sd>    &gt;&gt;&gt; place_bin_centers = np.linspace(0, 100, n_place_bins)  # 100 cm track</span>
<span class=sd>    &gt;&gt;&gt; correlation = weighted_correlation(posterior, time, place_bin_centers)</span>

<span class=sd>    Getting full output including trajectory and slope:</span>

<span class=sd>    &gt;&gt;&gt; corr, traj, slope, mean_t, mean_p, intercept = weighted_correlation(</span>
<span class=sd>    ...     posterior, time, place_bin_centers, return_full_output=True</span>
<span class=sd>    ... )</span>
<span class=sd>    &gt;&gt;&gt; print(f&quot;Replay speed: {slope:.1f} cm/s&quot;)</span>

<span class=sd>    &gt;&gt;&gt; plt.imshow(</span>
<span class=sd>    ...    posterior,</span>
<span class=sd>    ...    aspect=&quot;auto&quot;,</span>
<span class=sd>    ...    origin=&quot;lower&quot;,</span>
<span class=sd>    ...    extent=[time[0], time[-1], place_bin_centers[0], place_bin_centers[-1]],</span>
<span class=sd>    ...   cmap=&quot;bone_r&quot;</span>
<span class=sd>    ... )</span>
<span class=sd>    &gt;&gt;&gt; plt.colorbar(label=&quot;Posterior Probability Density&quot;)</span>
<span class=sd>    &gt;&gt;&gt; plt.plot(time, slope * time + intercept, color=&quot;red&quot;, linewidth=2, label=&quot;fit line&quot;)</span>
<span class=sd>    &gt;&gt;&gt; plt.legend()</span>
<span class=sd>    &gt;&gt;&gt; plt.xlabel(&quot;Time (s)&quot;)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_m</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Weighted Mean&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>w</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_cov</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Weighted Covariance&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>w</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>_m</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>w</span><span class=p>))</span> <span class=o>*</span> <span class=p>(</span><span class=n>y</span> <span class=o>-</span> <span class=n>_m</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>w</span><span class=p>)))</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>w</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_corr</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Weighted Correlation&quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=n>_cov</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>_cov</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span> <span class=o>*</span> <span class=n>_cov</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>w</span><span class=p>))</span>

    <span class=k>if</span> <span class=n>time</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
    <span class=k>if</span> <span class=n>place_bin_centers</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>place_bin_centers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>posterior</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>

    <span class=n>time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>asarray</span><span class=p>(</span><span class=n>time</span><span class=p>)</span>
    <span class=n>place_bin_centers</span> <span class=o>=</span> <span class=n>place_bin_centers</span><span class=o>.</span><span class=n>squeeze</span><span class=p>()</span>
    <span class=n>posterior</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>posterior</span><span class=p>,</span> <span class=n>copy</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>posterior</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>posterior</span><span class=p>)]</span> <span class=o>=</span> <span class=mf>0.0</span>

    <span class=n>correlation</span> <span class=o>=</span> <span class=n>_corr</span><span class=p>(</span>
        <span class=n>time</span><span class=p>[:,</span> <span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>],</span> <span class=n>place_bin_centers</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>,</span> <span class=p>:],</span> <span class=n>posterior</span><span class=o>.</span><span class=n>T</span>
    <span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>return_full_output</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>correlation</span>

    <span class=c1># Compute full output (trajectory, slopes, means)</span>
    <span class=n>weights</span> <span class=o>=</span> <span class=n>posterior</span><span class=o>.</span><span class=n>T</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
    <span class=n>time_2d</span><span class=p>,</span> <span class=n>place_2d</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>meshgrid</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>place_bin_centers</span><span class=p>,</span> <span class=n>indexing</span><span class=o>=</span><span class=s2>&quot;ij&quot;</span><span class=p>)</span>
    <span class=n>time_flat</span> <span class=o>=</span> <span class=n>time_2d</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>
    <span class=n>place_flat</span> <span class=o>=</span> <span class=n>place_2d</span><span class=o>.</span><span class=n>flatten</span><span class=p>()</span>

    <span class=c1># Compute weighted means</span>
    <span class=n>total_weight</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>

    <span class=c1># Handle degenerate case: no weights</span>
    <span class=k>if</span> <span class=n>total_weight</span> <span class=o>==</span> <span class=mf>0.0</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>),</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=n>mean_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=n>time_flat</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_weight</span>
    <span class=n>mean_place</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=n>place_flat</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_weight</span>

    <span class=c1># Compute covariances</span>
    <span class=n>cov_time_place</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=p>(</span><span class=n>time_flat</span> <span class=o>-</span> <span class=n>mean_time</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>place_flat</span> <span class=o>-</span> <span class=n>mean_place</span><span class=p>))</span>
        <span class=o>/</span> <span class=n>total_weight</span>
    <span class=p>)</span>
    <span class=n>cov_time_time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=p>(</span><span class=n>time_flat</span> <span class=o>-</span> <span class=n>mean_time</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=n>total_weight</span>

    <span class=c1># Handle degenerate case: no temporal variance</span>
    <span class=k>if</span> <span class=n>cov_time_time</span> <span class=o>==</span> <span class=mf>0.0</span><span class=p>:</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>),</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
            <span class=n>mean_time</span><span class=p>,</span>
            <span class=n>mean_place</span><span class=p>,</span>
            <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span>
        <span class=p>)</span>

    <span class=c1># Compute slope and trajectory</span>
    <span class=n>slope_place</span> <span class=o>=</span> <span class=n>cov_time_place</span> <span class=o>/</span> <span class=n>cov_time_time</span>
    <span class=n>place_trajectory</span> <span class=o>=</span> <span class=n>mean_place</span> <span class=o>+</span> <span class=n>slope_place</span> <span class=o>*</span> <span class=p>(</span><span class=n>time</span> <span class=o>-</span> <span class=n>mean_time</span><span class=p>)</span>
    <span class=n>intercept_place</span> <span class=o>=</span> <span class=n>mean_place</span> <span class=o>-</span> <span class=n>slope_place</span> <span class=o>*</span> <span class=n>mean_time</span>

    <span class=k>return</span> <span class=p>(</span>
        <span class=n>correlation</span><span class=p>,</span>
        <span class=n>place_trajectory</span><span class=p>,</span>
        <span class=n>slope_place</span><span class=p>,</span>
        <span class=n>mean_time</span><span class=p>,</span>
        <span class=n>mean_place</span><span class=p>,</span>
        <span class=n>intercept_place</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../detectors/ class="md-footer__link md-footer__link--prev" aria-label="Previous:  detectors"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> detectors </div> </div> </a> <a href=../io/ class="md-footer__link md-footer__link--next" aria-label="Next:  io"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> io </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>