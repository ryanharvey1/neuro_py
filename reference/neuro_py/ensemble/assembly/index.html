<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../detectors/up_down_state/ rel=prev><link href=../assembly_reactivation/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>neuro_py.ensemble.assembly - neuro_py</title><link rel=stylesheet href=../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../stylesheets/extra.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#neuro_py.ensemble.assembly class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../.. title=neuro_py class="md-header__button md-logo" aria-label=neuro_py data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> neuro_py </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> neuro_py.ensemble.assembly </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=light data-md-color-primary=custom data-md-color-accent=custom aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=blue aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ryanharvey1/neuro_py title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ryanharvey1/neuro_py </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../../../tutorials/attractor_landscape/ class=md-tabs__link> Tutorials </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=neuro_py class="md-nav__button md-logo" aria-label=neuro_py data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> neuro_py </label> <div class=md-nav__source> <a href=https://github.com/ryanharvey1/neuro_py title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> ryanharvey1/neuro_py </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> API Reference </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> behavior </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> behavior </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../behavior/cheeseboard/ class=md-nav__link> <span class=md-ellipsis> cheeseboard </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/circle_maze/ class=md-nav__link> <span class=md-ellipsis> circle_maze </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/get_trials/ class=md-nav__link> <span class=md-ellipsis> get_trials </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/kinematics/ class=md-nav__link> <span class=md-ellipsis> kinematics </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/linear_positions/ class=md-nav__link> <span class=md-ellipsis> linear_positions </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/linearization/ class=md-nav__link> <span class=md-ellipsis> linearization </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/linearization_pipeline/ class=md-nav__link> <span class=md-ellipsis> linearization_pipeline </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../../behavior/well_traversal_classification/ class=md-nav__link> <span class=md-ellipsis> well_traversal_classification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex> <span class=md-ellipsis> detectors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> detectors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../detectors/dentate_spike/ class=md-nav__link> <span class=md-ellipsis> dentate_spike </span> </a> </li> <li class=md-nav__item> <a href=../../detectors/up_down_state/ class=md-nav__link> <span class=md-ellipsis> up_down_state </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4 checked> <div class="md-nav__link md-nav__container"> <a href=../decoding/ class="md-nav__link "> <span class=md-ellipsis> ensemble </span> </a> <label class="md-nav__link " for=__nav_2_4 id=__nav_2_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=true> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> ensemble </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> assembly </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> assembly </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly class=md-nav__link> <span class=md-ellipsis> assembly </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.ToyAssemblies class=md-nav__link> <span class=md-ellipsis> ToyAssemblies </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly._compute_cross_structural_correlation class=md-nav__link> <span class=md-ellipsis> _compute_cross_structural_correlation </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.binshuffling class=md-nav__link> <span class=md-ellipsis> binshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.circshuffling class=md-nav__link> <span class=md-ellipsis> circshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.computeAssemblyActivity class=md-nav__link> <span class=md-ellipsis> computeAssemblyActivity </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.extractPatterns class=md-nav__link> <span class=md-ellipsis> extractPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.getlambdacontrol class=md-nav__link> <span class=md-ellipsis> getlambdacontrol </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.marcenkopastur class=md-nav__link> <span class=md-ellipsis> marcenkopastur </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.runPatterns class=md-nav__link> <span class=md-ellipsis> runPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.runSignificance class=md-nav__link> <span class=md-ellipsis> runSignificance </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.toyExample class=md-nav__link> <span class=md-ellipsis> toyExample </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../assembly_reactivation/ class=md-nav__link> <span class=md-ellipsis> assembly_reactivation </span> </a> </li> <li class=md-nav__item> <a href=../dynamics/ class=md-nav__link> <span class=md-ellipsis> dynamics </span> </a> </li> <li class=md-nav__item> <a href=../explained_variance/ class=md-nav__link> <span class=md-ellipsis> explained_variance </span> </a> </li> <li class=md-nav__item> <a href=../geometry/ class=md-nav__link> <span class=md-ellipsis> geometry </span> </a> </li> <li class=md-nav__item> <a href=../pairwise_bias_correlation/ class=md-nav__link> <span class=md-ellipsis> pairwise_bias_correlation </span> </a> </li> <li class=md-nav__item> <a href=../replay/ class=md-nav__link> <span class=md-ellipsis> replay </span> </a> </li> <li class=md-nav__item> <a href=../similarity_index/ class=md-nav__link> <span class=md-ellipsis> similarity_index </span> </a> </li> <li class=md-nav__item> <a href=../similaritymat/ class=md-nav__link> <span class=md-ellipsis> similaritymat </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex> <span class=md-ellipsis> decoding </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> decoding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../decoding/bayesian/ class=md-nav__link> <span class=md-ellipsis> bayesian </span> </a> </li> <li class=md-nav__item> <a href=../decoding/lstm/ class=md-nav__link> <span class=md-ellipsis> lstm </span> </a> </li> <li class=md-nav__item> <a href=../decoding/m2mlstm/ class=md-nav__link> <span class=md-ellipsis> m2mlstm </span> </a> </li> <li class=md-nav__item> <a href=../decoding/mlp/ class=md-nav__link> <span class=md-ellipsis> mlp </span> </a> </li> <li class=md-nav__item> <a href=../decoding/pipeline/ class=md-nav__link> <span class=md-ellipsis> pipeline </span> </a> </li> <li class=md-nav__item> <a href=../decoding/preprocess/ class=md-nav__link> <span class=md-ellipsis> preprocess </span> </a> </li> <li class=md-nav__item> <a href=../decoding/transformer/ class=md-nav__link> <span class=md-ellipsis> transformer </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex> <span class=md-ellipsis> io </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> io </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../io/loading/ class=md-nav__link> <span class=md-ellipsis> loading </span> </a> </li> <li class=md-nav__item> <a href=../../io/saving/ class=md-nav__link> <span class=md-ellipsis> saving </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex> <span class=md-ellipsis> lfp </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> lfp </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lfp/CSD/ class=md-nav__link> <span class=md-ellipsis> CSD </span> </a> </li> <li class=md-nav__item> <a href=../../lfp/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../../lfp/spectral/ class=md-nav__link> <span class=md-ellipsis> spectral </span> </a> </li> <li class=md-nav__item> <a href=../../lfp/theta_cycles/ class=md-nav__link> <span class=md-ellipsis> theta_cycles </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_8> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex> <span class=md-ellipsis> plotting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_8_label aria-expanded=false> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> plotting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../plotting/decorators/ class=md-nav__link> <span class=md-ellipsis> decorators </span> </a> </li> <li class=md-nav__item> <a href=../../plotting/events/ class=md-nav__link> <span class=md-ellipsis> events </span> </a> </li> <li class=md-nav__item> <a href=../../plotting/figure_helpers/ class=md-nav__link> <span class=md-ellipsis> figure_helpers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_9> <label class=md-nav__link for=__nav_2_9 id=__nav_2_9_label tabindex> <span class=md-ellipsis> process </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_9_label aria-expanded=false> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> process </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../process/batch_analysis/ class=md-nav__link> <span class=md-ellipsis> batch_analysis </span> </a> </li> <li class=md-nav__item> <a href=../../process/correlations/ class=md-nav__link> <span class=md-ellipsis> correlations </span> </a> </li> <li class=md-nav__item> <a href=../../process/intervals/ class=md-nav__link> <span class=md-ellipsis> intervals </span> </a> </li> <li class=md-nav__item> <a href=../../process/peri_event/ class=md-nav__link> <span class=md-ellipsis> peri_event </span> </a> </li> <li class=md-nav__item> <a href=../../process/precession_utils/ class=md-nav__link> <span class=md-ellipsis> precession_utils </span> </a> </li> <li class=md-nav__item> <a href=../../process/pychronux/ class=md-nav__link> <span class=md-ellipsis> pychronux </span> </a> </li> <li class=md-nav__item> <a href=../../process/utils/ class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_10> <label class=md-nav__link for=__nav_2_10 id=__nav_2_10_label tabindex> <span class=md-ellipsis> raw </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_10_label aria-expanded=false> <label class=md-nav__title for=__nav_2_10> <span class="md-nav__icon md-icon"></span> raw </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../raw/preprocessing/ class=md-nav__link> <span class=md-ellipsis> preprocessing </span> </a> </li> <li class=md-nav__item> <a href=../../raw/spike_sorting/ class=md-nav__link> <span class=md-ellipsis> spike_sorting </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_11> <label class=md-nav__link for=__nav_2_11 id=__nav_2_11_label tabindex> <span class=md-ellipsis> session </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_11_label aria-expanded=false> <label class=md-nav__title for=__nav_2_11> <span class="md-nav__icon md-icon"></span> session </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../session/locate_epochs/ class=md-nav__link> <span class=md-ellipsis> locate_epochs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_12> <label class=md-nav__link for=__nav_2_12 id=__nav_2_12_label tabindex> <span class=md-ellipsis> spikes </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_2_12> <span class="md-nav__icon md-icon"></span> spikes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../spikes/spike_tools/ class=md-nav__link> <span class=md-ellipsis> spike_tools </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_13> <label class=md-nav__link for=__nav_2_13 id=__nav_2_13_label tabindex> <span class=md-ellipsis> stats </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_13_label aria-expanded=false> <label class=md-nav__title for=__nav_2_13> <span class="md-nav__icon md-icon"></span> stats </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../stats/circ_stats/ class=md-nav__link> <span class=md-ellipsis> circ_stats </span> </a> </li> <li class=md-nav__item> <a href=../../stats/regression/ class=md-nav__link> <span class=md-ellipsis> regression </span> </a> </li> <li class=md-nav__item> <a href=../../stats/stats/ class=md-nav__link> <span class=md-ellipsis> stats </span> </a> </li> <li class=md-nav__item> <a href=../../stats/system_identifier/ class=md-nav__link> <span class=md-ellipsis> system_identifier </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_14> <label class=md-nav__link for=__nav_2_14 id=__nav_2_14_label tabindex> <span class=md-ellipsis> tuning </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_14_label aria-expanded=false> <label class=md-nav__title for=__nav_2_14> <span class="md-nav__icon md-icon"></span> tuning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tuning/fields/ class=md-nav__link> <span class=md-ellipsis> fields </span> </a> </li> <li class=md-nav__item> <a href=../../tuning/maps/ class=md-nav__link> <span class=md-ellipsis> maps </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_15> <label class=md-nav__link for=__nav_2_15 id=__nav_2_15_label tabindex> <span class=md-ellipsis> util </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_15_label aria-expanded=false> <label class=md-nav__title for=__nav_2_15> <span class="md-nav__icon md-icon"></span> util </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../util/array/ class=md-nav__link> <span class=md-ellipsis> array </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../tutorials/attractor_landscape/ class=md-nav__link> <span class=md-ellipsis> Attractor Estimation </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/batch_analysis/ class=md-nav__link> <span class=md-ellipsis> Batch Analysis </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/bias_correlation/ class=md-nav__link> <span class=md-ellipsis> Bias Correlation </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/explained_variance/ class=md-nav__link> <span class=md-ellipsis> Explained Variance </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/decoding/ class=md-nav__link> <span class=md-ellipsis> Neural Decoding </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/neural_geodynamics/ class=md-nav__link> <span class=md-ellipsis> Neural Geodynamics </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/peth_tutorial/ class=md-nav__link> <span class=md-ellipsis> PETH </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/reactivation/ class=md-nav__link> <span class=md-ellipsis> Reactivation </span> </a> </li> <li class=md-nav__item> <a href=../../../../tutorials/spatial_map/ class=md-nav__link> <span class=md-ellipsis> Spatial Map </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly class=md-nav__link> <span class=md-ellipsis> assembly </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.ToyAssemblies class=md-nav__link> <span class=md-ellipsis> ToyAssemblies </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly._compute_cross_structural_correlation class=md-nav__link> <span class=md-ellipsis> _compute_cross_structural_correlation </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.binshuffling class=md-nav__link> <span class=md-ellipsis> binshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.circshuffling class=md-nav__link> <span class=md-ellipsis> circshuffling </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.computeAssemblyActivity class=md-nav__link> <span class=md-ellipsis> computeAssemblyActivity </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.extractPatterns class=md-nav__link> <span class=md-ellipsis> extractPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.getlambdacontrol class=md-nav__link> <span class=md-ellipsis> getlambdacontrol </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.marcenkopastur class=md-nav__link> <span class=md-ellipsis> marcenkopastur </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.runPatterns class=md-nav__link> <span class=md-ellipsis> runPatterns </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.runSignificance class=md-nav__link> <span class=md-ellipsis> runSignificance </span> </a> </li> <li class=md-nav__item> <a href=#neuro_py.ensemble.assembly.toyExample class=md-nav__link> <span class=md-ellipsis> toyExample </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../../../.. class=md-path__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-path__item> <a href=../../behavior/ class=md-path__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-path__item> <a href=./ class=md-path__link> <span class=md-ellipsis> ensemble </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <a href=https://github.com/ryanharvey1/neuro_py/edit/main/docs/neuro_py/ensemble/assembly.py title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/ryanharvey1/neuro_py/raw/main/docs/neuro_py/ensemble/assembly.py title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1> assembly</h1> <div class="doc doc-object doc-module"> <a id=neuro_py.ensemble.assembly></a> <div class="doc doc-contents first"> <p>Codes for PCA/ICA methods described in Detecting cell assemblies in large neuronal populations, Lopes-dos-Santos et al (2013). https://doi.org/10.1016/j.jneumeth.2013.04.010 This implementation was written in Feb 2019. Please e-mail me if you have comments, doubts, bug reports or criticism (VÃ­tor, vtlsantos@gmail.com / vitor.lopesdossantos@pharm.ox.ac.uk).</p> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=neuro_py.ensemble.assembly.ToyAssemblies class="doc doc-heading"> <code>ToyAssemblies</code> </h2> <div class="doc doc-contents "> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ToyAssemblies</span><span class=p>:</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>membership</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]],</span>
        <span class=n>actrate</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>],</span>
        <span class=n>actstrength</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>float</span><span class=p>],</span>
    <span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>        Initialize ToyAssemblies.</span>

<span class=sd>        Parameters</span>
<span class=sd>        ----------</span>
<span class=sd>        membership : List[List[int]]</span>
<span class=sd>            List of lists containing neuron memberships for each assembly.</span>
<span class=sd>        actrate : List[float]</span>
<span class=sd>            List of activation rates for each assembly.</span>
<span class=sd>        actstrength : List[float]</span>
<span class=sd>            List of activation strengths for each assembly.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>membership</span> <span class=o>=</span> <span class=n>membership</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>actrate</span> <span class=o>=</span> <span class=n>actrate</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>actstrength</span> <span class=o>=</span> <span class=n>actstrength</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly._compute_cross_structural_correlation class="doc doc-heading"> <code class="highlight language-python"><span class=n>_compute_cross_structural_correlation</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>cross_structural</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute correlation matrix with within-group correlations set to zero.</p> <p>This implements the cross-structural assembly detection approach where correlations within the same group are ignored to force detection of assemblies that span across different groups.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix (neurons, time bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Categorical vector indicating group membership for each neuron.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Modified correlation matrix with within-group correlations set to zero.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>_compute_cross_structural_correlation</span><span class=p>(</span>
    <span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>cross_structural</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute correlation matrix with within-group correlations set to zero.</span>

<span class=sd>    This implements the cross-structural assembly detection approach where</span>
<span class=sd>    correlations within the same group are ignored to force detection of</span>
<span class=sd>    assemblies that span across different groups.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix (neurons, time bins).</span>
<span class=sd>    cross_structural : np.ndarray</span>
<span class=sd>        Categorical vector indicating group membership for each neuron.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Modified correlation matrix with within-group correlations set to zero.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Compute standard correlation matrix</span>
    <span class=n>correlations</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>corrcoef</span><span class=p>(</span><span class=n>zactmat</span><span class=p>)</span>

    <span class=c1># Create mask for same-group pairs</span>
    <span class=n>groups</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>cross_structural</span><span class=p>)</span>
    <span class=n>same_group_mask</span> <span class=o>=</span> <span class=n>groups</span><span class=p>[:,</span> <span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>]</span> <span class=o>==</span> <span class=n>groups</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>newaxis</span><span class=p>,</span> <span class=p>:]</span>

    <span class=c1># Set within-group correlations to zero, but keep diagonal as 1</span>
    <span class=n>correlations</span><span class=p>[</span><span class=n>same_group_mask</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
    <span class=n>np</span><span class=o>.</span><span class=n>fill_diagonal</span><span class=p>(</span><span class=n>correlations</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>correlations</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.binshuffling class="doc doc-heading"> <code class="highlight language-python"><span class=n>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Perform bin shuffling to generate statistical threshold.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Perform bin shuffling to generate statistical threshold.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>()</span>

    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>shui</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>):</span>
        <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>zactmat</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>neuroni</span><span class=p>,</span> <span class=n>activity</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>):</span>
            <span class=n>randomorder</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nbins</span><span class=p>))</span>
            <span class=n>zactmat_</span><span class=p>[</span><span class=n>neuroni</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>activity</span><span class=p>[</span><span class=n>randomorder</span><span class=p>]</span>
        <span class=n>lambdamax_</span><span class=p>[</span><span class=n>shui</span><span class=p>]</span> <span class=o>=</span> <span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span>

    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>lambdamax_</span><span class=p>,</span> <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.circshuffling class="doc doc-heading"> <code class="highlight language-python"><span class=n>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Perform circular shuffling to generate statistical threshold.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Perform circular shuffling to generate statistical threshold.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>()</span>

    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>shui</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nshu</span><span class=p>):</span>
        <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>zactmat</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>neuroni</span><span class=p>,</span> <span class=n>activity</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>):</span>
            <span class=n>cut</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nbins</span> <span class=o>*</span> <span class=mi>2</span><span class=p>))</span>
            <span class=n>zactmat_</span><span class=p>[</span><span class=n>neuroni</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>roll</span><span class=p>(</span><span class=n>activity</span><span class=p>,</span> <span class=n>cut</span><span class=p>)</span>
        <span class=n>lambdamax_</span><span class=p>[</span><span class=n>shui</span><span class=p>]</span> <span class=o>=</span> <span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span>

    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>percentile</span><span class=p>(</span><span class=n>lambdamax_</span><span class=p>,</span> <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.computeAssemblyActivity class="doc doc-heading"> <code class="highlight language-python"><span class=n>computeAssemblyActivity</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=n>zactmat</span><span class=p>,</span> <span class=n>zerodiag</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Compute assembly activity.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>patterns</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Co-activation patterns (assemblies, neurons).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix (neurons, time bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>zerodiag</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>If True, diagonal of projection matrix is set to zero, by default True.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Assembly activity matrix (assemblies, time bins).</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>computeAssemblyActivity</span><span class=p>(</span>
    <span class=n>patterns</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>zerodiag</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Compute assembly activity.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    patterns : np.ndarray</span>
<span class=sd>        Co-activation patterns (assemblies, neurons).</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix (neurons, time bins).</span>
<span class=sd>    zerodiag : bool, optional</span>
<span class=sd>        If True, diagonal of projection matrix is set to zero, by default True.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Optional[np.ndarray]</span>
<span class=sd>        Assembly activity matrix (assemblies, time bins).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># check if patterns is empty (no assembly detected) and return None if so</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>patterns</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=k>return</span> <span class=kc>None</span>

    <span class=c1># number of assemblies and time bins</span>
    <span class=n>nassemblies</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>patterns</span><span class=p>)</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=c1># transpose for later matrix multiplication</span>
    <span class=n>zactmat</span> <span class=o>=</span> <span class=n>zactmat</span><span class=o>.</span><span class=n>T</span>

    <span class=c1># preallocate assembly activity matrix (nassemblies, nbins)</span>
    <span class=n>assemblyAct</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>nbins</span><span class=p>))</span>

    <span class=c1># loop over assemblies</span>
    <span class=k>for</span> <span class=n>assemblyi</span><span class=p>,</span> <span class=n>pattern</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>patterns</span><span class=p>):</span>
        <span class=c1># compute projection matrix (neurons, neurons)</span>
        <span class=n>projMat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>pattern</span><span class=p>)</span>

        <span class=c1># set the diagonal to zero to not count coactivation of i and j when i=j</span>
        <span class=k>if</span> <span class=n>zerodiag</span><span class=p>:</span>
            <span class=n>np</span><span class=o>.</span><span class=n>fill_diagonal</span><span class=p>(</span><span class=n>projMat</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>

        <span class=c1># project assembly pattern onto z-scored activity matrix</span>
        <span class=n>assemblyAct</span><span class=p>[</span><span class=n>assemblyi</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nansum</span><span class=p>(</span><span class=n>zactmat</span> <span class=o>@</span> <span class=n>projMat</span> <span class=o>*</span> <span class=n>zactmat</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>assemblyAct</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.extractPatterns class="doc doc-heading"> <code class="highlight language-python"><span class=n>extractPatterns</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=s1>&#39;unit-variance&#39;</span><span class=p>,</span> <span class=n>cross_structural</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Extract co-activation patterns (assemblies).</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>actmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Method to extract assembly patterns (ica, pca).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>whiten</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Whitening method, by default "unit-variance".</p> </div> </td> <td> <code>&#39;unit-variance&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>Categorical vector indicating group membership for each neuron. If provided and method is 'ica', will run ICA on data with modified cross-structural correlation structure, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Co-activation patterns (assemblies).</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>extractPatterns</span><span class=p>(</span>
    <span class=n>actmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>,</span>
    <span class=n>method</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
    <span class=n>whiten</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unit-variance&quot;</span><span class=p>,</span>
    <span class=n>cross_structural</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Extract co-activation patterns (assemblies).</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    actmat : np.ndarray</span>
<span class=sd>        Activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>
<span class=sd>    method : str</span>
<span class=sd>        Method to extract assembly patterns (ica, pca).</span>
<span class=sd>    whiten : str, optional</span>
<span class=sd>        Whitening method, by default &quot;unit-variance&quot;.</span>
<span class=sd>    cross_structural : Optional[np.ndarray], optional</span>
<span class=sd>        Categorical vector indicating group membership for each neuron.</span>
<span class=sd>        If provided and method is &#39;ica&#39;, will run ICA on data with modified</span>
<span class=sd>        cross-structural correlation structure, by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Co-activation patterns (assemblies).</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>nassemblies</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span>

    <span class=k>if</span> <span class=n>method</span> <span class=o>==</span> <span class=s2>&quot;pca&quot;</span><span class=p>:</span>
        <span class=n>idxs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=o>-</span><span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span><span class=p>)[</span><span class=mi>0</span><span class=p>:</span><span class=n>nassemblies</span><span class=p>]</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>components_</span><span class=p>[</span><span class=n>idxs</span><span class=p>,</span> <span class=p>:]</span>
    <span class=k>elif</span> <span class=n>method</span> <span class=o>==</span> <span class=s2>&quot;ica&quot;</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
            <span class=c1># For cross-structural ICA, modify the input data to reflect the cross-structural correlation structure</span>
            <span class=n>correlations</span> <span class=o>=</span> <span class=n>_compute_cross_structural_correlation</span><span class=p>(</span>
                <span class=n>actmat</span><span class=p>,</span> <span class=n>cross_structural</span>
            <span class=p>)</span>

            <span class=c1># Eigenvalue decomposition to get the cross-structural subspace</span>
            <span class=n>eigenvalues</span><span class=p>,</span> <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>eigh</span><span class=p>(</span><span class=n>correlations</span><span class=p>)</span>
            <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>eigenvalues</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
            <span class=n>eigenvalues</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
            <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=n>idx</span><span class=p>]</span>

            <span class=c1># Use the top nassemblies components (already determined)</span>
            <span class=n>eigenvectors_sig</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=p>:</span><span class=n>nassemblies</span><span class=p>]</span>
            <span class=n>eigenvalues_sig</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[:</span><span class=n>nassemblies</span><span class=p>]</span>

            <span class=c1># Project the data onto the cross-structural subspace</span>
            <span class=n>projected_data</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>eigenvectors_sig</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=n>eigenvalues_sig</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
            <span class=p>)</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>actmat</span>

            <span class=c1># Run ICA on the projected data</span>
            <span class=n>ica</span> <span class=o>=</span> <span class=n>FastICA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>)</span>
            <span class=n>ica</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>projected_data</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
            <span class=c1># Transform ICA components back to original space</span>
            <span class=n>patterns</span> <span class=o>=</span> <span class=p>(</span>
                <span class=n>ica</span><span class=o>.</span><span class=n>components_</span>
                <span class=o>@</span> <span class=p>(</span><span class=n>eigenvectors_sig</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=n>eigenvalues_sig</span><span class=p>,</span> <span class=mi>0</span><span class=p>)))</span><span class=o>.</span><span class=n>T</span>
            <span class=p>)</span>
        <span class=k>else</span><span class=p>:</span>
            <span class=c1># Standard ICA</span>
            <span class=n>ica</span> <span class=o>=</span> <span class=n>FastICA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=n>nassemblies</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>)</span>
            <span class=n>ica</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>actmat</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
            <span class=n>patterns</span> <span class=o>=</span> <span class=n>ica</span><span class=o>.</span><span class=n>components_</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;assembly extraction method &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>method</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; not understood&quot;</span>
        <span class=p>)</span>

    <span class=k>if</span> <span class=n>patterns</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>:</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>patterns</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>nassemblies</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>

        <span class=c1># sets norm of assembly vectors to 1</span>
        <span class=n>norms</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
        <span class=n>patterns</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>tile</span><span class=p>(</span><span class=n>norms</span><span class=p>,</span> <span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>patterns</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>1</span><span class=p>])</span><span class=o>.</span><span class=n>T</span>

    <span class=k>return</span> <span class=n>patterns</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.getlambdacontrol class="doc doc-heading"> <code class="highlight language-python"><span class=n>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Get the maximum eigenvalue from PCA.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat_</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Maximum eigenvalue.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>getlambdacontrol</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Get the maximum eigenvalue from PCA.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat_ : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Maximum eigenvalue.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>significance_</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>()</span>
    <span class=n>significance_</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>zactmat_</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
    <span class=n>lambdamax_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>significance_</span><span class=o>.</span><span class=n>explained_variance_</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>lambdamax_</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.marcenkopastur class="doc doc-heading"> <code class="highlight language-python"><span class=n>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Calculate statistical threshold from Marcenko-Pastur distribution.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Statistical threshold.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Calculate statistical threshold from Marcenko-Pastur distribution.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    float</span>
<span class=sd>        Statistical threshold.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nbins</span>
    <span class=n>nneurons</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>nneurons</span>
    <span class=n>tracywidom</span> <span class=o>=</span> <span class=n>significance</span><span class=o>.</span><span class=n>tracywidom</span>

    <span class=c1># calculates statistical threshold from Marcenko-Pastur distribution</span>
    <span class=n>q</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>nbins</span><span class=p>)</span> <span class=o>/</span> <span class=nb>float</span><span class=p>(</span><span class=n>nneurons</span><span class=p>)</span>  <span class=c1># note that silent neurons are counted too</span>
    <span class=n>lambdaMax</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>((</span><span class=mi>1</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>1</span> <span class=o>/</span> <span class=n>q</span><span class=p>)),</span> <span class=mi>2</span><span class=p>)</span>
    <span class=n>lambdaMax</span> <span class=o>+=</span> <span class=n>tracywidom</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>nneurons</span><span class=p>,</span> <span class=o>-</span><span class=mf>2.0</span> <span class=o>/</span> <span class=mi>3</span><span class=p>)</span>  <span class=c1># Tracy-Widom correction</span>

    <span class=k>return</span> <span class=n>lambdaMax</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.runPatterns class="doc doc-heading"> <code class="highlight language-python"><span class=n>runPatterns</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>method</span><span class=o>=</span><span class=s1>&#39;ica&#39;</span><span class=p>,</span> <span class=n>nullhyp</span><span class=o>=</span><span class=s1>&#39;mp&#39;</span><span class=p>,</span> <span class=n>nshu</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>percentile</span><span class=o>=</span><span class=mi>99</span><span class=p>,</span> <span class=n>tracywidom</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>whiten</span><span class=o>=</span><span class=s1>&#39;unit-variance&#39;</span><span class=p>,</span> <span class=n>nassemblies</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>cross_structural</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Run pattern detection to identify cell assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>actmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix (neurons, time bins).</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>method</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Method to extract assembly patterns (ica, pca), by default "ica".</p> </div> </td> <td> <code>&#39;ica&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nullhyp</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Null hypothesis method (bin, circ, mp), by default "mp".</p> </div> </td> <td> <code>&#39;mp&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nshu</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of shuffling controls, by default 1000.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>percentile</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Percentile for shuffling methods, by default 99.</p> </div> </td> <td> <code>99</code> </td> </tr> <tr class=doc-section-item> <td> <code>tracywidom</code> </td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>Use Tracy-Widom correction, by default False.</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class=doc-section-item> <td> <code>whiten</code> </td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Whitening method, by default "unit-variance".</p> </div> </td> <td> <code>&#39;unit-variance&#39;</code> </td> </tr> <tr class=doc-section-item> <td> <code>nassemblies</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=int>int</span>]</code> </td> <td> <div class=doc-md-description> <p>Number of assemblies, by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class=doc-section-item> <td> <code>cross_structural</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=numpy.ndarray>ndarray</span>]</code> </td> <td> <div class=doc-md-description> <p>A categorical vector indicating group membership for each neuron. If provided, the function will strictly detect cross-structural assemblies (correlations within the same group will be ignored), by default None.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Union>Union</span>[<span title=typing.Tuple>Tuple</span>[<span title=typing.Union>Union</span>[<span title=numpy.ndarray>ndarray</span>, None], <span title=object>object</span>, <span title=typing.Union>Union</span>[<span title=numpy.ndarray>ndarray</span>, None]], None]</code> </td> <td> <div class=doc-md-description> <p>Patterns, significance object, and z-scored activity matrix.</p> </div> </td> </tr> </tbody> </table> <details class=note open> <summary>Notes</summary> <p>nullhyp 'bin' - bin shuffling, will shuffle time bins of each neuron independently 'circ' - circular shuffling, will shift time bins of each neuron independently 'mp' - Marcenko-Pastur distribution - analytical threshold</p> <p>cross_structural When provided, this vector should have the same length as the number of neurons in actmat. Each element indicates the group membership (e.g., brain region, cell type) for the corresponding neuron. The algorithm will then only detect assemblies that span across different groups by setting within-group correlations to zero.</p> </details> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>runPatterns</span><span class=p>(</span>
    <span class=n>actmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span>
    <span class=n>method</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;ica&quot;</span><span class=p>,</span>
    <span class=n>nullhyp</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;mp&quot;</span><span class=p>,</span>
    <span class=n>nshu</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
    <span class=n>percentile</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>99</span><span class=p>,</span>
    <span class=n>tracywidom</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>,</span>
    <span class=n>whiten</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;unit-variance&quot;</span><span class=p>,</span>
    <span class=n>nassemblies</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
    <span class=n>cross_structural</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>],</span> <span class=nb>object</span><span class=p>,</span> <span class=n>Union</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=kc>None</span><span class=p>]],</span> <span class=kc>None</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run pattern detection to identify cell assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    actmat : np.ndarray</span>
<span class=sd>        Activity matrix (neurons, time bins).</span>
<span class=sd>    method : str, optional</span>
<span class=sd>        Method to extract assembly patterns (ica, pca), by default &quot;ica&quot;.</span>
<span class=sd>    nullhyp : str, optional</span>
<span class=sd>        Null hypothesis method (bin, circ, mp), by default &quot;mp&quot;.</span>
<span class=sd>    nshu : int, optional</span>
<span class=sd>        Number of shuffling controls, by default 1000.</span>
<span class=sd>    percentile : int, optional</span>
<span class=sd>        Percentile for shuffling methods, by default 99.</span>
<span class=sd>    tracywidom : bool, optional</span>
<span class=sd>        Use Tracy-Widom correction, by default False.</span>
<span class=sd>    whiten : str, optional</span>
<span class=sd>        Whitening method, by default &quot;unit-variance&quot;.</span>
<span class=sd>    nassemblies : Optional[int], optional</span>
<span class=sd>        Number of assemblies, by default None.</span>
<span class=sd>    cross_structural : Optional[np.ndarray], optional</span>
<span class=sd>        A categorical vector indicating group membership for each neuron.</span>
<span class=sd>        If provided, the function will strictly detect cross-structural assemblies</span>
<span class=sd>        (correlations within the same group will be ignored), by default None.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    Union[Tuple[Union[np.ndarray, None], object, Union[np.ndarray, None]], None]</span>
<span class=sd>        Patterns, significance object, and z-scored activity matrix.</span>

<span class=sd>    Notes</span>
<span class=sd>    -----</span>
<span class=sd>    nullhyp</span>
<span class=sd>        &#39;bin&#39; - bin shuffling, will shuffle time bins of each neuron independently</span>
<span class=sd>        &#39;circ&#39; - circular shuffling, will shift time bins of each neuron independently</span>
<span class=sd>        &#39;mp&#39; - Marcenko-Pastur distribution - analytical threshold</span>

<span class=sd>    cross_structural</span>
<span class=sd>        When provided, this vector should have the same length as the number of neurons</span>
<span class=sd>        in actmat. Each element indicates the group membership (e.g., brain region,</span>
<span class=sd>        cell type) for the corresponding neuron. The algorithm will then only detect</span>
<span class=sd>        assemblies that span across different groups by setting within-group</span>
<span class=sd>        correlations to zero.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>nneurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
    <span class=n>nbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>

    <span class=c1># Validate cross_structural parameter if provided</span>
    <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>cross_structural</span><span class=p>)</span> <span class=o>!=</span> <span class=n>nneurons</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;cross_structural length (</span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>cross_structural</span><span class=p>)</span><span class=si>}</span><span class=s2>) must match &quot;</span>
                <span class=sa>f</span><span class=s2>&quot;number of neurons (</span><span class=si>{</span><span class=n>nneurons</span><span class=si>}</span><span class=s2>)&quot;</span>
            <span class=p>)</span>

    <span class=n>silentneurons</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>var</span><span class=p>(</span><span class=n>actmat</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span>
    <span class=n>actmat_</span> <span class=o>=</span> <span class=n>actmat</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>,</span> <span class=p>:]</span>
    <span class=k>if</span> <span class=n>actmat_</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;no active neurons&quot;</span><span class=p>)</span>
        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>

    <span class=c1># Update cross_structural to match active neurons only</span>
    <span class=n>cross_structural_</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>cross_structural</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>cross_structural_</span> <span class=o>=</span> <span class=n>cross_structural</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>]</span>

    <span class=c1># z-scoring activity matrix</span>
    <span class=n>zactmat_</span> <span class=o>=</span> <span class=n>stats</span><span class=o>.</span><span class=n>zscore</span><span class=p>(</span><span class=n>actmat_</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>

    <span class=c1># running significance (estimating number of assemblies)</span>
    <span class=n>significance</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>()</span>

    <span class=k>if</span> <span class=n>cross_structural_</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=c1># Compute custom correlation matrix for cross-structural assemblies</span>
        <span class=n>correlations</span> <span class=o>=</span> <span class=n>_compute_cross_structural_correlation</span><span class=p>(</span>
            <span class=n>zactmat_</span><span class=p>,</span> <span class=n>cross_structural_</span>
        <span class=p>)</span>
        <span class=c1># Perform eigenvalue decomposition on the custom correlation matrix</span>
        <span class=n>eigenvalues</span><span class=p>,</span> <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>eigh</span><span class=p>(</span><span class=n>correlations</span><span class=p>)</span>
        <span class=c1># Sort in descending order</span>
        <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>eigenvalues</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
        <span class=n>eigenvalues</span> <span class=o>=</span> <span class=n>eigenvalues</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
        <span class=n>eigenvectors</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=p>[:,</span> <span class=n>idx</span><span class=p>]</span>
        <span class=c1># Store results in significance object to mimic PCA interface</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span> <span class=o>=</span> <span class=n>eigenvalues</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>components_</span> <span class=o>=</span> <span class=n>eigenvectors</span><span class=o>.</span><span class=n>T</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># Use standard PCA</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>zactmat_</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>

    <span class=n>significance</span><span class=o>.</span><span class=n>nneurons</span> <span class=o>=</span> <span class=n>nneurons</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nbins</span> <span class=o>=</span> <span class=n>nbins</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nshu</span> <span class=o>=</span> <span class=n>nshu</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>percentile</span> <span class=o>=</span> <span class=n>percentile</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>tracywidom</span> <span class=o>=</span> <span class=n>tracywidom</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>=</span> <span class=n>nullhyp</span>
    <span class=n>significance</span> <span class=o>=</span> <span class=n>runSignificance</span><span class=p>(</span><span class=n>zactmat_</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>

    <span class=k>if</span> <span class=n>nassemblies</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>=</span> <span class=n>nassemblies</span>

    <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>isnan</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=kc>None</span>

    <span class=k>if</span> <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span><span class=s2>&quot;no assembly detected&quot;</span><span class=p>)</span>

        <span class=n>patterns</span> <span class=o>=</span> <span class=kc>None</span>
        <span class=n>zactmat</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=c1># extracting co-activation patterns</span>
        <span class=n>patterns_</span> <span class=o>=</span> <span class=n>extractPatterns</span><span class=p>(</span>
            <span class=n>zactmat_</span><span class=p>,</span>
            <span class=n>significance</span><span class=p>,</span>
            <span class=n>method</span><span class=p>,</span>
            <span class=n>whiten</span><span class=o>=</span><span class=n>whiten</span><span class=p>,</span>
            <span class=n>cross_structural</span><span class=o>=</span><span class=n>cross_structural_</span><span class=p>,</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>patterns_</span> <span class=ow>is</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=c1># putting eventual silent neurons back (their assembly weights are defined as zero)</span>
        <span class=n>patterns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>np</span><span class=o>.</span><span class=n>size</span><span class=p>(</span><span class=n>patterns_</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>nneurons</span><span class=p>))</span>
        <span class=n>patterns</span><span class=p>[:,</span> <span class=o>~</span><span class=n>silentneurons</span><span class=p>]</span> <span class=o>=</span> <span class=n>patterns_</span>
        <span class=n>zactmat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>copy</span><span class=p>(</span><span class=n>actmat</span><span class=p>)</span>
        <span class=n>zactmat</span><span class=p>[</span><span class=o>~</span><span class=n>silentneurons</span><span class=p>,</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>zactmat_</span>

    <span class=k>return</span> <span class=n>patterns</span><span class=p>,</span> <span class=n>significance</span><span class=p>,</span> <span class=n>zactmat</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.runSignificance class="doc doc-heading"> <code class="highlight language-python"><span class=n>runSignificance</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Run significance tests to estimate the number of assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>zactmat</code> </td> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Z-scored activity matrix.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>significance</code> </td> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Object containing significance parameters.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=object>object</span></code> </td> <td> <div class=doc-md-description> <p>Updated significance object with the number of assemblies.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>runSignificance</span><span class=p>(</span><span class=n>zactmat</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>significance</span><span class=p>:</span> <span class=nb>object</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>object</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Run significance tests to estimate the number of assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    zactmat : np.ndarray</span>
<span class=sd>        Z-scored activity matrix.</span>
<span class=sd>    significance : object</span>
<span class=sd>        Object containing significance parameters.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    object</span>
<span class=sd>        Updated significance object with the number of assemblies.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;mp&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>marcenkopastur</span><span class=p>(</span><span class=n>significance</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;bin&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>binshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span> <span class=o>==</span> <span class=s2>&quot;circ&quot;</span><span class=p>:</span>
        <span class=n>lambdaMax</span> <span class=o>=</span> <span class=n>circshuffling</span><span class=p>(</span><span class=n>zactmat</span><span class=p>,</span> <span class=n>significance</span><span class=p>)</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;nyll hypothesis method &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>nullhyp</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; not understood&quot;</span>
        <span class=p>)</span>

    <span class=n>nassemblies</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>significance</span><span class=o>.</span><span class=n>explained_variance_</span> <span class=o>&gt;</span> <span class=n>lambdaMax</span><span class=p>)</span>
    <span class=n>significance</span><span class=o>.</span><span class=n>nassemblies</span> <span class=o>=</span> <span class=n>nassemblies</span>

    <span class=k>return</span> <span class=n>significance</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h2 id=neuro_py.ensemble.assembly.toyExample class="doc doc-heading"> <code class="highlight language-python"><span class=n>toyExample</span><span class=p>(</span><span class=n>assemblies</span><span class=p>,</span> <span class=n>nneurons</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>nbins</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>rate</span><span class=o>=</span><span class=mf>1.0</span><span class=p>)</span></code> </h2> <div class="doc doc-contents "> <p>Generate a toy example activity matrix with assemblies.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>assemblies</code> </td> <td> <code><a class="autorefs autorefs-internal" href=#neuro_py.ensemble.assembly.ToyAssemblies>ToyAssemblies</a></code> </td> <td> <div class=doc-md-description> <p>The toy assemblies.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>nneurons</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of neurons, by default 10.</p> </div> </td> <td> <code>10</code> </td> </tr> <tr class=doc-section-item> <td> <code>nbins</code> </td> <td> <code><span title=int>int</span></code> </td> <td> <div class=doc-md-description> <p>Number of time bins, by default 1000.</p> </div> </td> <td> <code>1000</code> </td> </tr> <tr class=doc-section-item> <td> <code>rate</code> </td> <td> <code><span title=float>float</span></code> </td> <td> <div class=doc-md-description> <p>Poisson rate, by default 1.0.</p> </div> </td> <td> <code>1.0</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=numpy.ndarray>ndarray</span></code> </td> <td> <div class=doc-md-description> <p>Activity matrix.</p> </div> </td> </tr> </tbody> </table> <details class=mkdocstrings-source> <summary>Source code in <code>neuro_py/ensemble/assembly.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>toyExample</span><span class=p>(</span>
    <span class=n>assemblies</span><span class=p>:</span> <span class=s2>&quot;ToyAssemblies&quot;</span><span class=p>,</span>
    <span class=n>nneurons</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
    <span class=n>nbins</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>,</span>
    <span class=n>rate</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    Generate a toy example activity matrix with assemblies.</span>

<span class=sd>    Parameters</span>
<span class=sd>    ----------</span>
<span class=sd>    assemblies : ToyAssemblies</span>
<span class=sd>        The toy assemblies.</span>
<span class=sd>    nneurons : int, optional</span>
<span class=sd>        Number of neurons, by default 10.</span>
<span class=sd>    nbins : int, optional</span>
<span class=sd>        Number of time bins, by default 1000.</span>
<span class=sd>    rate : float, optional</span>
<span class=sd>        Poisson rate, by default 1.0.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    np.ndarray</span>
<span class=sd>        Activity matrix.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>

    <span class=n>actmat</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>poisson</span><span class=p>(</span><span class=n>rate</span><span class=p>,</span> <span class=n>nneurons</span> <span class=o>*</span> <span class=n>nbins</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=n>nneurons</span><span class=p>,</span> <span class=n>nbins</span><span class=p>)</span>
    <span class=n>assemblies</span><span class=o>.</span><span class=n>actbins</span> <span class=o>=</span> <span class=p>[</span><span class=kc>None</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>assemblies</span><span class=o>.</span><span class=n>membership</span><span class=p>)</span>
    <span class=k>for</span> <span class=n>ai</span><span class=p>,</span> <span class=n>members</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>assemblies</span><span class=o>.</span><span class=n>membership</span><span class=p>):</span>
        <span class=n>members</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>members</span><span class=p>)</span>
        <span class=n>nact</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>nbins</span> <span class=o>*</span> <span class=n>assemblies</span><span class=o>.</span><span class=n>actrate</span><span class=p>[</span><span class=n>ai</span><span class=p>])</span>
        <span class=n>actstrength_</span> <span class=o>=</span> <span class=n>rate</span> <span class=o>*</span> <span class=n>assemblies</span><span class=o>.</span><span class=n>actstrength</span><span class=p>[</span><span class=n>ai</span><span class=p>]</span>

        <span class=n>actbins</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>argsort</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=n>nbins</span><span class=p>))[</span><span class=mi>0</span><span class=p>:</span><span class=n>nact</span><span class=p>]</span>

        <span class=n>actmat</span><span class=p>[</span><span class=n>members</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>actbins</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>((</span><span class=nb>len</span><span class=p>(</span><span class=n>members</span><span class=p>),</span> <span class=n>nact</span><span class=p>))</span> <span class=o>+</span> <span class=n>actstrength_</span>
        <span class=p>)</span>

        <span class=n>assemblies</span><span class=o>.</span><span class=n>actbins</span><span class=p>[</span><span class=n>ai</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>actbins</span><span class=p>)</span>

    <span class=k>return</span> <span class=n>actmat</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../detectors/up_down_state/ class="md-footer__link md-footer__link--prev" aria-label="Previous:  up_down_state"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> up_down_state </div> </div> </a> <a href=../assembly_reactivation/ class="md-footer__link md-footer__link--next" aria-label="Next:  assembly_reactivation"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> assembly_reactivation </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "content.tabs.link", "navigation.footer", "navigation.indexes", "navigation.instant.prefetch", "navigation.instant.preview", "navigation.instant.progress", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>